{"file":"C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\__tests__\\authController.test.ts","mappings":"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","names":[],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\__tests__\\authController.test.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport bcrypt from 'bcrypt';\r\nimport {\r\n  registerController,\r\n  loginController,\r\n  requestEmailVerificationController,\r\n  verifyAndCompleteRegistrationController,\r\n  forgotPasswordController,\r\n  verifyCodeController,\r\n  resetPasswordController,\r\n  updateUserByEmailController,\r\n  deleteUserByEmailController\r\n} from '../controllers/authController';\r\nimport {\r\n  getUserByEmailModel,\r\n  registerModel,\r\n  updateUserByEmailModel,\r\n  deleteUserByEmailModel\r\n} from '../models/authModel';\r\nimport { createToken } from '../utils/jwt';\r\nimport { sendEmail } from '../utils/mailer';\r\nimport { validarEmail, validarPassword } from '../utils/validatios';\r\nimport { createMockRequest, createMockResponse } from './setup';\r\n\r\n// Mock de todas las dependencias\r\njest.mock('../models/authModel');\r\njest.mock('../utils/jwt');\r\njest.mock('../utils/mailer');\r\njest.mock('../utils/validatios');\r\njest.mock('bcrypt');\r\n\r\ndescribe('AuthController', () => {\r\n  let mockRequest: Partial<Request>;\r\n  let mockResponse: Partial<Response>;\r\n  let mockJson: jest.Mock;\r\n  let mockStatus: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    mockJson = jest.fn();\r\n    mockStatus = jest.fn().mockReturnValue({ json: mockJson });\r\n    \r\n    mockResponse = {\r\n      status: mockStatus,\r\n      json: mockJson\r\n    };\r\n\r\n    // Reset de todos los mocks\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('registerController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          name: 'Juan',\r\n          lastName: 'Pérez',\r\n          roll: 'musico',\r\n          userEmail: 'juan@example.com',\r\n          userPassword: 'Password123!'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should register user successfully', async () => {\r\n      // Mock de validaciones\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      \r\n      // Mock de bcrypt\r\n      (bcrypt.hash as jest.Mock).mockResolvedValue('hashedPassword');\r\n      \r\n      // Mock del modelo - registerModel retorna false cuando es exitoso\r\n      (registerModel as jest.Mock).mockResolvedValue(false);\r\n      \r\n      // Mock del usuario creado\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        name: 'Juan',\r\n        lastName: 'Pérez',\r\n        roll: 'musico',\r\n        userEmail: 'juan@example.com'\r\n      });\r\n      \r\n      (createToken as jest.Mock).mockReturnValue('mockToken');\r\n\r\n      await registerController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Usuario Registrado con éxito.',\r\n        token: 'mockToken',\r\n        user: expect.objectContaining({\r\n          id: 'user123',\r\n          name: 'Juan',\r\n          lastName: 'Pérez',\r\n          roll: 'musico',\r\n          userEmail: 'juan@example.com'\r\n        })\r\n      });\r\n    });\r\n\r\n    it('should return error when required fields are missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          name: 'Juan',\r\n          lastName: 'Pérez',\r\n          // roll, userEmail, userPassword faltantes\r\n        }\r\n      });\r\n\r\n      await registerController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Error al registrarse, todos los campos deben de ser llenados'\r\n      });\r\n    });\r\n\r\n    it('should return error when password is invalid', async () => {\r\n      (validarPassword as jest.Mock).mockReturnValue(false);\r\n\r\n      await registerController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: expect.stringContaining('La contraseña no cumple con los requisitos')\r\n      });\r\n    });\r\n\r\n    it('should return error when email is invalid', async () => {\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      (validarEmail as jest.Mock).mockReturnValue(false);\r\n\r\n      await registerController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Correo Electrónico inválido.'\r\n      });\r\n    });\r\n\r\n    it('should return error when user already exists', async () => {\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (bcrypt.hash as jest.Mock).mockResolvedValue('hashedPassword');\r\n      \r\n      // Mock que el usuario ya existe\r\n      (registerModel as jest.Mock).mockResolvedValue('El usuario ya Existe.');\r\n\r\n      await registerController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(409);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Ya hay un usuario con esta direccion de correo electrónico.',\r\n        data: 'El usuario ya Existe.'\r\n      });\r\n    });\r\n\r\n    it('should return error when registration fails', async () => {\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (bcrypt.hash as jest.Mock).mockResolvedValue('hashedPassword');\r\n      \r\n      (registerModel as jest.Mock).mockRejectedValue(new Error('Database error'));\r\n\r\n      await registerController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Error al registrarse.',\r\n        error: expect.any(Error)\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('loginController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com',\r\n          userPassword: 'Password123!'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should login user successfully', async () => {\r\n      const mockUser = {\r\n        id: 'user123',\r\n        name: 'Juan',\r\n        lastName: 'Pérez',\r\n        roll: 'musico',\r\n        userEmail: 'juan@example.com',\r\n        userPassword: 'hashedPassword'\r\n      };\r\n\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue(mockUser);\r\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\r\n      (createToken as jest.Mock).mockReturnValue('mockToken');\r\n\r\n      await loginController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Login Exitoso',\r\n        token: 'mockToken',\r\n        user: mockUser\r\n      });\r\n    });\r\n\r\n    it('should return error when required fields are missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com'\r\n          // userPassword faltante\r\n        }\r\n      });\r\n\r\n      await loginController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Todos los campos deben de ser llenados.'\r\n      });\r\n    });\r\n\r\n    it('should return error when email is invalid', async () => {\r\n      (validarEmail as jest.Mock).mockReturnValue(false);\r\n\r\n      await loginController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Dirección de correo electrónico no válido.'\r\n      });\r\n    });\r\n\r\n    it('should return error when user not found', async () => {\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue(null);\r\n\r\n      await loginController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(401);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Verifique su dirección de correo electrónico o regístrese si no tiene una cuenta.'\r\n      });\r\n    });\r\n\r\n    it('should return error when password is incorrect', async () => {\r\n      const mockUser = {\r\n        id: 'user123',\r\n        name: 'Juan',\r\n        lastName: 'Pérez',\r\n        roll: 'musico',\r\n        userEmail: 'juan@example.com',\r\n        userPassword: 'hashedPassword'\r\n      };\r\n\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue(mockUser);\r\n      (bcrypt.compare as jest.Mock).mockResolvedValue(false);\r\n\r\n      await loginController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(401);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Contraseña incorrecta.'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('requestEmailVerificationController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          name: 'Juan',\r\n          lastName: 'Pérez',\r\n          userEmail: 'juan@example.com',\r\n          userPassword: 'Password123!',\r\n          roll: 'musico'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should request email verification successfully', async () => {\r\n      // Mock de validaciones\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      \r\n      // Mock que el usuario no existe\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue(null);\r\n      (sendEmail as jest.Mock).mockResolvedValue(true);\r\n\r\n      await requestEmailVerificationController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        message: 'Email de verificación enviado exitosamente. Revisa tu bandeja de entrada.',\r\n        data: expect.objectContaining({\r\n          userEmail: 'juan@example.com',\r\n          roll: 'musico',\r\n          expiresIn: '15 minutos'\r\n        })\r\n      });\r\n    });\r\n\r\n    it('should return error when email sending fails', async () => {\r\n      // Mock de validaciones\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      \r\n      // Mock que el usuario no existe\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue(null);\r\n      (sendEmail as jest.Mock).mockRejectedValue(new Error('Email sending failed'));\r\n\r\n      await requestEmailVerificationController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(500);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        message: 'Error interno del servidor',\r\n        error: 'Email sending failed'\r\n      });\r\n    });\r\n\r\n    it('should return error when user already exists', async () => {\r\n      // Mock de validaciones\r\n      (validarEmail as jest.Mock).mockReturnValue(true);\r\n      (validarPassword as jest.Mock).mockReturnValue(true);\r\n      \r\n      // Mock que el usuario ya existe\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        userEmail: 'juan@example.com'\r\n      });\r\n\r\n      await requestEmailVerificationController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(409);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        message: 'Ya existe un usuario con este email'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('verifyAndCompleteRegistrationController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com',\r\n          verificationCode: '123456'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should complete registration successfully', async () => {\r\n      const mockUser = {\r\n        id: 'user123',\r\n        name: 'Juan',\r\n        lastName: 'Pérez',\r\n        roll: 'musico',\r\n        userEmail: 'juan@example.com'\r\n      };\r\n\r\n      (registerModel as jest.Mock).mockResolvedValue(mockUser);\r\n      (createToken as jest.Mock).mockReturnValue('mockToken');\r\n\r\n      await verifyAndCompleteRegistrationController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        message: 'Email y código son requeridos'\r\n      });\r\n    });\r\n\r\n    it('should return error when verification code is invalid', async () => {\r\n      await verifyAndCompleteRegistrationController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        message: 'Email y código son requeridos'\r\n      });\r\n    });\r\n\r\n    it('should return error when required fields are missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com'\r\n          // verificationCode faltante\r\n        }\r\n      });\r\n\r\n      await verifyAndCompleteRegistrationController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        message: 'Email y código son requeridos'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('forgotPasswordController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should send password reset email successfully', async () => {\r\n      // Mock que el usuario existe y es superadmin\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        userEmail: 'juan@example.com',\r\n        roll: 'superadmin'\r\n      });\r\n      (sendEmail as jest.Mock).mockResolvedValue(true);\r\n\r\n      await forgotPasswordController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Código de verificación enviado al email',\r\n        userEmail: 'juan@example.com'\r\n      });\r\n    });\r\n\r\n    it('should return error when user is not superadmin', async () => {\r\n      // Mock que el usuario existe pero no es superadmin\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        userEmail: 'juan@example.com',\r\n        roll: 'usuario'\r\n      });\r\n\r\n      await forgotPasswordController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(403);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Solo superadmin puede recuperar contraseña'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('verifyCodeController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com',\r\n          code: '123456'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should return error when user not found', async () => {\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue(null);\r\n\r\n      await verifyCodeController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(404);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Usuario no encontrado'\r\n      });\r\n    });\r\n\r\n    it('should return error when user is not superadmin', async () => {\r\n      // Mock que el usuario existe pero no es superadmin\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        userEmail: 'juan@example.com',\r\n        roll: 'usuario'\r\n      });\r\n\r\n      await verifyCodeController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(403);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Solo superadmin puede recuperar contraseña'\r\n      });\r\n    });\r\n\r\n    it('should return error when required fields are missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com'\r\n          // code faltante\r\n        }\r\n      });\r\n\r\n      await verifyCodeController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Email y código son requeridos'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('resetPasswordController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com',\r\n          code: '123456',\r\n          newPassword: 'NewPassword123!'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should return error when user is not superadmin', async () => {\r\n      // Mock que el usuario existe pero no es superadmin\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        userEmail: 'juan@example.com',\r\n        roll: 'usuario'\r\n      });\r\n\r\n      await resetPasswordController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(403);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Solo superadmin puede recuperar contraseña'\r\n      });\r\n    });\r\n\r\n    it('should return error when required fields are missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com'\r\n          // code y newPassword faltantes\r\n        }\r\n      });\r\n\r\n      await resetPasswordController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Email, código y nueva contraseña son requeridos'\r\n      });\r\n    });\r\n\r\n    it('should return error when password is invalid', async () => {\r\n      // Mock que el usuario existe y es superadmin\r\n      (getUserByEmailModel as jest.Mock).mockResolvedValue({\r\n        id: 'user123',\r\n        userEmail: 'juan@example.com',\r\n        roll: 'superadmin'\r\n      });\r\n      (validarPassword as jest.Mock).mockReturnValue(false);\r\n\r\n      await resetPasswordController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'La contraseña no cumple con los requisitos, debe de contener Mayúsculas, Minúsculas, Números y Carácteres especiales'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('updateUserByEmailController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          name: 'Juan Updated',\r\n          lastName: 'Pérez Updated'\r\n        },\r\n        params: {\r\n          userEmail: 'juan@example.com'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should update user successfully', async () => {\r\n      (updateUserByEmailModel as jest.Mock).mockResolvedValue(false); // false significa éxito\r\n\r\n      await updateUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Consulta éxitosa'\r\n      });\r\n    });\r\n\r\n    it('should return error when update fails', async () => {\r\n      (updateUserByEmailModel as jest.Mock).mockResolvedValue('Error al actualizar');\r\n\r\n      await updateUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(401);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Error al actualizar'\r\n      });\r\n    });\r\n\r\n    it('should return error when email is missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          name: 'Juan Updated',\r\n          lastName: 'Pérez Updated'\r\n        },\r\n        params: {} // Sin userEmail\r\n      });\r\n\r\n      await updateUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(401);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        msg: 'Error al actualizar el usuario.'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('deleteUserByEmailController', () => {\r\n    beforeEach(() => {\r\n      mockRequest = createMockRequest({\r\n        body: {\r\n          userEmail: 'juan@example.com'\r\n        }\r\n      });\r\n    });\r\n\r\n    it('should delete user successfully', async () => {\r\n      (deleteUserByEmailModel as jest.Mock).mockResolvedValue(false); // false significa éxito\r\n\r\n      await deleteUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      // El controlador usa res.json() directamente cuando es exitoso, no res.status(200).json()\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        message: 'Usuario eliminado correctamente'\r\n      });\r\n    });\r\n\r\n    it('should return error when user not found', async () => {\r\n      (deleteUserByEmailModel as jest.Mock).mockResolvedValue('not_found');\r\n\r\n      await deleteUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(404);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        message: 'El usuario no existe o ya fue eliminado'\r\n      });\r\n    });\r\n\r\n    it('should return error when email is missing', async () => {\r\n      mockRequest = createMockRequest({\r\n        body: {} // Sin userEmail\r\n      });\r\n\r\n      await deleteUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        message: 'Falta el email'\r\n      });\r\n    });\r\n\r\n    it('should return error when model returns \"Falta el email\"', async () => {\r\n      (deleteUserByEmailModel as jest.Mock).mockResolvedValue('Falta el email');\r\n\r\n      await deleteUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        message: 'Falta el email'\r\n      });\r\n    });\r\n\r\n    it('should return error when model returns other error', async () => {\r\n      (deleteUserByEmailModel as jest.Mock).mockResolvedValue('Error de base de datos');\r\n\r\n      await deleteUserByEmailController(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(500);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        message: 'Error de base de datos'\r\n      });\r\n    });\r\n  });\r\n}); "],"version":3}