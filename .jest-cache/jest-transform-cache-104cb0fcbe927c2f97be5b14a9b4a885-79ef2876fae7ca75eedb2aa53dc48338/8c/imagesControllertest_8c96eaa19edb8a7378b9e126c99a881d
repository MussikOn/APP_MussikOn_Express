328d6ea196716f1b127008784090ffcb
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the imagesModel
jest.mock('../models/imagesModel');
const imagesController_1 = require("../controllers/imagesController");
const mockImagesModel = require('../models/imagesModel');
describe('ImagesController', () => {
    let mockRequest;
    let mockResponse;
    let mockStatus;
    let mockJson;
    beforeEach(() => {
        mockStatus = jest.fn().mockReturnThis();
        mockJson = jest.fn().mockReturnThis();
        mockResponse = {
            status: mockStatus,
            json: mockJson
        };
        jest.clearAllMocks();
    });
    describe('uploadImageController', () => {
        it('should upload image successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockFile = {
                fieldname: 'image',
                originalname: 'test.jpg',
                encoding: '7bit',
                mimetype: 'image/jpeg',
                buffer: Buffer.from('test image'),
                size: 1024,
                stream: {},
                destination: '',
                filename: 'test.jpg',
                path: ''
            };
            const mockUploadResult = {
                id: 'image-1',
                userId: 'user123',
                key: 'test-image-key',
                originalName: 'test.jpg',
                fileName: 'test.jpg',
                mimetype: 'image/jpeg',
                size: 1024,
                url: 'https://example.com/test.jpg',
                category: 'profile',
                isPublic: false,
                isActive: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            mockRequest = {
                user: {
                    userId: userId,
                    userEmail: userId,
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                },
                file: mockFile,
                body: { category: 'profile' }
            };
            mockImagesModel.uploadImage.mockResolvedValue(mockUploadResult);
            // Act
            yield (0, imagesController_1.uploadImageController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.uploadImage).toHaveBeenCalledWith(mockFile, userId, 'profile', {
                description: '',
                tags: [],
                isPublic: true
            });
            expect(mockStatus).toHaveBeenCalledWith(201);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                message: 'Imagen subida exitosamente',
                image: mockUploadResult
            });
        }));
        it('should return error when no file provided', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            mockRequest = {
                user: {
                    userId: userId,
                    userEmail: userId,
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                },
                file: undefined,
                body: { category: 'profile' }
            };
            // Act
            yield (0, imagesController_1.uploadImageController)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(400);
            expect(mockJson).toHaveBeenCalledWith({
                error: 'No se proporcionó ningún archivo'
            });
        }));
        it('should return error when user is not authenticated', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            mockRequest = {
                user: undefined,
                file: {
                    fieldname: 'image',
                    originalname: 'test.jpg',
                    encoding: '7bit',
                    mimetype: 'image/jpeg',
                    buffer: Buffer.from('test'),
                    size: 1024,
                    stream: {},
                    destination: '',
                    filename: 'test.jpg',
                    path: ''
                },
                body: { category: 'profile' }
            };
            // Act
            yield (0, imagesController_1.uploadImageController)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(401);
            expect(mockJson).toHaveBeenCalledWith({
                error: 'Usuario no autenticado'
            });
        }));
        it('should handle service errors', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockFile = {
                fieldname: 'image',
                originalname: 'test.jpg',
                encoding: '7bit',
                mimetype: 'image/jpeg',
                buffer: Buffer.from('test image'),
                size: 1024,
                stream: {},
                destination: '',
                filename: 'test.jpg',
                path: ''
            };
            mockRequest = {
                user: {
                    userId: userId,
                    userEmail: userId,
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                },
                file: mockFile,
                body: { category: 'profile' }
            };
            mockImagesModel.uploadImage.mockRejectedValue(new Error('Upload failed'));
            // Act
            yield (0, imagesController_1.uploadImageController)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(500);
            expect(mockJson).toHaveBeenCalledWith({
                error: 'Error al subir imagen',
                details: 'Upload failed'
            });
        }));
    });
    describe('getImageByIdController', () => {
        it('should get image by id successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const imageId = 'image123';
            const mockImage = {
                id: imageId,
                userId: 'user123',
                key: 'test-image-key',
                originalName: 'test.jpg',
                fileName: 'test.jpg',
                mimetype: 'image/jpeg',
                size: 1024,
                url: 'https://example.com/test.jpg',
                category: 'profile',
                isPublic: false,
                isActive: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            mockRequest = {
                params: { imageId },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.getImageById.mockResolvedValue(mockImage);
            // Act
            yield (0, imagesController_1.getImageByIdController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.getImageById).toHaveBeenCalledWith(imageId);
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                image: mockImage
            });
        }));
        it('should return 404 when image not found', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const imageId = 'nonexistent';
            mockRequest = {
                params: { imageId },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.getImageById.mockResolvedValue(null);
            // Act
            yield (0, imagesController_1.getImageByIdController)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(404);
            expect(mockJson).toHaveBeenCalledWith({
                error: 'Imagen no encontrada'
            });
        }));
    });
    describe('listImagesController', () => {
        it('should list images successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockImages = [
                {
                    id: 'image1',
                    userId: 'user123',
                    key: 'image1-key',
                    originalName: 'image1.jpg',
                    fileName: 'image1.jpg',
                    mimetype: 'image/jpeg',
                    size: 1024,
                    url: 'https://example.com/image1.jpg',
                    category: 'profile',
                    isPublic: false,
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                {
                    id: 'image2',
                    userId: 'user123',
                    key: 'image2-key',
                    originalName: 'image2.jpg',
                    fileName: 'image2.jpg',
                    mimetype: 'image/jpeg',
                    size: 2048,
                    url: 'https://example.com/image2.jpg',
                    category: 'post',
                    isPublic: true,
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockRequest = {
                query: { page: '1', limit: '10' },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.listImages.mockResolvedValue({
                images: mockImages,
                total: 2,
                page: 1,
                totalPages: 1,
                hasNext: false,
                hasPrev: false
            });
            // Act
            yield (0, imagesController_1.listImagesController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.listImages).toHaveBeenCalledWith({
                limit: 10
            });
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                images: {
                    images: mockImages,
                    total: 2,
                    page: 1,
                    totalPages: 1,
                    hasNext: false,
                    hasPrev: false
                },
                total: undefined,
                filters: {
                    limit: 10
                }
            });
        }));
    });
    describe('updateImageController', () => {
        it('should update image successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const imageId = 'image123';
            const updateData = {
                description: 'Updated description',
                tags: ['tag1', 'tag2'],
                isPublic: false
            };
            const mockUpdatedImage = Object.assign({ id: imageId, userId: 'user123', key: 'test-image-key', originalName: 'test.jpg', fileName: 'test.jpg', mimetype: 'image/jpeg', size: 1024, url: 'https://example.com/test.jpg', category: 'profile', isActive: true, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }, updateData);
            mockRequest = {
                params: { imageId },
                body: updateData,
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.getImageById.mockResolvedValue({
                id: imageId,
                userId: 'user123',
                key: 'test-image-key',
                originalName: 'test.jpg',
                fileName: 'test.jpg',
                mimetype: 'image/jpeg',
                size: 1024,
                url: 'https://example.com/test.jpg',
                category: 'profile',
                isActive: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            });
            mockImagesModel.updateImage.mockResolvedValue(mockUpdatedImage);
            // Act
            yield (0, imagesController_1.updateImageController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.updateImage).toHaveBeenCalledWith(imageId, updateData);
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                message: 'Imagen actualizada exitosamente',
                image: mockUpdatedImage
            });
        }));
    });
    describe('deleteImageController', () => {
        it('should delete image successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const imageId = 'image123';
            mockRequest = {
                params: { imageId },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.deleteImage.mockResolvedValue(true);
            // Act
            yield (0, imagesController_1.deleteImageController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.deleteImage).toHaveBeenCalledWith(imageId, 'user123');
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                message: 'Imagen eliminada exitosamente'
            });
        }));
    });
    describe('getImageStatsController', () => {
        it('should get image stats successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockStats = {
                totalImages: 100,
                totalSize: 1024000,
                averageSize: 10240,
                imagesByCategory: {
                    profile: 20,
                    post: 30,
                    event: 25,
                    gallery: 25
                },
                imagesByUser: { 'user123': 50, 'user456': 50 },
                recentUploads: [{
                        id: 'image1',
                        userId: 'user123',
                        key: 'image1-key',
                        originalName: 'image1.jpg',
                        fileName: 'image1.jpg',
                        mimetype: 'image/jpeg',
                        size: 1024,
                        url: 'https://example.com/image1.jpg',
                        category: 'profile',
                        isPublic: false,
                        isActive: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }]
            };
            mockRequest = {
                user: {
                    userId: 'admin123',
                    userEmail: 'admin123',
                    email: 'admin@example.com',
                    role: 'adminSenior',
                    roll: 'adminSenior',
                    name: 'Admin User'
                }
            };
            mockImagesModel.getImageStats.mockResolvedValue(mockStats);
            // Act
            yield (0, imagesController_1.getImageStatsController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.getImageStats).toHaveBeenCalled();
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                stats: mockStats
            });
        }));
    });
    describe('getUserProfileImagesController', () => {
        it('should get user profile images successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockImages = [
                {
                    id: 'image1',
                    userId: 'user123',
                    key: 'image1-key',
                    originalName: 'image1.jpg',
                    fileName: 'image1.jpg',
                    mimetype: 'image/jpeg',
                    size: 1024,
                    url: 'https://example.com/image1.jpg',
                    category: 'profile',
                    isPublic: false,
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockRequest = {
                params: { userId },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.getUserProfileImages.mockResolvedValue(mockImages);
            // Act
            yield (0, imagesController_1.getUserProfileImagesController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.getUserProfileImages).toHaveBeenCalledWith(userId);
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                images: mockImages
            });
        }));
    });
    describe('getPostImagesController', () => {
        it('should get post images successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const postId = 'post123';
            const mockImages = [
                {
                    id: 'image1',
                    userId: 'user123',
                    key: 'image1-key',
                    originalName: 'image1.jpg',
                    fileName: 'image1.jpg',
                    mimetype: 'image/jpeg',
                    size: 1024,
                    url: 'https://example.com/image1.jpg',
                    category: 'post',
                    isPublic: true,
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockRequest = {
                query: { userId: 'user123' },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.getPostImages.mockResolvedValue(mockImages);
            // Act
            yield (0, imagesController_1.getPostImagesController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.getPostImages).toHaveBeenCalledWith('user123');
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                images: mockImages
            });
        }));
    });
    describe('getEventImagesController', () => {
        it('should get event images successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const eventId = 'event123';
            const mockImages = [
                {
                    id: 'image1',
                    userId: 'user123',
                    key: 'image1-key',
                    originalName: 'image1.jpg',
                    fileName: 'image1.jpg',
                    mimetype: 'image/jpeg',
                    size: 1024,
                    url: 'https://example.com/image1.jpg',
                    category: 'event',
                    isPublic: true,
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockRequest = {
                query: { eventId },
                user: {
                    userId: 'user123',
                    userEmail: 'user123',
                    email: 'test@example.com',
                    role: 'user',
                    name: 'Test User'
                }
            };
            mockImagesModel.getEventImages.mockResolvedValue(mockImages);
            // Act
            yield (0, imagesController_1.getEventImagesController)(mockRequest, mockResponse);
            // Assert
            expect(mockImagesModel.getEventImages).toHaveBeenCalledWith(eventId);
            expect(mockStatus).toHaveBeenCalledWith(200);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                images: mockImages
            });
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXGltYWdlc0NvbnRyb2xsZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWNBLHVCQUF1QjtBQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFkbkMsc0VBVXlDO0FBS3pDLE1BQU0sZUFBZSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRXpELFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFDaEMsSUFBSSxXQUE2QixDQUFDO0lBQ2xDLElBQUksWUFBK0IsQ0FBQztJQUNwQyxJQUFJLFVBQXFCLENBQUM7SUFDMUIsSUFBSSxRQUFtQixDQUFDO0lBRXhCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3hDLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEMsWUFBWSxHQUFHO1lBQ2IsTUFBTSxFQUFFLFVBQVU7WUFDbEIsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtRQUNyQyxFQUFFLENBQUMsa0NBQWtDLEVBQUUsR0FBUyxFQUFFO1lBQ2hELFVBQVU7WUFDVixNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUM7WUFDekIsTUFBTSxRQUFRLEdBQUc7Z0JBQ2YsU0FBUyxFQUFFLE9BQU87Z0JBQ2xCLFlBQVksRUFBRSxVQUFVO2dCQUN4QixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztnQkFDakMsSUFBSSxF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QUk7Z0JBQ2IsTUFBTSxFQUFFLFVBQVU7YUFDbkIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBT0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXGltYWdlc0NvbnRyb2xsZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgeyBcclxuICB1cGxvYWRJbWFnZUNvbnRyb2xsZXIsXHJcbiAgZ2V0SW1hZ2VCeUlkQ29udHJvbGxlcixcclxuICBsaXN0SW1hZ2VzQ29udHJvbGxlcixcclxuICB1cGRhdGVJbWFnZUNvbnRyb2xsZXIsXHJcbiAgZGVsZXRlSW1hZ2VDb250cm9sbGVyLFxyXG4gIGdldEltYWdlU3RhdHNDb250cm9sbGVyLFxyXG4gIGdldFVzZXJQcm9maWxlSW1hZ2VzQ29udHJvbGxlcixcclxuICBnZXRQb3N0SW1hZ2VzQ29udHJvbGxlcixcclxuICBnZXRFdmVudEltYWdlc0NvbnRyb2xsZXJcclxufSBmcm9tICcuLi9jb250cm9sbGVycy9pbWFnZXNDb250cm9sbGVyJztcclxuaW1wb3J0IHsgSW1hZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaW1hZ2VTZXJ2aWNlJztcclxuXHJcbi8vIE1vY2sgdGhlIGltYWdlc01vZGVsXHJcbmplc3QubW9jaygnLi4vbW9kZWxzL2ltYWdlc01vZGVsJyk7XHJcbmNvbnN0IG1vY2tJbWFnZXNNb2RlbCA9IHJlcXVpcmUoJy4uL21vZGVscy9pbWFnZXNNb2RlbCcpO1xyXG5cclxuZGVzY3JpYmUoJ0ltYWdlc0NvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgbGV0IG1vY2tSZXF1ZXN0OiBQYXJ0aWFsPFJlcXVlc3Q+O1xyXG4gIGxldCBtb2NrUmVzcG9uc2U6IFBhcnRpYWw8UmVzcG9uc2U+O1xyXG4gIGxldCBtb2NrU3RhdHVzOiBqZXN0Lk1vY2s7XHJcbiAgbGV0IG1vY2tKc29uOiBqZXN0Lk1vY2s7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgbW9ja1N0YXR1cyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpO1xyXG4gICAgbW9ja0pzb24gPSBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKTtcclxuICAgIG1vY2tSZXNwb25zZSA9IHtcclxuICAgICAgc3RhdHVzOiBtb2NrU3RhdHVzLFxyXG4gICAgICBqc29uOiBtb2NrSnNvblxyXG4gICAgfTtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBsb2FkSW1hZ2VDb250cm9sbGVyJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB1cGxvYWQgaW1hZ2Ugc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMTIzJztcclxuICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7XHJcbiAgICAgICAgZmllbGRuYW1lOiAnaW1hZ2UnLFxyXG4gICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICBlbmNvZGluZzogJzdiaXQnLFxyXG4gICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgndGVzdCBpbWFnZScpLFxyXG4gICAgICAgIHNpemU6IDEwMjQsXHJcbiAgICAgICAgc3RyZWFtOiB7fSBhcyBhbnksXHJcbiAgICAgICAgZGVzdGluYXRpb246ICcnLFxyXG4gICAgICAgIGZpbGVuYW1lOiAndGVzdC5qcGcnLFxyXG4gICAgICAgIHBhdGg6ICcnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBtb2NrVXBsb2FkUmVzdWx0ID0ge1xyXG4gICAgICAgIGlkOiAnaW1hZ2UtMScsXHJcbiAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAga2V5OiAndGVzdC1pbWFnZS1rZXknLFxyXG4gICAgICAgIG9yaWdpbmFsTmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICBmaWxlTmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICBtaW1ldHlwZTogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgIHNpemU6IDEwMjQsXHJcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS90ZXN0LmpwZycsXHJcbiAgICAgICAgY2F0ZWdvcnk6ICdwcm9maWxlJyBhcyBjb25zdCxcclxuICAgICAgICBpc1B1YmxpYzogZmFsc2UsXHJcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHsgXHJcbiAgICAgICAgICB1c2VySWQ6IHVzZXJJZCxcclxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlcklkLFxyXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBmaWxlOiBtb2NrRmlsZSxcclxuICAgICAgICBib2R5OiB7IGNhdGVnb3J5OiAncHJvZmlsZScgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0ltYWdlc01vZGVsLnVwbG9hZEltYWdlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVcGxvYWRSZXN1bHQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IHVwbG9hZEltYWdlQ29udHJvbGxlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrSW1hZ2VzTW9kZWwudXBsb2FkSW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tGaWxlLCB1c2VySWQsICdwcm9maWxlJywge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcclxuICAgICAgICB0YWdzOiBbXSxcclxuICAgICAgICBpc1B1YmxpYzogdHJ1ZVxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMSk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ltYWdlbiBzdWJpZGEgZXhpdG9zYW1lbnRlJyxcclxuICAgICAgICBpbWFnZTogbW9ja1VwbG9hZFJlc3VsdFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHdoZW4gbm8gZmlsZSBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHsgXHJcbiAgICAgICAgICB1c2VySWQ6IHVzZXJJZCxcclxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlcklkLFxyXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBmaWxlOiB1bmRlZmluZWQsXHJcbiAgICAgICAgYm9keTogeyBjYXRlZ29yeTogJ3Byb2ZpbGUnIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCB1cGxvYWRJbWFnZUNvbnRyb2xsZXIobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgZXJyb3I6ICdObyBzZSBwcm9wb3JjaW9uw7MgbmluZ8O6biBhcmNoaXZvJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHdoZW4gdXNlciBpcyBub3QgYXV0aGVudGljYXRlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICB1c2VyOiB1bmRlZmluZWQsXHJcbiAgICAgICAgZmlsZTogeyBcclxuICAgICAgICAgIGZpZWxkbmFtZTogJ2ltYWdlJyxcclxuICAgICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICAgIGVuY29kaW5nOiAnN2JpdCcsXHJcbiAgICAgICAgICBtaW1ldHlwZTogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgndGVzdCcpLFxyXG4gICAgICAgICAgc2l6ZTogMTAyNCxcclxuICAgICAgICAgIHN0cmVhbToge30gYXMgYW55LFxyXG4gICAgICAgICAgZGVzdGluYXRpb246ICcnLFxyXG4gICAgICAgICAgZmlsZW5hbWU6ICd0ZXN0LmpwZycsXHJcbiAgICAgICAgICBwYXRoOiAnJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keTogeyBjYXRlZ29yeTogJ3Byb2ZpbGUnIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCB1cGxvYWRJbWFnZUNvbnRyb2xsZXIobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAxKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgZXJyb3I6ICdVc3VhcmlvIG5vIGF1dGVudGljYWRvJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMTIzJztcclxuICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7XHJcbiAgICAgICAgZmllbGRuYW1lOiAnaW1hZ2UnLFxyXG4gICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QuanBnJyxcclxuICAgICAgICBlbmNvZGluZzogJzdiaXQnLFxyXG4gICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgndGVzdCBpbWFnZScpLFxyXG4gICAgICAgIHNpemU6IDEwMjQsXHJcbiAgICAgICAgc3RyZWFtOiB7fSBhcyBhbnksXHJcbiAgICAgICAgZGVzdGluYXRpb246ICcnLFxyXG4gICAgICAgIGZpbGVuYW1lOiAndGVzdC5qcGcnLFxyXG4gICAgICAgIHBhdGg6ICcnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICB1c2VyOiB7IFxyXG4gICAgICAgICAgdXNlcklkOiB1c2VySWQsXHJcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJJZCxcclxuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmlsZTogbW9ja0ZpbGUsXHJcbiAgICAgICAgYm9keTogeyBjYXRlZ29yeTogJ3Byb2ZpbGUnIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tJbWFnZXNNb2RlbC51cGxvYWRJbWFnZS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1VwbG9hZCBmYWlsZWQnKSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgdXBsb2FkSW1hZ2VDb250cm9sbGVyKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDUwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIGVycm9yOiAnRXJyb3IgYWwgc3ViaXIgaW1hZ2VuJyxcclxuICAgICAgICBkZXRhaWxzOiAnVXBsb2FkIGZhaWxlZCdcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldEltYWdlQnlJZENvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGdldCBpbWFnZSBieSBpZCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgaW1hZ2VJZCA9ICdpbWFnZTEyMyc7XHJcbiAgICAgIGNvbnN0IG1vY2tJbWFnZSA9IHtcclxuICAgICAgICBpZDogaW1hZ2VJZCxcclxuICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICBrZXk6ICd0ZXN0LWltYWdlLWtleScsXHJcbiAgICAgICAgb3JpZ2luYWxOYW1lOiAndGVzdC5qcGcnLFxyXG4gICAgICAgIGZpbGVOYW1lOiAndGVzdC5qcGcnLFxyXG4gICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgc2l6ZTogMTAyNCxcclxuICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3Rlc3QuanBnJyxcclxuICAgICAgICBjYXRlZ29yeTogJ3Byb2ZpbGUnIGFzIGNvbnN0LFxyXG4gICAgICAgIGlzUHVibGljOiBmYWxzZSxcclxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgcGFyYW1zOiB7IGltYWdlSWQgfSxcclxuICAgICAgICB1c2VyOiB7IFxyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tJbWFnZXNNb2RlbC5nZXRJbWFnZUJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ltYWdlKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZXRJbWFnZUJ5SWRDb250cm9sbGVyKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tJbWFnZXNNb2RlbC5nZXRJbWFnZUJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGltYWdlSWQpO1xyXG4gICAgICBleHBlY3QobW9ja1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBpbWFnZTogbW9ja0ltYWdlXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gNDA0IHdoZW4gaW1hZ2Ugbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGltYWdlSWQgPSAnbm9uZXhpc3RlbnQnO1xyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBwYXJhbXM6IHsgaW1hZ2VJZCB9LFxyXG4gICAgICAgIHVzZXI6IHsgXHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0ltYWdlc01vZGVsLmdldEltYWdlQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZXRJbWFnZUJ5SWRDb250cm9sbGVyKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwNCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIGVycm9yOiAnSW1hZ2VuIG5vIGVuY29udHJhZGEnXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdsaXN0SW1hZ2VzQ29udHJvbGxlcicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbGlzdCBpbWFnZXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IG1vY2tJbWFnZXMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdpbWFnZTEnLFxyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBrZXk6ICdpbWFnZTEta2V5JyxcclxuICAgICAgICAgIG9yaWdpbmFsTmFtZTogJ2ltYWdlMS5qcGcnLFxyXG4gICAgICAgICAgZmlsZU5hbWU6ICdpbWFnZTEuanBnJyxcclxuICAgICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICBzaXplOiAxMDI0LFxyXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZTEuanBnJyxcclxuICAgICAgICAgIGNhdGVnb3J5OiAncHJvZmlsZScgYXMgY29uc3QsXHJcbiAgICAgICAgICBpc1B1YmxpYzogZmFsc2UsXHJcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiAnaW1hZ2UyJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAga2V5OiAnaW1hZ2UyLWtleScsXHJcbiAgICAgICAgICBvcmlnaW5hbE5hbWU6ICdpbWFnZTIuanBnJyxcclxuICAgICAgICAgIGZpbGVOYW1lOiAnaW1hZ2UyLmpwZycsXHJcbiAgICAgICAgICBtaW1ldHlwZTogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICAgc2l6ZTogMjA0OCxcclxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2UyLmpwZycsXHJcbiAgICAgICAgICBjYXRlZ29yeTogJ3Bvc3QnIGFzIGNvbnN0LFxyXG4gICAgICAgICAgaXNQdWJsaWM6IHRydWUsXHJcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBxdWVyeTogeyBwYWdlOiAnMScsIGxpbWl0OiAnMTAnIH0sXHJcbiAgICAgICAgdXNlcjogeyBcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrSW1hZ2VzTW9kZWwubGlzdEltYWdlcy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgaW1hZ2VzOiBtb2NrSW1hZ2VzLFxyXG4gICAgICAgIHRvdGFsOiAyLFxyXG4gICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgdG90YWxQYWdlczogMSxcclxuICAgICAgICBoYXNOZXh0OiBmYWxzZSxcclxuICAgICAgICBoYXNQcmV2OiBmYWxzZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBsaXN0SW1hZ2VzQ29udHJvbGxlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrSW1hZ2VzTW9kZWwubGlzdEltYWdlcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIGxpbWl0OiAxMFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgaW1hZ2VzOiB7XHJcbiAgICAgICAgICBpbWFnZXM6IG1vY2tJbWFnZXMsXHJcbiAgICAgICAgICB0b3RhbDogMixcclxuICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICB0b3RhbFBhZ2VzOiAxLFxyXG4gICAgICAgICAgaGFzTmV4dDogZmFsc2UsXHJcbiAgICAgICAgICBoYXNQcmV2OiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG90YWw6IHVuZGVmaW5lZCxcclxuICAgICAgICBmaWx0ZXJzOiB7XHJcbiAgICAgICAgICBsaW1pdDogMTBcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd1cGRhdGVJbWFnZUNvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBpbWFnZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgaW1hZ2VJZCA9ICdpbWFnZTEyMyc7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdVcGRhdGVkIGRlc2NyaXB0aW9uJyxcclxuICAgICAgICB0YWdzOiBbJ3RhZzEnLCAndGFnMiddLFxyXG4gICAgICAgIGlzUHVibGljOiBmYWxzZVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZWRJbWFnZSA9IHtcclxuICAgICAgICBpZDogaW1hZ2VJZCxcclxuICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICBrZXk6ICd0ZXN0LWltYWdlLWtleScsXHJcbiAgICAgICAgb3JpZ2luYWxOYW1lOiAndGVzdC5qcGcnLFxyXG4gICAgICAgIGZpbGVOYW1lOiAndGVzdC5qcGcnLFxyXG4gICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgc2l6ZTogMTAyNCxcclxuICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3Rlc3QuanBnJyxcclxuICAgICAgICBjYXRlZ29yeTogJ3Byb2ZpbGUnIGFzIGNvbnN0LFxyXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxyXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIC4uLnVwZGF0ZURhdGFcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHBhcmFtczogeyBpbWFnZUlkIH0sXHJcbiAgICAgICAgYm9keTogdXBkYXRlRGF0YSxcclxuICAgICAgICB1c2VyOiB7IFxyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tJbWFnZXNNb2RlbC5nZXRJbWFnZUJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGlkOiBpbWFnZUlkLFxyXG4gICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgIGtleTogJ3Rlc3QtaW1hZ2Uta2V5JyxcclxuICAgICAgICBvcmlnaW5hbE5hbWU6ICd0ZXN0LmpwZycsXHJcbiAgICAgICAgZmlsZU5hbWU6ICd0ZXN0LmpwZycsXHJcbiAgICAgICAgbWltZXR5cGU6ICdpbWFnZS9qcGVnJyxcclxuICAgICAgICBzaXplOiAxMDI0LFxyXG4gICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vdGVzdC5qcGcnLFxyXG4gICAgICAgIGNhdGVnb3J5OiAncHJvZmlsZScgYXMgY29uc3QsXHJcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICAgIG1vY2tJbWFnZXNNb2RlbC51cGRhdGVJbWFnZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXBkYXRlZEltYWdlKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCB1cGRhdGVJbWFnZUNvbnRyb2xsZXIobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0ltYWdlc01vZGVsLnVwZGF0ZUltYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpbWFnZUlkLCB1cGRhdGVEYXRhKTtcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ltYWdlbiBhY3R1YWxpemFkYSBleGl0b3NhbWVudGUnLFxyXG4gICAgICAgIGltYWdlOiBtb2NrVXBkYXRlZEltYWdlXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdkZWxldGVJbWFnZUNvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBpbWFnZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgaW1hZ2VJZCA9ICdpbWFnZTEyMyc7XHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHBhcmFtczogeyBpbWFnZUlkIH0sXHJcbiAgICAgICAgdXNlcjogeyBcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrSW1hZ2VzTW9kZWwuZGVsZXRlSW1hZ2UubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZGVsZXRlSW1hZ2VDb250cm9sbGVyKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tJbWFnZXNNb2RlbC5kZWxldGVJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoaW1hZ2VJZCwgJ3VzZXIxMjMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ltYWdlbiBlbGltaW5hZGEgZXhpdG9zYW1lbnRlJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0SW1hZ2VTdGF0c0NvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGdldCBpbWFnZSBzdGF0cyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xyXG4gICAgICAgIHRvdGFsSW1hZ2VzOiAxMDAsXHJcbiAgICAgICAgdG90YWxTaXplOiAxMDI0MDAwLFxyXG4gICAgICAgIGF2ZXJhZ2VTaXplOiAxMDI0MCxcclxuICAgICAgICBpbWFnZXNCeUNhdGVnb3J5OiB7XHJcbiAgICAgICAgICBwcm9maWxlOiAyMCxcclxuICAgICAgICAgIHBvc3Q6IDMwLFxyXG4gICAgICAgICAgZXZlbnQ6IDI1LFxyXG4gICAgICAgICAgZ2FsbGVyeTogMjVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGltYWdlc0J5VXNlcjogeyAndXNlcjEyMyc6IDUwLCAndXNlcjQ1Nic6IDUwIH0sXHJcbiAgICAgICAgcmVjZW50VXBsb2FkczogW3tcclxuICAgICAgICAgIGlkOiAnaW1hZ2UxJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAga2V5OiAnaW1hZ2UxLWtleScsXHJcbiAgICAgICAgICBvcmlnaW5hbE5hbWU6ICdpbWFnZTEuanBnJyxcclxuICAgICAgICAgIGZpbGVOYW1lOiAnaW1hZ2UxLmpwZycsXHJcbiAgICAgICAgICBtaW1ldHlwZTogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICAgc2l6ZTogMTAyNCxcclxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2UxLmpwZycsXHJcbiAgICAgICAgICBjYXRlZ29yeTogJ3Byb2ZpbGUnIGFzIGNvbnN0LFxyXG4gICAgICAgICAgaXNQdWJsaWM6IGZhbHNlLFxyXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfV1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHsgXHJcbiAgICAgICAgICB1c2VySWQ6ICdhZG1pbjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6ICdhZG1pbjEyMycsXHJcbiAgICAgICAgICBlbWFpbDogJ2FkbWluQGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHJvbGU6ICdhZG1pblNlbmlvcicsXHJcbiAgICAgICAgICByb2xsOiAnYWRtaW5TZW5pb3InLFxyXG4gICAgICAgICAgbmFtZTogJ0FkbWluIFVzZXInXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0ltYWdlc01vZGVsLmdldEltYWdlU3RhdHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N0YXRzKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZXRJbWFnZVN0YXRzQ29udHJvbGxlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrSW1hZ2VzTW9kZWwuZ2V0SW1hZ2VTdGF0cykudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobW9ja1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBzdGF0czogbW9ja1N0YXRzXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRVc2VyUHJvZmlsZUltYWdlc0NvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGdldCB1c2VyIHByb2ZpbGUgaW1hZ2VzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XHJcbiAgICAgIGNvbnN0IG1vY2tJbWFnZXMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdpbWFnZTEnLFxyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBrZXk6ICdpbWFnZTEta2V5JyxcclxuICAgICAgICAgIG9yaWdpbmFsTmFtZTogJ2ltYWdlMS5qcGcnLFxyXG4gICAgICAgICAgZmlsZU5hbWU6ICdpbWFnZTEuanBnJyxcclxuICAgICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICBzaXplOiAxMDI0LFxyXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZTEuanBnJyxcclxuICAgICAgICAgIGNhdGVnb3J5OiAncHJvZmlsZScgYXMgY29uc3QsXHJcbiAgICAgICAgICBpc1B1YmxpYzogZmFsc2UsXHJcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBwYXJhbXM6IHsgdXNlcklkIH0sXHJcbiAgICAgICAgdXNlcjogeyBcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrSW1hZ2VzTW9kZWwuZ2V0VXNlclByb2ZpbGVJbWFnZXMubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ltYWdlcyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0VXNlclByb2ZpbGVJbWFnZXNDb250cm9sbGVyKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tJbWFnZXNNb2RlbC5nZXRVc2VyUHJvZmlsZUltYWdlcykudG9IYXZlQmVlbkNhbGxlZFdpdGgodXNlcklkKTtcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgaW1hZ2VzOiBtb2NrSW1hZ2VzXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRQb3N0SW1hZ2VzQ29udHJvbGxlcicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZ2V0IHBvc3QgaW1hZ2VzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBwb3N0SWQgPSAncG9zdDEyMyc7XHJcbiAgICAgIGNvbnN0IG1vY2tJbWFnZXMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdpbWFnZTEnLFxyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBrZXk6ICdpbWFnZTEta2V5JyxcclxuICAgICAgICAgIG9yaWdpbmFsTmFtZTogJ2ltYWdlMS5qcGcnLFxyXG4gICAgICAgICAgZmlsZU5hbWU6ICdpbWFnZTEuanBnJyxcclxuICAgICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICBzaXplOiAxMDI0LFxyXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZTEuanBnJyxcclxuICAgICAgICAgIGNhdGVnb3J5OiAncG9zdCcgYXMgY29uc3QsXHJcbiAgICAgICAgICBpc1B1YmxpYzogdHJ1ZSxcclxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHF1ZXJ5OiB7IHVzZXJJZDogJ3VzZXIxMjMnIH0sXHJcbiAgICAgICAgdXNlcjogeyBcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiAndXNlcjEyMycsXHJcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrSW1hZ2VzTW9kZWwuZ2V0UG9zdEltYWdlcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSW1hZ2VzKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZXRQb3N0SW1hZ2VzQ29udHJvbGxlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrSW1hZ2VzTW9kZWwuZ2V0UG9zdEltYWdlcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXIxMjMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgaW1hZ2VzOiBtb2NrSW1hZ2VzXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRFdmVudEltYWdlc0NvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGdldCBldmVudCBpbWFnZXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGV2ZW50SWQgPSAnZXZlbnQxMjMnO1xyXG4gICAgICBjb25zdCBtb2NrSW1hZ2VzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiAnaW1hZ2UxJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAga2V5OiAnaW1hZ2UxLWtleScsXHJcbiAgICAgICAgICBvcmlnaW5hbE5hbWU6ICdpbWFnZTEuanBnJyxcclxuICAgICAgICAgIGZpbGVOYW1lOiAnaW1hZ2UxLmpwZycsXHJcbiAgICAgICAgICBtaW1ldHlwZTogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICAgc2l6ZTogMTAyNCxcclxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2UxLmpwZycsXHJcbiAgICAgICAgICBjYXRlZ29yeTogJ2V2ZW50JyBhcyBjb25zdCxcclxuICAgICAgICAgIGlzUHVibGljOiB0cnVlLFxyXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgcXVlcnk6IHsgZXZlbnRJZCB9LFxyXG4gICAgICAgIHVzZXI6IHsgXHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0ltYWdlc01vZGVsLmdldEV2ZW50SW1hZ2VzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbWFnZXMpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGdldEV2ZW50SW1hZ2VzQ29udHJvbGxlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrSW1hZ2VzTW9kZWwuZ2V0RXZlbnRJbWFnZXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV2ZW50SWQpO1xyXG4gICAgICBleHBlY3QobW9ja1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBpbWFnZXM6IG1vY2tJbWFnZXNcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxufSk7ICJdLCJ2ZXJzaW9uIjozfQ==