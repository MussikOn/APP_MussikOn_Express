{"version":3,"names":["cov_866s1yfvi","actualCoverage","exports","authMiddleware","jsonwebtoken_1","s","__importDefault","require","ENV_1","req","res","next","f","authHeader","headers","authorization","b","startsWith","status","json","message","token","split","decoded","default","verify","TOKEN_SECRET","user","err"],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\middleware\\authMiddleware.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport jwt from 'jsonwebtoken';\r\nimport { TOKEN_SECRET } from '../../ENV';\r\n\r\nexport function authMiddleware(\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n): void {\r\n  const authHeader = req.headers.authorization;\r\n\r\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n    res.status(401).json({ message: 'Token no proporcionado' });\r\n    return;\r\n  }\r\n\r\n  const token = authHeader.split(' ')[1];\r\n\r\n  try {\r\n    const decoded = jwt.verify(token, TOKEN_SECRET);\r\n    // Agregar el usuario decodificado en req.user\r\n    (req as any).user = decoded;\r\n    next();\r\n  } catch (err) {\r\n    res.status(401).json({ message: 'Token inv√°lido o expirado' });\r\n  }\r\n}\r\n\r\n\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAkBO;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAdPE,OAAA,CAAAC,cAAA,GAAAA,cAAA;AAHA,MAAAC,cAAA;AAAA;AAAA,CAAAJ,aAAA,GAAAK,CAAA,OAAAC,eAAA,CAAAC,OAAA;AACA,MAAAC,KAAA;AAAA;AAAA,CAAAR,aAAA,GAAAK,CAAA,OAAAE,OAAA;AAEA,SAAgBJ,cAAcA,CAC5BM,GAAY,EACZC,GAAa,EACbC,IAAkB;EAAA;EAAAX,aAAA,GAAAY,CAAA;EAElB,MAAMC,UAAU;EAAA;EAAA,CAAAb,aAAA,GAAAK,CAAA,OAAGI,GAAG,CAACK,OAAO,CAACC,aAAa;EAAC;EAAAf,aAAA,GAAAK,CAAA;EAE7C;EAAI;EAAA,CAAAL,aAAA,GAAAgB,CAAA,WAACH,UAAU;EAAA;EAAA,CAAAb,aAAA,GAAAgB,CAAA,UAAI,CAACH,UAAU,CAACI,UAAU,CAAC,SAAS,CAAC,GAAE;IAAA;IAAAjB,aAAA,GAAAgB,CAAA;IAAAhB,aAAA,GAAAK,CAAA;IACpDK,GAAG,CAACQ,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE;IAAwB,CAAE,CAAC;IAAC;IAAApB,aAAA,GAAAK,CAAA;IAC5D;EACF,CAAC;EAAA;EAAA;IAAAL,aAAA,GAAAgB,CAAA;EAAA;EAED,MAAMK,KAAK;EAAA;EAAA,CAAArB,aAAA,GAAAK,CAAA,QAAGQ,UAAU,CAACS,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EAAC;EAAAtB,aAAA,GAAAK,CAAA;EAEvC,IAAI;IACF,MAAMkB,OAAO;IAAA;IAAA,CAAAvB,aAAA,GAAAK,CAAA,QAAGD,cAAA,CAAAoB,OAAG,CAACC,MAAM,CAACJ,KAAK,EAAEb,KAAA,CAAAkB,YAAY,CAAC;IAC/C;IAAA;IAAA1B,aAAA,GAAAK,CAAA;IACCI,GAAW,CAACkB,IAAI,GAAGJ,OAAO;IAAC;IAAAvB,aAAA,GAAAK,CAAA;IAC5BM,IAAI,EAAE;EACR,CAAC,CAAC,OAAOiB,GAAG,EAAE;IAAA;IAAA5B,aAAA,GAAAK,CAAA;IACZK,GAAG,CAACQ,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE;IAA2B,CAAE,CAAC;EAChE;AACF","ignoreList":[]}