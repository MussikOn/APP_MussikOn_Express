fd2a37634e4669121f5592133116ba77
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Firebase
jest.mock('../utils/firebase', () => ({
    db: {
        collection: jest.fn(),
    },
}));
// Mock S3 upload
jest.mock('../utils/idriveE2', () => ({
    uploadToS3: jest.fn(),
}));
// Mock logger
jest.mock('../services/loggerService', () => ({
    logger: {
        info: jest.fn(),
        error: jest.fn(),
        warn: jest.fn()
    }
}));
const paymentSystemService_1 = require("../services/paymentSystemService");
const firebase_1 = require("../utils/firebase");
const idriveE2_1 = require("../utils/idriveE2");
describe('PaymentSystemService', () => {
    let paymentService;
    let mockFirestore;
    let mockCollection;
    let mockDoc;
    beforeEach(() => {
        paymentService = new paymentSystemService_1.PaymentSystemService();
        mockDoc = {
            get: jest.fn(),
            set: jest.fn(),
            update: jest.fn(),
            exists: false,
            data: jest.fn()
        };
        mockCollection = {
            doc: jest.fn().mockReturnValue(mockDoc),
            where: jest.fn().mockReturnThis(),
            get: jest.fn(),
            set: jest.fn(),
            update: jest.fn(),
            add: jest.fn(),
            orderBy: jest.fn().mockReturnThis(),
            limit: jest.fn().mockReturnThis(),
            exists: false,
            data: jest.fn(),
            size: 0,
            docs: []
        };
        // Configurar mocks para que funcionen correctamente
        firebase_1.db.collection.mockReturnValue(mockCollection);
        firebase_1.db.doc = jest.fn().mockReturnValue(mockDoc);
        // Configurar mockDoc.get para que retorne el mockDoc
        mockDoc.get.mockResolvedValue(mockDoc);
        // Configurar mockCollection.get para que retorne un objeto con docs
        mockCollection.get.mockResolvedValue({
            docs: [],
            size: 0
        });
        jest.clearAllMocks();
    });
    describe('getUserBalance', () => {
        it('should return existing user balance', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockBalance = {
                userId,
                balance: 1000,
                currency: 'RD$',
                lastUpdated: new Date().toISOString(),
                totalDeposits: 2000,
                totalEarnings: 1500,
                totalWithdrawals: 500
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockBalance);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.getUserBalance(userId);
            // Assert
            expect(mockCollection.doc).toHaveBeenCalledWith(userId);
            expect(mockDoc.get).toHaveBeenCalled();
            expect(result).toEqual(mockBalance);
        }));
        it('should create initial balance when user has no balance', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            mockDoc.exists = false;
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.getUserBalance(userId);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith({
                userId,
                balance: 0,
                currency: 'RD$',
                lastUpdated: expect.any(String),
                totalDeposits: 0,
                totalWithdrawals: 0,
                totalEarnings: 0
            });
            expect(result.balance).toBe(0);
            expect(result.currency).toBe('RD$');
        }));
    });
    describe('registerBankAccount', () => {
        it('should register bank account successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const accountData = {
                accountHolder: 'John Doe',
                accountNumber: '1234567890',
                accountType: 'savings',
                bankName: 'Banco Popular',
                routingNumber: '123456789'
            };
            mockCollection.get.mockResolvedValue({
                docs: [],
                size: 0
            });
            // Act
            const result = yield paymentService.registerBankAccount(userId, accountData);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining(Object.assign(Object.assign({ userId }, accountData), { isVerified: false, isDefault: false })));
            expect(result.isDefault).toBe(false);
        }));
        it('should set first account as default', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const accountData = {
                accountHolder: 'John Doe',
                accountNumber: '1234567890',
                accountType: 'savings',
                bankName: 'Banco Popular',
                routingNumber: '123456789'
            };
            mockCollection.get.mockResolvedValue({
                docs: [{
                        data: () => ({ id: 'existing_account' }),
                        id: 'existing_account'
                    }],
                size: 1
            });
            // Act
            const result = yield paymentService.registerBankAccount(userId, accountData);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith({ isDefault: true });
            expect(result.isDefault).toBe(true);
        }));
    });
    describe('getUserBankAccounts', () => {
        it('should return user bank accounts with optimized query', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockAccounts = [
                {
                    id: 'bank1',
                    userId,
                    accountHolder: 'John Doe',
                    accountNumber: '1234567890',
                    accountType: 'savings',
                    bankName: 'Banco Popular',
                    routingNumber: '123456789',
                    isVerified: true,
                    isDefault: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockAccounts.map(account => ({
                    data: () => account,
                    id: account.id
                })),
                size: mockAccounts.length
            });
            // Act
            const result = yield paymentService.getUserBankAccounts(userId);
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('userId', '==', userId);
            expect(mockCollection.orderBy).toHaveBeenCalledWith('isDefault', 'desc');
            expect(result).toEqual(mockAccounts);
        }));
        it('should fallback to memory sorting when index is not available', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            mockCollection.get.mockRejectedValue(new Error('Index not available'));
            // Act & Assert
            yield expect(paymentService.getUserBankAccounts(userId)).rejects.toThrow('Error obteniendo cuentas bancarias');
        }));
    });
    describe('uploadDepositVoucher', () => {
        it('should upload deposit voucher successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const depositData = {
                amount: 1000,
                voucherFile: {
                    fieldname: 'voucher',
                    originalname: 'voucher.jpg',
                    encoding: '7bit',
                    mimetype: 'image/jpeg',
                    buffer: Buffer.from('test'),
                    size: 1024,
                    stream: {},
                    destination: '',
                    filename: 'voucher.jpg',
                    path: ''
                },
                accountHolderName: 'Juan PÃ©rez',
                bankName: 'Banco Popular'
            };
            const mockS3Url = 'https://s3.amazonaws.com/voucher.jpg';
            idriveE2_1.uploadToS3.mockResolvedValue(mockS3Url);
            // Act
            const result = yield paymentService.uploadDepositVoucher(userId, depositData);
            // Assert
            expect(idriveE2_1.uploadToS3).toHaveBeenCalledWith(depositData.voucherFile.buffer, 'voucher.jpg', 'image/jpeg', 'deposits');
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining({
                userId,
                amount: depositData.amount,
                status: 'pending',
                accountHolderName: depositData.accountHolderName,
                bankName: depositData.bankName
            }));
            expect(result.status).toBe('pending');
        }));
    });
    describe('verifyDeposit', () => {
        it('should verify deposit successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const depositId = 'deposit123';
            const adminId = 'admin123';
            const approved = true;
            const notes = 'DepÃ³sito verificado';
            const verificationData = {
                bankDepositDate: '2024-01-15',
                bankDepositTime: '14:30',
                referenceNumber: 'REF123456',
                accountLastFourDigits: '1234',
                verifiedBy: 'admin123'
            };
            const mockDeposit = {
                id: depositId,
                userId: 'user123',
                amount: 1000,
                status: 'pending'
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockDeposit);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            yield paymentService.verifyDeposit(depositId, adminId, approved, notes, verificationData);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith(expect.objectContaining({
                status: 'approved',
                verifiedBy: adminId,
                verifiedAt: expect.any(String),
                notes,
                verificationData
            }));
        }));
        it('should reject deposit successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const depositId = 'deposit123';
            const adminId = 'admin123';
            const approved = false;
            const notes = 'Comprobante invÃ¡lido';
            const mockDeposit = {
                id: depositId,
                userId: 'user123',
                amount: 1000,
                status: 'pending'
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockDeposit);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            yield paymentService.verifyDeposit(depositId, adminId, approved, notes);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith(expect.objectContaining({
                status: 'rejected',
                verifiedBy: adminId,
                verifiedAt: expect.any(String),
                notes
            }));
        }));
    });
    describe('processEventPayment', () => {
        it('should process event payment successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const paymentData = {
                eventId: 'event123',
                organizerId: 'organizer123',
                musicianId: 'musician123',
                amount: 500,
                paymentMethod: 'balance',
                description: 'Pago por evento'
            };
            const mockBalance = {
                userId: 'organizer123',
                balance: 1000,
                currency: 'RD$',
                lastUpdated: new Date().toISOString(),
                totalDeposits: 2000,
                totalEarnings: 0,
                totalWithdrawals: 0
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockBalance);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.processEventPayment(paymentData);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining({
                eventId: paymentData.eventId,
                organizerId: paymentData.organizerId,
                musicianId: paymentData.musicianId,
                amount: paymentData.amount,
                status: 'completed'
            }));
            expect(result.status).toBe('completed');
        }));
    });
    describe('requestWithdrawal', () => {
        it('should request withdrawal successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const musicianId = 'musician123';
            const withdrawalData = {
                amount: 200,
                bankAccountId: 'bank123',
                description: 'Retiro de ganancias'
            };
            const mockEarnings = {
                totalEarnings: 500,
                availableBalance: 300
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockEarnings);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.requestWithdrawal(musicianId, withdrawalData);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining({
                musicianId,
                amount: withdrawalData.amount,
                bankAccountId: withdrawalData.bankAccountId,
                status: 'pending'
            }));
            expect(result.status).toBe('pending');
        }));
    });
    describe('processWithdrawal', () => {
        it('should process withdrawal successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const withdrawalId = 'withdrawal123';
            const adminId = 'admin123';
            const approved = true;
            const notes = 'Retiro aprobado';
            const mockWithdrawal = {
                id: withdrawalId,
                musicianId: 'musician123',
                amount: 200,
                status: 'pending'
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockWithdrawal);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            yield paymentService.processWithdrawal(withdrawalId, adminId, approved, notes);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith(expect.objectContaining({
                status: 'approved',
                processedBy: adminId,
                processedAt: expect.any(String),
                notes
            }));
        }));
    });
    describe('getPaymentStatistics', () => {
        it('should return payment statistics', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockStats = {
                totalUsers: 100,
                totalMusicians: 50,
                totalEvents: 200,
                totalRevenue: 50000,
                totalCommissions: 5000,
                averageEventValue: 250,
                monthlyGrowth: 15.5
            };
            mockCollection.get.mockResolvedValue({
                docs: [],
                size: 100
            });
            // Act
            const result = yield paymentService.getPaymentStatistics();
            // Assert
            expect(result).toEqual(expect.objectContaining({
                totalUsers: expect.any(Number),
                totalMusicians: expect.any(Number),
                totalEvents: expect.any(Number)
            }));
        }));
    });
    describe('getPendingDeposits', () => {
        it('should return pending deposits', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockDeposits = [
                {
                    id: 'deposit1',
                    userId: 'user123',
                    amount: 1000,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockDeposits.map(deposit => ({
                    data: () => deposit,
                    id: deposit.id
                })),
                size: mockDeposits.length
            });
            // Act
            const result = yield paymentService.getPendingDeposits();
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('status', '==', 'pending');
            expect(mockCollection.orderBy).toHaveBeenCalledWith('createdAt', 'desc');
            expect(result).toEqual(mockDeposits);
        }));
    });
    describe('getPendingWithdrawals', () => {
        it('should return pending withdrawals', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockWithdrawals = [
                {
                    id: 'withdrawal1',
                    musicianId: 'musician123',
                    amount: 200,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockWithdrawals.map(withdrawal => ({
                    data: () => withdrawal,
                    id: withdrawal.id
                })),
                size: mockWithdrawals.length
            });
            // Act
            const result = yield paymentService.getPendingWithdrawals();
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('status', '==', 'pending');
            expect(mockCollection.orderBy).toHaveBeenCalledWith('createdAt', 'desc');
            expect(result).toEqual(mockWithdrawals);
        }));
    });
    describe('getMusicianEarnings', () => {
        it('should return musician earnings', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const musicianId = 'musician123';
            const mockEarnings = [
                {
                    id: 'earning1',
                    musicianId,
                    eventId: 'event123',
                    amount: 500,
                    commission: 50,
                    netAmount: 450,
                    createdAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockEarnings.map(earning => ({
                    data: () => earning,
                    id: earning.id
                })),
                size: mockEarnings.length
            });
            // Act
            const result = yield paymentService.getMusicianEarnings(musicianId);
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('musicianId', '==', musicianId);
            expect(mockCollection.orderBy).toHaveBeenCalledWith('createdAt', 'desc');
            expect(result).toEqual(mockEarnings);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHBheW1lbnRTeXN0ZW1TZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFJQSxnQkFBZ0I7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLEVBQUUsRUFBRTtRQUNGLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3RCO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSixpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBRUosY0FBYztBQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM1QyxNQUFNLEVBQUU7UUFDTixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2hCO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUF2QkosMkVBQXdFO0FBQ3hFLGdEQUF1QztBQUN2QyxnREFBK0M7QUF1Qi9DLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsSUFBSSxjQUFvQyxDQUFDO0lBQ3pDLElBQUksYUFBa0IsQ0FBQztJQUN2QixJQUFJLGNBQW1CLENBQUM7SUFDeEIsSUFBSSxPQUFZLENBQUM7SUFFakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGNBQWMsR0FBRyxJQUFJLDJDQUFvQixFQUFFLENBQUM7UUFFNUMsT0FBTyxHQUFHO1lBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZCxHQUFH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O2FBQzFCLENBQUMsQ0FBQztZQUVILE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLGNBQWMsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUVwRSxTQUFTO1lBQ1QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ2xGLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3pFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHBheW1lbnRTeXN0ZW1TZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGF5bWVudFN5c3RlbVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9wYXltZW50U3lzdGVtU2VydmljZSc7XHJcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vdXRpbHMvZmlyZWJhc2UnO1xyXG5pbXBvcnQgeyB1cGxvYWRUb1MzIH0gZnJvbSAnLi4vdXRpbHMvaWRyaXZlRTInO1xyXG5cclxuLy8gTW9jayBGaXJlYmFzZVxyXG5qZXN0Lm1vY2soJy4uL3V0aWxzL2ZpcmViYXNlJywgKCkgPT4gKHtcclxuICBkYjoge1xyXG4gICAgY29sbGVjdGlvbjogamVzdC5mbigpLFxyXG4gIH0sXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgUzMgdXBsb2FkXHJcbmplc3QubW9jaygnLi4vdXRpbHMvaWRyaXZlRTInLCAoKSA9PiAoe1xyXG4gIHVwbG9hZFRvUzM6IGplc3QuZm4oKSxcclxufSkpO1xyXG5cclxuLy8gTW9jayBsb2dnZXJcclxuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9sb2dnZXJTZXJ2aWNlJywgKCkgPT4gKHtcclxuICBsb2dnZXI6IHtcclxuICAgIGluZm86IGplc3QuZm4oKSxcclxuICAgIGVycm9yOiBqZXN0LmZuKCksXHJcbiAgICB3YXJuOiBqZXN0LmZuKClcclxuICB9XHJcbn0pKTtcclxuXHJcbmRlc2NyaWJlKCdQYXltZW50U3lzdGVtU2VydmljZScsICgpID0+IHtcclxuICBsZXQgcGF5bWVudFNlcnZpY2U6IFBheW1lbnRTeXN0ZW1TZXJ2aWNlO1xyXG4gIGxldCBtb2NrRmlyZXN0b3JlOiBhbnk7XHJcbiAgbGV0IG1vY2tDb2xsZWN0aW9uOiBhbnk7XHJcbiAgbGV0IG1vY2tEb2M6IGFueTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBwYXltZW50U2VydmljZSA9IG5ldyBQYXltZW50U3lzdGVtU2VydmljZSgpO1xyXG4gICAgXHJcbiAgICBtb2NrRG9jID0ge1xyXG4gICAgICBnZXQ6IGplc3QuZm4oKSxcclxuICAgICAgc2V0OiBqZXN0LmZuKCksXHJcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxyXG4gICAgICBleGlzdHM6IGZhbHNlLFxyXG4gICAgICBkYXRhOiBqZXN0LmZuKClcclxuICAgIH07XHJcblxyXG4gICAgbW9ja0NvbGxlY3Rpb24gPSB7XHJcbiAgICAgIGRvYzogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrRG9jKSxcclxuICAgICAgd2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBnZXQ6IGplc3QuZm4oKSxcclxuICAgICAgc2V0OiBqZXN0LmZuKCksXHJcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxyXG4gICAgICBhZGQ6IGplc3QuZm4oKSxcclxuICAgICAgb3JkZXJCeTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGxpbWl0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgZXhpc3RzOiBmYWxzZSxcclxuICAgICAgZGF0YTogamVzdC5mbigpLFxyXG4gICAgICBzaXplOiAwLFxyXG4gICAgICBkb2NzOiBbXVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBDb25maWd1cmFyIG1vY2tzIHBhcmEgcXVlIGZ1bmNpb25lbiBjb3JyZWN0YW1lbnRlXHJcbiAgICAoZGIuY29sbGVjdGlvbiBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShtb2NrQ29sbGVjdGlvbik7XHJcbiAgICAoZGIgYXMgYW55KS5kb2MgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tEb2MpO1xyXG4gICAgXHJcbiAgICAvLyBDb25maWd1cmFyIG1vY2tEb2MuZ2V0IHBhcmEgcXVlIHJldG9ybmUgZWwgbW9ja0RvY1xyXG4gICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XHJcbiAgICBcclxuICAgIC8vIENvbmZpZ3VyYXIgbW9ja0NvbGxlY3Rpb24uZ2V0IHBhcmEgcXVlIHJldG9ybmUgdW4gb2JqZXRvIGNvbiBkb2NzXHJcbiAgICBtb2NrQ29sbGVjdGlvbi5nZXQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICBkb2NzOiBbXSxcclxuICAgICAgc2l6ZTogMFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0VXNlckJhbGFuY2UnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBleGlzdGluZyB1c2VyIGJhbGFuY2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxMjMnO1xyXG4gICAgICBjb25zdCBtb2NrQmFsYW5jZSA9IHtcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgYmFsYW5jZTogMTAwMCxcclxuICAgICAgICBjdXJyZW5jeTogJ1JEJCcsXHJcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB0b3RhbERlcG9zaXRzOiAyMDAwLFxyXG4gICAgICAgIHRvdGFsRWFybmluZ3M6IDE1MDAsXHJcbiAgICAgICAgdG90YWxXaXRoZHJhd2FsczogNTAwXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrRG9jLmV4aXN0cyA9IHRydWU7XHJcbiAgICAgIG1vY2tEb2MuZGF0YS5tb2NrUmV0dXJuVmFsdWUobW9ja0JhbGFuY2UpO1xyXG4gICAgICBtb2NrRG9jLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRG9jKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS5nZXRVc2VyQmFsYW5jZSh1c2VySWQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi5kb2MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJJZCk7XHJcbiAgICAgIGV4cGVjdChtb2NrRG9jLmdldCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tCYWxhbmNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGluaXRpYWwgYmFsYW5jZSB3aGVuIHVzZXIgaGFzIG5vIGJhbGFuY2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxMjMnO1xyXG4gICAgICBtb2NrRG9jLmV4aXN0cyA9IGZhbHNlO1xyXG4gICAgICBtb2NrRG9jLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRG9jKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS5nZXRVc2VyQmFsYW5jZSh1c2VySWQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrRG9jLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgICBiYWxhbmNlOiAwLFxyXG4gICAgICAgIGN1cnJlbmN5OiAnUkQkJyxcclxuICAgICAgICBsYXN0VXBkYXRlZDogZXhwZWN0LmFueShTdHJpbmcpLFxyXG4gICAgICAgIHRvdGFsRGVwb3NpdHM6IDAsXHJcbiAgICAgICAgdG90YWxXaXRoZHJhd2FsczogMCxcclxuICAgICAgICB0b3RhbEVhcm5pbmdzOiAwXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmJhbGFuY2UpLnRvQmUoMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY3VycmVuY3kpLnRvQmUoJ1JEJCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZWdpc3RlckJhbmtBY2NvdW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZWdpc3RlciBiYW5rIGFjY291bnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMTIzJztcclxuICAgICAgY29uc3QgYWNjb3VudERhdGEgPSB7XHJcbiAgICAgICAgYWNjb3VudEhvbGRlcjogJ0pvaG4gRG9lJyxcclxuICAgICAgICBhY2NvdW50TnVtYmVyOiAnMTIzNDU2Nzg5MCcsXHJcbiAgICAgICAgYWNjb3VudFR5cGU6ICdzYXZpbmdzJyBhcyBjb25zdCxcclxuICAgICAgICBiYW5rTmFtZTogJ0JhbmNvIFBvcHVsYXInLFxyXG4gICAgICAgIHJvdXRpbmdOdW1iZXI6ICcxMjM0NTY3ODknXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrQ29sbGVjdGlvbi5nZXQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRvY3M6IFtdLFxyXG4gICAgICAgIHNpemU6IDBcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGF5bWVudFNlcnZpY2UucmVnaXN0ZXJCYW5rQWNjb3VudCh1c2VySWQsIGFjY291bnREYXRhKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0RvYy5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgLi4uYWNjb3VudERhdGEsXHJcbiAgICAgICAgaXNWZXJpZmllZDogZmFsc2UsXHJcbiAgICAgICAgaXNEZWZhdWx0OiBmYWxzZVxyXG4gICAgICB9KSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNEZWZhdWx0KS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc2V0IGZpcnN0IGFjY291bnQgYXMgZGVmYXVsdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XHJcbiAgICAgIGNvbnN0IGFjY291bnREYXRhID0ge1xyXG4gICAgICAgIGFjY291bnRIb2xkZXI6ICdKb2huIERvZScsXHJcbiAgICAgICAgYWNjb3VudE51bWJlcjogJzEyMzQ1Njc4OTAnLFxyXG4gICAgICAgIGFjY291bnRUeXBlOiAnc2F2aW5ncycgYXMgY29uc3QsXHJcbiAgICAgICAgYmFua05hbWU6ICdCYW5jbyBQb3B1bGFyJyxcclxuICAgICAgICByb3V0aW5nTnVtYmVyOiAnMTIzNDU2Nzg5J1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkb2NzOiBbe1xyXG4gICAgICAgICAgZGF0YTogKCkgPT4gKHsgaWQ6ICdleGlzdGluZ19hY2NvdW50JyB9KSxcclxuICAgICAgICAgIGlkOiAnZXhpc3RpbmdfYWNjb3VudCdcclxuICAgICAgICB9XSxcclxuICAgICAgICBzaXplOiAxXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLnJlZ2lzdGVyQmFua0FjY291bnQodXNlcklkLCBhY2NvdW50RGF0YSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tEb2MudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IGlzRGVmYXVsdDogdHJ1ZSB9KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc0RlZmF1bHQpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFVzZXJCYW5rQWNjb3VudHMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIGJhbmsgYWNjb3VudHMgd2l0aCBvcHRpbWl6ZWQgcXVlcnknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxMjMnO1xyXG4gICAgICBjb25zdCBtb2NrQWNjb3VudHMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdiYW5rMScsXHJcbiAgICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgICBhY2NvdW50SG9sZGVyOiAnSm9obiBEb2UnLFxyXG4gICAgICAgICAgYWNjb3VudE51bWJlcjogJzEyMzQ1Njc4OTAnLFxyXG4gICAgICAgICAgYWNjb3VudFR5cGU6ICdzYXZpbmdzJyBhcyBjb25zdCxcclxuICAgICAgICAgIGJhbmtOYW1lOiAnQmFuY28gUG9wdWxhcicsXHJcbiAgICAgICAgICByb3V0aW5nTnVtYmVyOiAnMTIzNDU2Nzg5JyxcclxuICAgICAgICAgIGlzVmVyaWZpZWQ6IHRydWUsXHJcbiAgICAgICAgICBpc0RlZmF1bHQ6IHRydWUsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkb2NzOiBtb2NrQWNjb3VudHMubWFwKGFjY291bnQgPT4gKHtcclxuICAgICAgICAgIGRhdGE6ICgpID0+IGFjY291bnQsXHJcbiAgICAgICAgICBpZDogYWNjb3VudC5pZFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgICBzaXplOiBtb2NrQWNjb3VudHMubGVuZ3RoXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFVzZXJCYW5rQWNjb3VudHModXNlcklkKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ud2hlcmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VySWQnLCAnPT0nLCB1c2VySWQpO1xyXG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ub3JkZXJCeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lzRGVmYXVsdCcsICdkZXNjJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0FjY291bnRzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZmFsbGJhY2sgdG8gbWVtb3J5IHNvcnRpbmcgd2hlbiBpbmRleCBpcyBub3QgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMTIzJztcclxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSW5kZXggbm90IGF2YWlsYWJsZScpKTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3QocGF5bWVudFNlcnZpY2UuZ2V0VXNlckJhbmtBY2NvdW50cyh1c2VySWQpKS5yZWplY3RzLnRvVGhyb3coJ0Vycm9yIG9idGVuaWVuZG8gY3VlbnRhcyBiYW5jYXJpYXMnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBsb2FkRGVwb3NpdFZvdWNoZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHVwbG9hZCBkZXBvc2l0IHZvdWNoZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMTIzJztcclxuICAgICAgY29uc3QgZGVwb3NpdERhdGEgPSB7XHJcbiAgICAgICAgYW1vdW50OiAxMDAwLFxyXG4gICAgICAgIHZvdWNoZXJGaWxlOiB7XHJcbiAgICAgICAgICBmaWVsZG5hbWU6ICd2b3VjaGVyJyxcclxuICAgICAgICAgIG9yaWdpbmFsbmFtZTogJ3ZvdWNoZXIuanBnJyxcclxuICAgICAgICAgIGVuY29kaW5nOiAnN2JpdCcsXHJcbiAgICAgICAgICBtaW1ldHlwZTogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgndGVzdCcpLFxyXG4gICAgICAgICAgc2l6ZTogMTAyNCxcclxuICAgICAgICAgIHN0cmVhbToge30gYXMgYW55LFxyXG4gICAgICAgICAgZGVzdGluYXRpb246ICcnLFxyXG4gICAgICAgICAgZmlsZW5hbWU6ICd2b3VjaGVyLmpwZycsXHJcbiAgICAgICAgICBwYXRoOiAnJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWNjb3VudEhvbGRlck5hbWU6ICdKdWFuIFDDqXJleicsXHJcbiAgICAgICAgYmFua05hbWU6ICdCYW5jbyBQb3B1bGFyJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgbW9ja1MzVXJsID0gJ2h0dHBzOi8vczMuYW1hem9uYXdzLmNvbS92b3VjaGVyLmpwZyc7XHJcbiAgICAgICh1cGxvYWRUb1MzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1MzVXJsKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS51cGxvYWREZXBvc2l0Vm91Y2hlcih1c2VySWQsIGRlcG9zaXREYXRhKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QodXBsb2FkVG9TMykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZGVwb3NpdERhdGEudm91Y2hlckZpbGUuYnVmZmVyLFxyXG4gICAgICAgICd2b3VjaGVyLmpwZycsXHJcbiAgICAgICAgJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICdkZXBvc2l0cydcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KG1vY2tEb2Muc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIGFtb3VudDogZGVwb3NpdERhdGEuYW1vdW50LFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGFjY291bnRIb2xkZXJOYW1lOiBkZXBvc2l0RGF0YS5hY2NvdW50SG9sZGVyTmFtZSxcclxuICAgICAgICBiYW5rTmFtZTogZGVwb3NpdERhdGEuYmFua05hbWVcclxuICAgICAgfSkpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZSgncGVuZGluZycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd2ZXJpZnlEZXBvc2l0JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgZGVwb3NpdCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGVwb3NpdElkID0gJ2RlcG9zaXQxMjMnO1xyXG4gICAgICBjb25zdCBhZG1pbklkID0gJ2FkbWluMTIzJztcclxuICAgICAgY29uc3QgYXBwcm92ZWQgPSB0cnVlO1xyXG4gICAgICBjb25zdCBub3RlcyA9ICdEZXDDs3NpdG8gdmVyaWZpY2Fkbyc7XHJcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkRhdGEgPSB7XHJcbiAgICAgICAgYmFua0RlcG9zaXREYXRlOiAnMjAyNC0wMS0xNScsXHJcbiAgICAgICAgYmFua0RlcG9zaXRUaW1lOiAnMTQ6MzAnLFxyXG4gICAgICAgIHJlZmVyZW5jZU51bWJlcjogJ1JFRjEyMzQ1NicsXHJcbiAgICAgICAgYWNjb3VudExhc3RGb3VyRGlnaXRzOiAnMTIzNCcsXHJcbiAgICAgICAgdmVyaWZpZWRCeTogJ2FkbWluMTIzJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgbW9ja0RlcG9zaXQgPSB7XHJcbiAgICAgICAgaWQ6IGRlcG9zaXRJZCxcclxuICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICBhbW91bnQ6IDEwMDAsXHJcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tEb2MuZXhpc3RzID0gdHJ1ZTtcclxuICAgICAgbW9ja0RvYy5kYXRhLm1vY2tSZXR1cm5WYWx1ZShtb2NrRGVwb3NpdCk7XHJcbiAgICAgIG1vY2tEb2MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEb2MpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IHBheW1lbnRTZXJ2aWNlLnZlcmlmeURlcG9zaXQoZGVwb3NpdElkLCBhZG1pbklkLCBhcHByb3ZlZCwgbm90ZXMsIHZlcmlmaWNhdGlvbkRhdGEpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrRG9jLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIHN0YXR1czogJ2FwcHJvdmVkJyxcclxuICAgICAgICB2ZXJpZmllZEJ5OiBhZG1pbklkLFxyXG4gICAgICAgIHZlcmlmaWVkQXQ6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICBub3RlcyxcclxuICAgICAgICB2ZXJpZmljYXRpb25EYXRhXHJcbiAgICAgIH0pKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGRlcG9zaXQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGRlcG9zaXRJZCA9ICdkZXBvc2l0MTIzJztcclxuICAgICAgY29uc3QgYWRtaW5JZCA9ICdhZG1pbjEyMyc7XHJcbiAgICAgIGNvbnN0IGFwcHJvdmVkID0gZmFsc2U7XHJcbiAgICAgIGNvbnN0IG5vdGVzID0gJ0NvbXByb2JhbnRlIGludsOhbGlkbyc7XHJcblxyXG4gICAgICBjb25zdCBtb2NrRGVwb3NpdCA9IHtcclxuICAgICAgICBpZDogZGVwb3NpdElkLFxyXG4gICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgIGFtb3VudDogMTAwMCxcclxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0RvYy5leGlzdHMgPSB0cnVlO1xyXG4gICAgICBtb2NrRG9jLmRhdGEubW9ja1JldHVyblZhbHVlKG1vY2tEZXBvc2l0KTtcclxuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgcGF5bWVudFNlcnZpY2UudmVyaWZ5RGVwb3NpdChkZXBvc2l0SWQsIGFkbWluSWQsIGFwcHJvdmVkLCBub3Rlcyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tEb2MudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgc3RhdHVzOiAncmVqZWN0ZWQnLFxyXG4gICAgICAgIHZlcmlmaWVkQnk6IGFkbWluSWQsXHJcbiAgICAgICAgdmVyaWZpZWRBdDogZXhwZWN0LmFueShTdHJpbmcpLFxyXG4gICAgICAgIG5vdGVzXHJcbiAgICAgIH0pKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncHJvY2Vzc0V2ZW50UGF5bWVudCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcHJvY2VzcyBldmVudCBwYXltZW50IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBwYXltZW50RGF0YSA9IHtcclxuICAgICAgICBldmVudElkOiAnZXZlbnQxMjMnLFxyXG4gICAgICAgIG9yZ2FuaXplcklkOiAnb3JnYW5pemVyMTIzJyxcclxuICAgICAgICBtdXNpY2lhbklkOiAnbXVzaWNpYW4xMjMnLFxyXG4gICAgICAgIGFtb3VudDogNTAwLFxyXG4gICAgICAgIHBheW1lbnRNZXRob2Q6ICdiYWxhbmNlJyBhcyBjb25zdCxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ1BhZ28gcG9yIGV2ZW50bydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tCYWxhbmNlID0ge1xyXG4gICAgICAgIHVzZXJJZDogJ29yZ2FuaXplcjEyMycsXHJcbiAgICAgICAgYmFsYW5jZTogMTAwMCxcclxuICAgICAgICBjdXJyZW5jeTogJ1JEJCcsXHJcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB0b3RhbERlcG9zaXRzOiAyMDAwLFxyXG4gICAgICAgIHRvdGFsRWFybmluZ3M6IDAsXHJcbiAgICAgICAgdG90YWxXaXRoZHJhd2FsczogMFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0RvYy5leGlzdHMgPSB0cnVlO1xyXG4gICAgICBtb2NrRG9jLmRhdGEubW9ja1JldHVyblZhbHVlKG1vY2tCYWxhbmNlKTtcclxuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGF5bWVudFNlcnZpY2UucHJvY2Vzc0V2ZW50UGF5bWVudChwYXltZW50RGF0YSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KG1vY2tEb2Muc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgZXZlbnRJZDogcGF5bWVudERhdGEuZXZlbnRJZCxcclxuICAgICAgICBvcmdhbml6ZXJJZDogcGF5bWVudERhdGEub3JnYW5pemVySWQsXHJcbiAgICAgICAgbXVzaWNpYW5JZDogcGF5bWVudERhdGEubXVzaWNpYW5JZCxcclxuICAgICAgICBhbW91bnQ6IHBheW1lbnREYXRhLmFtb3VudCxcclxuICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnXHJcbiAgICAgIH0pKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoJ2NvbXBsZXRlZCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZXF1ZXN0V2l0aGRyYXdhbCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmVxdWVzdCB3aXRoZHJhd2FsIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBtdXNpY2lhbklkID0gJ211c2ljaWFuMTIzJztcclxuICAgICAgY29uc3Qgd2l0aGRyYXdhbERhdGEgPSB7XHJcbiAgICAgICAgYW1vdW50OiAyMDAsXHJcbiAgICAgICAgYmFua0FjY291bnRJZDogJ2JhbmsxMjMnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmV0aXJvIGRlIGdhbmFuY2lhcydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tFYXJuaW5ncyA9IHtcclxuICAgICAgICB0b3RhbEVhcm5pbmdzOiA1MDAsXHJcbiAgICAgICAgYXZhaWxhYmxlQmFsYW5jZTogMzAwXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrRG9jLmV4aXN0cyA9IHRydWU7XHJcbiAgICAgIG1vY2tEb2MuZGF0YS5tb2NrUmV0dXJuVmFsdWUobW9ja0Vhcm5pbmdzKTtcclxuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGF5bWVudFNlcnZpY2UucmVxdWVzdFdpdGhkcmF3YWwobXVzaWNpYW5JZCwgd2l0aGRyYXdhbERhdGEpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrRG9jLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIG11c2ljaWFuSWQsXHJcbiAgICAgICAgYW1vdW50OiB3aXRoZHJhd2FsRGF0YS5hbW91bnQsXHJcbiAgICAgICAgYmFua0FjY291bnRJZDogd2l0aGRyYXdhbERhdGEuYmFua0FjY291bnRJZCxcclxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJ1xyXG4gICAgICB9KSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKCdwZW5kaW5nJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3Byb2Nlc3NXaXRoZHJhd2FsJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBwcm9jZXNzIHdpdGhkcmF3YWwgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHdpdGhkcmF3YWxJZCA9ICd3aXRoZHJhd2FsMTIzJztcclxuICAgICAgY29uc3QgYWRtaW5JZCA9ICdhZG1pbjEyMyc7XHJcbiAgICAgIGNvbnN0IGFwcHJvdmVkID0gdHJ1ZTtcclxuICAgICAgY29uc3Qgbm90ZXMgPSAnUmV0aXJvIGFwcm9iYWRvJztcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tXaXRoZHJhd2FsID0ge1xyXG4gICAgICAgIGlkOiB3aXRoZHJhd2FsSWQsXHJcbiAgICAgICAgbXVzaWNpYW5JZDogJ211c2ljaWFuMTIzJyxcclxuICAgICAgICBhbW91bnQ6IDIwMCxcclxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0RvYy5leGlzdHMgPSB0cnVlO1xyXG4gICAgICBtb2NrRG9jLmRhdGEubW9ja1JldHVyblZhbHVlKG1vY2tXaXRoZHJhd2FsKTtcclxuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgcGF5bWVudFNlcnZpY2UucHJvY2Vzc1dpdGhkcmF3YWwod2l0aGRyYXdhbElkLCBhZG1pbklkLCBhcHByb3ZlZCwgbm90ZXMpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrRG9jLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIHN0YXR1czogJ2FwcHJvdmVkJyxcclxuICAgICAgICBwcm9jZXNzZWRCeTogYWRtaW5JZCxcclxuICAgICAgICBwcm9jZXNzZWRBdDogZXhwZWN0LmFueShTdHJpbmcpLFxyXG4gICAgICAgIG5vdGVzXHJcbiAgICAgIH0pKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0UGF5bWVudFN0YXRpc3RpY3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwYXltZW50IHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xyXG4gICAgICAgIHRvdGFsVXNlcnM6IDEwMCxcclxuICAgICAgICB0b3RhbE11c2ljaWFuczogNTAsXHJcbiAgICAgICAgdG90YWxFdmVudHM6IDIwMCxcclxuICAgICAgICB0b3RhbFJldmVudWU6IDUwMDAwLFxyXG4gICAgICAgIHRvdGFsQ29tbWlzc2lvbnM6IDUwMDAsXHJcbiAgICAgICAgYXZlcmFnZUV2ZW50VmFsdWU6IDI1MCxcclxuICAgICAgICBtb250aGx5R3Jvd3RoOiAxNS41XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrQ29sbGVjdGlvbi5nZXQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRvY3M6IFtdLFxyXG4gICAgICAgIHNpemU6IDEwMFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS5nZXRQYXltZW50U3RhdGlzdGljcygpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIHRvdGFsVXNlcnM6IGV4cGVjdC5hbnkoTnVtYmVyKSxcclxuICAgICAgICB0b3RhbE11c2ljaWFuczogZXhwZWN0LmFueShOdW1iZXIpLFxyXG4gICAgICAgIHRvdGFsRXZlbnRzOiBleHBlY3QuYW55KE51bWJlcilcclxuICAgICAgfSkpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRQZW5kaW5nRGVwb3NpdHMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwZW5kaW5nIGRlcG9zaXRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IG1vY2tEZXBvc2l0cyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogJ2RlcG9zaXQxJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgYW1vdW50OiAxMDAwLFxyXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuXHJcbiAgICAgIG1vY2tDb2xsZWN0aW9uLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZG9jczogbW9ja0RlcG9zaXRzLm1hcChkZXBvc2l0ID0+ICh7XHJcbiAgICAgICAgICBkYXRhOiAoKSA9PiBkZXBvc2l0LFxyXG4gICAgICAgICAgaWQ6IGRlcG9zaXQuaWRcclxuICAgICAgICB9KSksXHJcbiAgICAgICAgc2l6ZTogbW9ja0RlcG9zaXRzLmxlbmd0aFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS5nZXRQZW5kaW5nRGVwb3NpdHMoKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ud2hlcmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdGF0dXMnLCAnPT0nLCAncGVuZGluZycpO1xyXG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ub3JkZXJCeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NyZWF0ZWRBdCcsICdkZXNjJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0RlcG9zaXRzKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0UGVuZGluZ1dpdGhkcmF3YWxzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcGVuZGluZyB3aXRoZHJhd2FscycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBtb2NrV2l0aGRyYXdhbHMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICd3aXRoZHJhd2FsMScsXHJcbiAgICAgICAgICBtdXNpY2lhbklkOiAnbXVzaWNpYW4xMjMnLFxyXG4gICAgICAgICAgYW1vdW50OiAyMDAsXHJcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkb2NzOiBtb2NrV2l0aGRyYXdhbHMubWFwKHdpdGhkcmF3YWwgPT4gKHtcclxuICAgICAgICAgIGRhdGE6ICgpID0+IHdpdGhkcmF3YWwsXHJcbiAgICAgICAgICBpZDogd2l0aGRyYXdhbC5pZFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgICBzaXplOiBtb2NrV2l0aGRyYXdhbHMubGVuZ3RoXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFBlbmRpbmdXaXRoZHJhd2FscygpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi53aGVyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0YXR1cycsICc9PScsICdwZW5kaW5nJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi5vcmRlckJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY3JlYXRlZEF0JywgJ2Rlc2MnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrV2l0aGRyYXdhbHMpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRNdXNpY2lhbkVhcm5pbmdzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbXVzaWNpYW4gZWFybmluZ3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgbXVzaWNpYW5JZCA9ICdtdXNpY2lhbjEyMyc7XHJcbiAgICAgIGNvbnN0IG1vY2tFYXJuaW5ncyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogJ2Vhcm5pbmcxJyxcclxuICAgICAgICAgIG11c2ljaWFuSWQsXHJcbiAgICAgICAgICBldmVudElkOiAnZXZlbnQxMjMnLFxyXG4gICAgICAgICAgYW1vdW50OiA1MDAsXHJcbiAgICAgICAgICBjb21taXNzaW9uOiA1MCxcclxuICAgICAgICAgIG5ldEFtb3VudDogNDUwLFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrQ29sbGVjdGlvbi5nZXQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRvY3M6IG1vY2tFYXJuaW5ncy5tYXAoZWFybmluZyA9PiAoe1xyXG4gICAgICAgICAgZGF0YTogKCkgPT4gZWFybmluZyxcclxuICAgICAgICAgIGlkOiBlYXJuaW5nLmlkXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICAgIHNpemU6IG1vY2tFYXJuaW5ncy5sZW5ndGhcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGF5bWVudFNlcnZpY2UuZ2V0TXVzaWNpYW5FYXJuaW5ncyhtdXNpY2lhbklkKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ud2hlcmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdtdXNpY2lhbklkJywgJz09JywgbXVzaWNpYW5JZCk7XHJcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi5vcmRlckJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY3JlYXRlZEF0JywgJ2Rlc2MnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRWFybmluZ3MpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyAiXSwidmVyc2lvbiI6M30=