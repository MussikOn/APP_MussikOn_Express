1a4383a3e5dac21eb6f362be32439cbb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Tests para el sistema de registro con verificación por email
const validationSchemas_1 = require("../utils/validationSchemas");
describe('Sistema de Registro con Verificación', () => {
    describe('Esquema de Registro de Músicos', () => {
        test('should validate correct musician registration data', () => {
            const validData = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'juan@example.com',
                userPassword: 'Password123!',
                roll: 'musico'
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(validData);
            expect(error).toBeUndefined();
        });
        test('should validate correct event creator registration data', () => {
            const validData = {
                name: 'María',
                lastName: 'García',
                userEmail: 'maria@example.com',
                userPassword: 'Password123!',
                roll: 'eventCreator'
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(validData);
            expect(error).toBeUndefined();
        });
        test('should reject invalid roll', () => {
            const invalidData = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'juan@example.com',
                userPassword: 'Password123!',
                roll: 'admin' // Rol no permitido
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(invalidData);
            expect(error).toBeDefined();
            expect(error === null || error === void 0 ? void 0 : error.details[0].path).toContain('roll');
        });
        test('should reject missing roll', () => {
            const invalidData = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'juan@example.com',
                userPassword: 'Password123!'
                // roll faltante
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(invalidData);
            expect(error).toBeDefined();
            expect(error === null || error === void 0 ? void 0 : error.details[0].path).toContain('roll');
        });
        test('should reject weak password', () => {
            const invalidData = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'juan@example.com',
                userPassword: '123', // Contraseña débil
                roll: 'musico'
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(invalidData);
            expect(error).toBeDefined();
            expect(error === null || error === void 0 ? void 0 : error.details[0].path).toContain('userPassword');
        });
        test('should reject invalid email', () => {
            const invalidData = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'invalid-email', // Email inválido
                userPassword: 'Password123!',
                roll: 'musico'
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(invalidData);
            expect(error).toBeDefined();
            expect(error === null || error === void 0 ? void 0 : error.details[0].path).toContain('userEmail');
        });
    });
    describe('Flujo de Registro', () => {
        test('should follow correct registration flow', () => {
            // 1. Usuario solicita verificación
            const registrationData = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'juan@example.com',
                userPassword: 'Password123!',
                roll: 'musico'
            };
            // 2. Validar datos de entrada
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(registrationData);
            expect(error).toBeUndefined();
            // 3. Simular envío de email (esto se probaría en integración)
            expect(registrationData.userEmail).toBe('juan@example.com');
            expect(registrationData.roll).toBe('musico');
            // 4. Simular verificación de código (esto se probaría en integración)
            const verificationData = {
                userEmail: 'juan@example.com',
                code: '123456'
            };
            expect(verificationData.userEmail).toBe(registrationData.userEmail);
            expect(verificationData.code).toHaveLength(6);
        });
    });
    describe('Validación de Roles', () => {
        test('should accept musico role', () => {
            const data = {
                name: 'Juan',
                lastName: 'Pérez',
                userEmail: 'juan@example.com',
                userPassword: 'Password123!',
                roll: 'musico'
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(data);
            expect(error).toBeUndefined();
        });
        test('should accept eventCreator role', () => {
            const data = {
                name: 'María',
                lastName: 'García',
                userEmail: 'maria@example.com',
                userPassword: 'Password123!',
                roll: 'eventCreator'
            };
            const { error } = validationSchemas_1.musicianRegisterSchema.validate(data);
            expect(error).toBeUndefined();
        });
        test('should reject other roles', () => {
            const invalidRoles = ['admin', 'superadmin', 'usuario', 'adminJunior'];
            invalidRoles.forEach(role => {
                const data = {
                    name: 'Juan',
                    lastName: 'Pérez',
                    userEmail: 'juan@example.com',
                    userPassword: 'Password123!',
                    roll: role
                };
                const { error } = validationSchemas_1.musicianRegisterSchema.validate(data);
                expect(error).toBeDefined();
                expect(error === null || error === void 0 ? void 0 : error.details[0].path).toContain('roll');
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHJlZ2lzdHJhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsK0RBQStEO0FBQy9ELGtFQUFvRTtBQUVwRSxRQUFRLENBQUMsc0NBQXNDLEVBQUUsR0FBRyxFQUFFO0lBQ3BELFFBQVEsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsSUFBSSxDQUFDLG9EQUFvRCxFQUFFLEdBQUcsRUFBRTtZQUM5RCxNQUFNLFNBQVMsR0FBRztnQkFDaEIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osUUFBUSxFQUFFLE9BQU87Z0JBQ2pCLFNBQVMsRUFBRSxrQkFBa0I7Z0JBQzdCLFlBQVksRUFBRSxjQUFjO2dCQUM1QixJQUFJLEVBQUUsUUFBUTthQUNmLENBQUM7WUFFRixNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsMENBQXNCLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyx5REFBeUQsRUFBRSxHQUFHLEVBQUU7WUFDbkUsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLElBQUksRUFBRSxPQUFPO2dCQUNiLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixTQUFTLEVBQUUsbUJBQW1CO2dCQUM5QixZQUFZLEVBQUUsY0FBYztnQkFDNUIsSUFBSSxFQUFFLGNBQWM7YUFDckIsQ0FBQztZQUVGLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRywwQ0FBc0IsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDN0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLFdBQVcsR0FBRztnQkFDbEIs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QyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNuRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcc3JjXFxBUFBfTXVzc2lrT25cXEFQUF9NdXNzaWtPbl9FeHByZXNzXFxzcmNcXF9fdGVzdHNfX1xccmVnaXN0cmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGVzdHMgcGFyYSBlbCBzaXN0ZW1hIGRlIHJlZ2lzdHJvIGNvbiB2ZXJpZmljYWNpw7NuIHBvciBlbWFpbFxyXG5pbXBvcnQgeyBtdXNpY2lhblJlZ2lzdGVyU2NoZW1hIH0gZnJvbSAnLi4vdXRpbHMvdmFsaWRhdGlvblNjaGVtYXMnO1xyXG5cclxuZGVzY3JpYmUoJ1Npc3RlbWEgZGUgUmVnaXN0cm8gY29uIFZlcmlmaWNhY2nDs24nLCAoKSA9PiB7XHJcbiAgZGVzY3JpYmUoJ0VzcXVlbWEgZGUgUmVnaXN0cm8gZGUgTcO6c2ljb3MnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgY29ycmVjdCBtdXNpY2lhbiByZWdpc3RyYXRpb24gZGF0YScsICgpID0+IHtcclxuICAgICAgY29uc3QgdmFsaWREYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICBsYXN0TmFtZTogJ1DDqXJleicsXHJcbiAgICAgICAgdXNlckVtYWlsOiAnanVhbkBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICByb2xsOiAnbXVzaWNvJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gbXVzaWNpYW5SZWdpc3RlclNjaGVtYS52YWxpZGF0ZSh2YWxpZERhdGEpO1xyXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBjb3JyZWN0IGV2ZW50IGNyZWF0b3IgcmVnaXN0cmF0aW9uIGRhdGEnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbGlkRGF0YSA9IHtcclxuICAgICAgICBuYW1lOiAnTWFyw61hJyxcclxuICAgICAgICBsYXN0TmFtZTogJ0dhcmPDrWEnLFxyXG4gICAgICAgIHVzZXJFbWFpbDogJ21hcmlhQGV4YW1wbGUuY29tJyxcclxuICAgICAgICB1c2VyUGFzc3dvcmQ6ICdQYXNzd29yZDEyMyEnLFxyXG4gICAgICAgIHJvbGw6ICdldmVudENyZWF0b3InXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBtdXNpY2lhblJlZ2lzdGVyU2NoZW1hLnZhbGlkYXRlKHZhbGlkRGF0YSk7XHJcbiAgICAgIGV4cGVjdChlcnJvcikudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIHJvbGwnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICBsYXN0TmFtZTogJ1DDqXJleicsXHJcbiAgICAgICAgdXNlckVtYWlsOiAnanVhbkBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICByb2xsOiAnYWRtaW4nIC8vIFJvbCBubyBwZXJtaXRpZG9cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IG11c2ljaWFuUmVnaXN0ZXJTY2hlbWEudmFsaWRhdGUoaW52YWxpZERhdGEpO1xyXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChlcnJvcj8uZGV0YWlsc1swXS5wYXRoKS50b0NvbnRhaW4oJ3JvbGwnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCByZWplY3QgbWlzc2luZyByb2xsJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcclxuICAgICAgICBuYW1lOiAnSnVhbicsXHJcbiAgICAgICAgbGFzdE5hbWU6ICdQw6lyZXonLFxyXG4gICAgICAgIHVzZXJFbWFpbDogJ2p1YW5AZXhhbXBsZS5jb20nLFxyXG4gICAgICAgIHVzZXJQYXNzd29yZDogJ1Bhc3N3b3JkMTIzISdcclxuICAgICAgICAvLyByb2xsIGZhbHRhbnRlXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBtdXNpY2lhblJlZ2lzdGVyU2NoZW1hLnZhbGlkYXRlKGludmFsaWREYXRhKTtcclxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoZXJyb3I/LmRldGFpbHNbMF0ucGF0aCkudG9Db250YWluKCdyb2xsJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgcmVqZWN0IHdlYWsgcGFzc3dvcmQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICBsYXN0TmFtZTogJ1DDqXJleicsXHJcbiAgICAgICAgdXNlckVtYWlsOiAnanVhbkBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgdXNlclBhc3N3b3JkOiAnMTIzJywgLy8gQ29udHJhc2XDsWEgZMOpYmlsXHJcbiAgICAgICAgcm9sbDogJ211c2ljbydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IG11c2ljaWFuUmVnaXN0ZXJTY2hlbWEudmFsaWRhdGUoaW52YWxpZERhdGEpO1xyXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChlcnJvcj8uZGV0YWlsc1swXS5wYXRoKS50b0NvbnRhaW4oJ3VzZXJQYXNzd29yZCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIGVtYWlsJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcclxuICAgICAgICBuYW1lOiAnSnVhbicsXHJcbiAgICAgICAgbGFzdE5hbWU6ICdQw6lyZXonLFxyXG4gICAgICAgIHVzZXJFbWFpbDogJ2ludmFsaWQtZW1haWwnLCAvLyBFbWFpbCBpbnbDoWxpZG9cclxuICAgICAgICB1c2VyUGFzc3dvcmQ6ICdQYXNzd29yZDEyMyEnLFxyXG4gICAgICAgIHJvbGw6ICdtdXNpY28nXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBtdXNpY2lhblJlZ2lzdGVyU2NoZW1hLnZhbGlkYXRlKGludmFsaWREYXRhKTtcclxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoZXJyb3I/LmRldGFpbHNbMF0ucGF0aCkudG9Db250YWluKCd1c2VyRW1haWwnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRmx1am8gZGUgUmVnaXN0cm8nLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgZm9sbG93IGNvcnJlY3QgcmVnaXN0cmF0aW9uIGZsb3cnLCAoKSA9PiB7XHJcbiAgICAgIC8vIDEuIFVzdWFyaW8gc29saWNpdGEgdmVyaWZpY2FjacOzblxyXG4gICAgICBjb25zdCByZWdpc3RyYXRpb25EYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICBsYXN0TmFtZTogJ1DDqXJleicsXHJcbiAgICAgICAgdXNlckVtYWlsOiAnanVhbkBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICByb2xsOiAnbXVzaWNvJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gMi4gVmFsaWRhciBkYXRvcyBkZSBlbnRyYWRhXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IG11c2ljaWFuUmVnaXN0ZXJTY2hlbWEudmFsaWRhdGUocmVnaXN0cmF0aW9uRGF0YSk7XHJcbiAgICAgIGV4cGVjdChlcnJvcikudG9CZVVuZGVmaW5lZCgpO1xyXG5cclxuICAgICAgLy8gMy4gU2ltdWxhciBlbnbDrW8gZGUgZW1haWwgKGVzdG8gc2UgcHJvYmFyw61hIGVuIGludGVncmFjacOzbilcclxuICAgICAgZXhwZWN0KHJlZ2lzdHJhdGlvbkRhdGEudXNlckVtYWlsKS50b0JlKCdqdWFuQGV4YW1wbGUuY29tJyk7XHJcbiAgICAgIGV4cGVjdChyZWdpc3RyYXRpb25EYXRhLnJvbGwpLnRvQmUoJ211c2ljbycpO1xyXG5cclxuICAgICAgLy8gNC4gU2ltdWxhciB2ZXJpZmljYWNpw7NuIGRlIGPDs2RpZ28gKGVzdG8gc2UgcHJvYmFyw61hIGVuIGludGVncmFjacOzbilcclxuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uRGF0YSA9IHtcclxuICAgICAgICB1c2VyRW1haWw6ICdqdWFuQGV4YW1wbGUuY29tJyxcclxuICAgICAgICBjb2RlOiAnMTIzNDU2J1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgZXhwZWN0KHZlcmlmaWNhdGlvbkRhdGEudXNlckVtYWlsKS50b0JlKHJlZ2lzdHJhdGlvbkRhdGEudXNlckVtYWlsKTtcclxuICAgICAgZXhwZWN0KHZlcmlmaWNhdGlvbkRhdGEuY29kZSkudG9IYXZlTGVuZ3RoKDYpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdWYWxpZGFjacOzbiBkZSBSb2xlcycsICgpID0+IHtcclxuICAgIHRlc3QoJ3Nob3VsZCBhY2NlcHQgbXVzaWNvIHJvbGUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgbmFtZTogJ0p1YW4nLFxyXG4gICAgICAgIGxhc3ROYW1lOiAnUMOpcmV6JyxcclxuICAgICAgICB1c2VyRW1haWw6ICdqdWFuQGV4YW1wbGUuY29tJyxcclxuICAgICAgICB1c2VyUGFzc3dvcmQ6ICdQYXNzd29yZDEyMyEnLFxyXG4gICAgICAgIHJvbGw6ICdtdXNpY28nXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBtdXNpY2lhblJlZ2lzdGVyU2NoZW1hLnZhbGlkYXRlKGRhdGEpO1xyXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBhY2NlcHQgZXZlbnRDcmVhdG9yIHJvbGUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgbmFtZTogJ01hcsOtYScsXHJcbiAgICAgICAgbGFzdE5hbWU6ICdHYXJjw61hJyxcclxuICAgICAgICB1c2VyRW1haWw6ICdtYXJpYUBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICByb2xsOiAnZXZlbnRDcmVhdG9yJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gbXVzaWNpYW5SZWdpc3RlclNjaGVtYS52YWxpZGF0ZShkYXRhKTtcclxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgcmVqZWN0IG90aGVyIHJvbGVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnZhbGlkUm9sZXMgPSBbJ2FkbWluJywgJ3N1cGVyYWRtaW4nLCAndXN1YXJpbycsICdhZG1pbkp1bmlvciddO1xyXG4gICAgICBcclxuICAgICAgaW52YWxpZFJvbGVzLmZvckVhY2gocm9sZSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICAgIGxhc3ROYW1lOiAnUMOpcmV6JyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ2p1YW5AZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICAgIHJvbGw6IHJvbGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBtdXNpY2lhblJlZ2lzdGVyU2NoZW1hLnZhbGlkYXRlKGRhdGEpO1xyXG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZURlZmluZWQoKTtcclxuICAgICAgICBleHBlY3QoZXJyb3I/LmRldGFpbHNbMF0ucGF0aCkudG9Db250YWluKCdyb2xsJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyAiXSwidmVyc2lvbiI6M30=