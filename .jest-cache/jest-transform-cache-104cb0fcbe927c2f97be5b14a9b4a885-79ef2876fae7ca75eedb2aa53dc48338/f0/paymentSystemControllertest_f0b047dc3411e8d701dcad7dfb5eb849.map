{"file":"C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\__tests__\\paymentSystemController.test.ts","mappings":";;;;;;;;;;;AAIA,kCAAkC;AAClC,IAAI,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;AAC9C,IAAI,CAAC,IAAI,CAAC,qCAAqC,EAAE,GAAG,EAAE,CAAC,CAAC;IACtD,uBAAuB,EAAE;QACvB,sBAAsB,EAAE,IAAI,CAAC,EAAE,EAAE;KAClC;CACF,CAAC,CAAC,CAAC;AAEJ,gBAAgB;AAChB,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,GAAG,EAAE,CAAC,CAAC;IACpC,EAAE,EAAE;QACF,UAAU,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YACpC,KAAK,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YACjC,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC;gBAC/B,IAAI,EAAE,EAAE;aACT,CAAC;YACF,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,CAAC;SACrC,CAAC;KACH;CACF,CAAC,CAAC,CAAC;AAEJ,cAAc;AACd,IAAI,CAAC,IAAI,CAAC,2BAA2B,EAAE,GAAG,EAAE,CAAC,CAAC;IAC5C,MAAM,EAAE;QACN,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;QACf,KAAK,EAAE,IAAI,CAAC,EAAE,EAAE;QAChB,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE;KAChB;CACF,CAAC,CAAC,CAAC;AA/BJ,oFAAiF;AACjF,2EAAwE;AAgCxE,QAAQ,CAAC,yBAAyB,EAAE,GAAG,EAAE;IACvC,IAAI,iBAA0C,CAAC;IAC/C,IAAI,wBAA2D,CAAC;IAChE,IAAI,WAA6B,CAAC;IAClC,IAAI,YAA+B,CAAC;IACpC,IAAI,UAAqB,CAAC;IAC1B,IAAI,QAAmB,CAAC;IAExB,UAAU,CAAC,GAAG,EAAE;QACd,mCAAmC;QACnC,IAAI,CAAC,aAAa,EAAE,CAAC;QAErB,0BAA0B;QAC1B,wBAAwB,GAAG;YACzB,cAAc,EAAE,IAAI,CAAC,EAAE,EAAE;YACzB,mBAAmB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC9B,mBAAmB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC9B,oBAAoB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC/B,aAAa,EAAE,IAAI,CAAC,EAAE,EAAE;YACxB,mBAAmB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC9B,mBAAmB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC9B,iBAAiB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC5B,iBAAiB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC5B,oBAAoB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC/B,kBAAkB,EAAE,IAAI,CAAC,EAAE,EAAE;YAC7B,qBAAqB,EAAE,IAAI,CAAC,EAAE,EAAE;SAC1B,CAAC;QAET,oCAAoC;QACnC,2CAAkC,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,wBAAwB,CAAC,CAAC;QAEvF,kCAAkC;QAClC,iBAAiB,GAAG,IAAI,iDAAuB,EAAE,CAAC;QAElD,4DAA4D;QAC3D,iBAAyB,CAAC,cAAc,GAAG,wBAAwB,CAAC;QAErE,gCAAgC;QAChC,UAAU,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE,CAAC;QACxC,QAAQ,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE,CAAC;QACtC,YAAY,GAAG;YACb,MAAM,EAAE,UAAU;YAClB,IAAI,EAAE,QAAQ;SACf,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,yCAAyC,EAAE,GAAS,EAAE;YACvD,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,MAAM,WAAW,GAAG;gBAClB,MAAM,EAAE,SAAS;gBACjB,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACrC,aAAa,EAAE,IAAI;gBACnB,aAAa,EAAE,IAAI;gBACnB,gBAAgB,EAAE,GAAG;aACtB,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;aACF,CAAC;YAEF,wBAAwB,CAAC,cAAc,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;YAEvE,MAAM;YACN,MAAM,iBAAiB,CAAC,cAAc,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAEzF,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,cAAc,CAAC,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;YAChF,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,WAAW;aAClB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;QAEH,EAAE,CAAC,oDAAoD,EAAE,GAAS,EAAE;YAClE,UAAU;YACV,WAAW,GAAG;gBACZ,IAAI,EAAE,SAAS;aAChB,CAAC;YAEF,MAAM;YACN,MAAM,iBAAiB,CAAC,cAAc,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAEzF,SAAS;YACT,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,KAAK,EAAE,wBAAwB;aAChC,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,GAAS,EAAE;YAC5C,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;aACF,CAAC;YAEF,wBAAwB,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC;YAEtF,MAAM;YACN,MAAM,iBAAiB,CAAC,cAAc,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAEzF,SAAS;YACT,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,KAAK;gBACd,KAAK,EAAE,qCAAqC;aAC7C,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,2CAA2C,EAAE,GAAS,EAAE;YACzD,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,MAAM,WAAW,GAAG;gBAClB,aAAa,EAAE,UAAU;gBACzB,aAAa,EAAE,YAAY;gBAC3B,WAAW,EAAE,SAAkB;gBAC/B,QAAQ,EAAE,eAAe;gBACzB,aAAa,EAAE,WAAW;aAC3B,CAAC;YAEF,MAAM,WAAW,iCACf,EAAE,EAAE,SAAS,EACb,MAAM,EAAE,SAAS,IACd,WAAW,KACd,UAAU,EAAE,KAAK,EACjB,SAAS,EAAE,IAAI,EACf,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,EACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GACpC,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;gBACD,IAAI,EAAE,WAAW;aAClB,CAAC;YAEF,wBAAwB,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;YAE5E,MAAM;YACN,MAAM,iBAAiB,CAAC,mBAAmB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE9F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,mBAAmB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YAClG,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,WAAW;aAClB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;QAEH,EAAE,CAAC,iDAAiD,EAAE,GAAS,EAAE;YAC/D,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;gBACD,IAAI,EAAE;oBACJ,aAAa,EAAE,UAAU;oBACzB,0BAA0B;iBAC3B;aACF,CAAC;YAEF,MAAM;YACN,MAAM,iBAAiB,CAAC,mBAAmB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE9F,SAAS;YACT,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,KAAK,EAAE,sCAAsC;aAC9C,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,+CAA+C,EAAE,GAAS,EAAE;YAC7D,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,MAAM,YAAY,GAAG;gBACnB;oBACE,EAAE,EAAE,OAAO;oBACX,MAAM,EAAE,SAAS;oBACjB,aAAa,EAAE,UAAU;oBACzB,aAAa,EAAE,YAAY;oBAC3B,WAAW,EAAE,SAAkB;oBAC/B,QAAQ,EAAE,eAAe;oBACzB,aAAa,EAAE,WAAW;oBAC1B,UAAU,EAAE,IAAI;oBAChB,SAAS,EAAE,IAAI;oBACf,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;oBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;iBACpC;aACF,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;aACF,CAAC;YAEF,wBAAwB,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;YAE7E,MAAM;YACN,MAAM,iBAAiB,CAAC,mBAAmB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE9F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,mBAAmB,CAAC,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;YACrF,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,YAAY;aACnB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;QACpC,EAAE,CAAC,4CAA4C,EAAE,GAAS,EAAE;YAC1D,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,MAAM,WAAW,GAAG;gBAClB,MAAM,EAAE,IAAI;gBACZ,WAAW,EAAE;oBACX,SAAS,EAAE,SAAS;oBACpB,YAAY,EAAE,aAAa;oBAC3B,QAAQ,EAAE,MAAM;oBAChB,QAAQ,EAAE,YAAY;oBACtB,MAAM,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;oBAC3B,IAAI,EAAE,IAAI;oBACV,MAAM,EAAE,EAAS;oBACjB,WAAW,EAAE,EAAE;oBACf,QAAQ,EAAE,aAAa;oBACvB,IAAI,EAAE,EAAE;iBACT;gBACD,iBAAiB,EAAE,YAAY;gBAC/B,QAAQ,EAAE,eAAe;aAC1B,CAAC;YAEF,MAAM,WAAW,GAAG;gBAClB,EAAE,EAAE,aAAa;gBACjB,MAAM,EAAE,SAAS;gBACjB,MAAM,EAAE,IAAI;gBACZ,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE;oBACX,GAAG,EAAE,iCAAiC;oBACtC,QAAQ,EAAE,aAAa;oBACvB,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;iBACrC;gBACD,MAAM,EAAE,SAAkB;gBAC1B,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACnC,iBAAiB,EAAE,YAAY;gBAC/B,QAAQ,EAAE,eAAe;aAC1B,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;gBACD,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,WAAW,CAAC,WAAW;aAC9B,CAAC;YAEF,wBAAwB,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;YAE7E,MAAM;YACN,MAAM,iBAAiB,CAAC,oBAAoB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE/F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,oBAAoB,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE;gBACpF,MAAM,EAAE,IAAI;gBACZ,WAAW,EAAE,WAAW,CAAC,WAAW;gBACpC,iBAAiB,EAAE,YAAY;gBAC/B,QAAQ,EAAE,eAAe;aAC1B,CAAC,CAAC;YACH,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,4EAA4E;aACtF,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;QAEH,EAAE,CAAC,sCAAsC,EAAE,GAAS,EAAE;YACpD,UAAU;YACV,MAAM,SAAS,GAAG,kBAAkB,CAAC;YACrC,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,SAAS;oBACjB,SAAS,EAAE,SAAS;oBACpB,KAAK,EAAE,SAAS;oBAChB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,WAAW;iBAClB;gBACD,IAAI,EAAE;oBACJ,MAAM,EAAE,IAAI;oBACZ,sBAAsB;iBACvB;aACF,CAAC;YAEF,MAAM;YACN,MAAM,iBAAiB,CAAC,oBAAoB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE/F,SAAS;YACT,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,KAAK,EAAE,0CAA0C;aAClD,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;QAC7B,EAAE,CAAC,oCAAoC,EAAE,GAAS,EAAE;YAClD,UAAU;YACV,MAAM,SAAS,GAAG,aAAa,CAAC;YAChC,MAAM,UAAU,GAAG,mBAAmB,CAAC;YACvC,MAAM,gBAAgB,GAAG;gBACvB,eAAe,EAAE,YAAY;gBAC7B,eAAe,EAAE,OAAO;gBACxB,eAAe,EAAE,WAAW;gBAC5B,qBAAqB,EAAE,MAAM;gBAC7B,UAAU,EAAE,WAAW;aACxB,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,WAAW;oBACnB,SAAS,EAAE,UAAU;oBACrB,KAAK,EAAE,UAAU;oBACjB,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,YAAY;iBACnB;gBACD,MAAM,EAAE,EAAE,SAAS,EAAE;gBACrB,IAAI,EAAE;oBACJ,QAAQ,EAAE,IAAI;oBACd,KAAK,EAAE,mCAAmC;oBAC1C,gBAAgB;iBACjB;aACF,CAAC;YAEF,wBAAwB,CAAC,aAAa,CAAC,iBAAiB,EAAE,CAAC;YAE3D,MAAM;YACN,MAAM,iBAAiB,CAAC,aAAa,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAExF,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,aAAa,CAAC,CAAC,oBAAoB,CACjE,SAAS,EACT,UAAU,EACV,IAAI,EACJ,mCAAmC,EACnC;gBACE,eAAe,EAAE,gBAAgB,CAAC,eAAe;gBACjD,eAAe,EAAE,gBAAgB,CAAC,eAAe;gBACjD,eAAe,EAAE,gBAAgB,CAAC,eAAe;gBACjD,qBAAqB,EAAE,gBAAgB,CAAC,qBAAqB;gBAC7D,UAAU,EAAE,gBAAgB,CAAC,UAAU;aACxC,CACF,CAAC;YACF,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE;oBACJ,SAAS;oBACT,MAAM,EAAE,UAAU;oBAClB,UAAU,EAAE,UAAU;oBACtB,UAAU,EAAE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC;oBAC9B,kBAAkB,EAAE,IAAI;iBACzB;gBACD,OAAO,EAAE,gCAAgC;aAC1C,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,2CAA2C,EAAE,GAAS,EAAE;YACzD,UAAU;YACV,MAAM,OAAO,GAAG,WAAW,CAAC;YAC5B,MAAM,cAAc,GAAG,uBAAuB,CAAC;YAC/C,MAAM,UAAU,GAAG,cAAc,CAAC;YAClC,MAAM,WAAW,GAAG;gBAClB,MAAM,EAAE,GAAG;gBACX,aAAa,EAAE,SAAkB;gBACjC,WAAW,EAAE,iBAAiB;aAC/B,CAAC;YAEF,MAAM,WAAW,GAAG;gBAClB,EAAE,EAAE,aAAa;gBACjB,OAAO;gBACP,WAAW,EAAE,cAAc;gBAC3B,UAAU;gBACV,MAAM,EAAE,GAAG;gBACX,QAAQ,EAAE,KAAK;gBACf,aAAa,EAAE,SAAkB;gBACjC,UAAU,EAAE,EAAE;gBACd,cAAc,EAAE,GAAG;gBACnB,MAAM,EAAE,WAAoB;gBAC5B,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;aACpC,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,eAAe;oBACvB,SAAS,EAAE,cAAc;oBACzB,KAAK,EAAE,cAAc;oBACrB,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,gBAAgB;iBACvB;gBACD,MAAM,EAAE,EAAE,OAAO,EAAE;gBACnB,IAAI,EAAE;oBACJ,UAAU;oBACV,MAAM,EAAE,GAAG;iBACZ;aACF,CAAC;YAEF,wBAAwB,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;YAE5E,MAAM;YACN,MAAM,iBAAiB,CAAC,mBAAmB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE9F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,mBAAmB,CAAC,CAAC,oBAAoB,CAAC;gBACxE,OAAO;gBACP,WAAW,EAAE,cAAc;gBAC3B,UAAU;gBACV,MAAM,EAAE,GAAG;aACZ,CAAC,CAAC;YACH,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,WAAW;aAClB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,8CAA8C,EAAE,GAAS,EAAE;YAC5D,UAAU;YACV,MAAM,aAAa,GAAG,sBAAsB,CAAC;YAC7C,MAAM,YAAY,GAAG;gBACnB;oBACE,EAAE,EAAE,aAAa;oBACjB,UAAU,EAAE,aAAa;oBACzB,OAAO,EAAE,WAAW;oBACpB,cAAc,EAAE,aAAa;oBAC7B,MAAM,EAAE,GAAG;oBACX,QAAQ,EAAE,KAAK;oBACf,MAAM,EAAE,WAAoB;oBAC5B,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;oBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;iBACpC;aACF,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,cAAc;oBACtB,SAAS,EAAE,aAAa;oBACxB,KAAK,EAAE,aAAa;oBACpB,IAAI,EAAE,UAAU;oBAChB,IAAI,EAAE,eAAe;iBACtB;aACF,CAAC;YAEF,wBAAwB,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;YAE7E,MAAM;YACN,MAAM,iBAAiB,CAAC,mBAAmB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE9F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,mBAAmB,CAAC,CAAC,oBAAoB,CAAC,aAAa,CAAC,CAAC;YACzF,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,YAAY;aACnB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,wCAAwC,EAAE,GAAS,EAAE;YACtD,UAAU;YACV,MAAM,aAAa,GAAG,sBAAsB,CAAC;YAC7C,MAAM,cAAc,GAAG;gBACrB,MAAM,EAAE,GAAG;gBACX,aAAa,EAAE,UAAU;gBACzB,WAAW,EAAE,qBAAqB;aACnC,CAAC;YAEF,MAAM,cAAc,GAAG;gBACrB,EAAE,EAAE,gBAAgB;gBACpB,UAAU,EAAE,aAAa;gBACzB,MAAM,EAAE,GAAG;gBACX,QAAQ,EAAE,KAAK;gBACf,aAAa,EAAE,UAAU;gBACzB,MAAM,EAAE,SAAkB;gBAC1B,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;aACpC,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,cAAc;oBACtB,SAAS,EAAE,aAAa;oBACxB,KAAK,EAAE,aAAa;oBACpB,IAAI,EAAE,UAAU;oBAChB,IAAI,EAAE,eAAe;iBACtB;gBACD,IAAI,EAAE;oBACJ,MAAM,EAAE,GAAG;oBACX,aAAa,EAAE,UAAU;iBAC1B;aACF,CAAC;YAEF,wBAAwB,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAE7E,MAAM;YACN,MAAM,iBAAiB,CAAC,iBAAiB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE5F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC,oBAAoB,CAAC,aAAa,EAAE;gBACrF,MAAM,EAAE,GAAG;gBACX,aAAa,EAAE,UAAU;aAC1B,CAAC,CAAC;YACH,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,cAAc;aACrB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,wCAAwC,EAAE,GAAS,EAAE;YACtD,UAAU;YACV,MAAM,YAAY,GAAG,gBAAgB,CAAC;YACtC,MAAM,UAAU,GAAG,mBAAmB,CAAC;YACvC,MAAM,WAAW,GAAG;gBAClB,QAAQ,EAAE,IAAI;gBACd,KAAK,EAAE,gCAAgC;aACxC,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,WAAW;oBACnB,SAAS,EAAE,UAAU;oBACrB,KAAK,EAAE,UAAU;oBACjB,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,YAAY;iBACnB;gBACD,MAAM,EAAE,EAAE,YAAY,EAAE;gBACxB,IAAI,EAAE,WAAW;aAClB,CAAC;YAEF,wBAAwB,CAAC,iBAAiB,CAAC,iBAAiB,EAAE,CAAC;YAE/D,MAAM;YACN,MAAM,iBAAiB,CAAC,iBAAiB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE5F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC,oBAAoB,CACrE,YAAY,EACZ,UAAU,EACV,WAAW,CAAC,QAAQ,EACpB,WAAW,CAAC,KAAK,CAClB,CAAC;YACF,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,OAAO,EAAE,8BAA8B;aACxC,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;QACpC,EAAE,CAAC,+CAA+C,EAAE,GAAS,EAAE;YAC7D,UAAU;YACV,MAAM,SAAS,GAAG;gBAChB,UAAU,EAAE,GAAG;gBACf,cAAc,EAAE,EAAE;gBAClB,WAAW,EAAE,GAAG;gBAChB,aAAa,EAAE,KAAK;gBACpB,aAAa,EAAE,KAAK;gBACpB,gBAAgB,EAAE,KAAK;gBACvB,gBAAgB,EAAE,IAAI;gBACtB,oBAAoB,EAAE,CAAC;gBACvB,uBAAuB,EAAE,CAAC;gBAC1B,iBAAiB,EAAE,GAAG;gBACtB,aAAa,EAAE,IAAI;gBACnB,WAAW,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;aACtC,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,WAAW;oBACnB,SAAS,EAAE,mBAAmB;oBAC9B,KAAK,EAAE,mBAAmB;oBAC1B,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,YAAY;iBACnB;aACF,CAAC;YAEF,wBAAwB,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YAE3E,MAAM;YACN,MAAM,iBAAiB,CAAC,oBAAoB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE/F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,oBAAoB,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACzE,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,SAAS;aAChB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,EAAE,CAAC,6CAA6C,EAAE,GAAS,EAAE;YAC3D,UAAU;YACV,MAAM,YAAY,GAAG;gBACnB;oBACE,EAAE,EAAE,aAAa;oBACjB,MAAM,EAAE,UAAU;oBAClB,MAAM,EAAE,IAAI;oBACZ,QAAQ,EAAE,KAAK;oBACf,MAAM,EAAE,SAAkB;oBAC1B,WAAW,EAAE;wBACX,GAAG,EAAE,qCAAqC;wBAC1C,QAAQ,EAAE,iBAAiB;wBAC3B,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;qBACrC;oBACD,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;oBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;oBACnC,iBAAiB,EAAE,YAAY;oBAC/B,QAAQ,EAAE,eAAe;iBAC1B;aACF,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,WAAW;oBACnB,SAAS,EAAE,mBAAmB;oBAC9B,KAAK,EAAE,mBAAmB;oBAC1B,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,YAAY;iBACnB;aACF,CAAC;YAEF,wBAAwB,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;YAE5E,MAAM;YACN,MAAM,iBAAiB,CAAC,kBAAkB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAE7F,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,kBAAkB,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACvE,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,YAAY;aACnB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,uBAAuB,EAAE,GAAG,EAAE;QACrC,EAAE,CAAC,gDAAgD,EAAE,GAAS,EAAE;YAC9D,UAAU;YACV,MAAM,eAAe,GAAG;gBACtB;oBACE,EAAE,EAAE,gBAAgB;oBACpB,UAAU,EAAE,cAAc;oBAC1B,MAAM,EAAE,GAAG;oBACX,QAAQ,EAAE,KAAK;oBACf,aAAa,EAAE,UAAU;oBACzB,MAAM,EAAE,SAAkB;oBAC1B,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;oBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;iBACpC;aACF,CAAC;YAEF,WAAW,GAAG;gBACZ,IAAI,EAAE;oBACJ,MAAM,EAAE,WAAW;oBACnB,SAAS,EAAE,mBAAmB;oBAC9B,KAAK,EAAE,mBAAmB;oBAC1B,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,YAAY;iBACnB;aACF,CAAC;YAEF,wBAAwB,CAAC,qBAAqB,CAAC,iBAAiB,CAAC,eAAe,CAAC,CAAC;YAElF,MAAM;YACN,MAAM,iBAAiB,CAAC,qBAAqB,CAAC,WAAsB,EAAE,YAAwB,CAAC,CAAC;YAEhG,SAAS;YACT,MAAM,CAAC,wBAAwB,CAAC,qBAAqB,CAAC,CAAC,gBAAgB,EAAE,CAAC;YAC1E,MAAM,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YAC7C,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CAAC;gBACpC,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,eAAe;aACtB,CAAC,CAAC;QACL,CAAC,CAAA,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\__tests__\\paymentSystemController.test.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport { PaymentSystemController } from '../controllers/paymentSystemController';\r\nimport { PaymentSystemService } from '../services/paymentSystemService';\r\n\r\n// Mock the payment system service\r\njest.mock('../services/paymentSystemService');\r\njest.mock('../services/pushNotificationService', () => ({\r\n  pushNotificationService: {\r\n    sendNotificationToUser: jest.fn()\r\n  }\r\n}));\r\n\r\n// Mock Firebase\r\njest.mock('../utils/firebase', () => ({\r\n  db: {\r\n    collection: jest.fn().mockReturnValue({\r\n      where: jest.fn().mockReturnThis(),\r\n      get: jest.fn().mockResolvedValue({\r\n        docs: []\r\n      }),\r\n      add: jest.fn().mockResolvedValue({})\r\n    })\r\n  }\r\n}));\r\n\r\n// Mock logger\r\njest.mock('../services/loggerService', () => ({\r\n  logger: {\r\n    info: jest.fn(),\r\n    error: jest.fn(),\r\n    warn: jest.fn()\r\n  }\r\n}));\r\n\r\ndescribe('PaymentSystemController', () => {\r\n  let paymentController: PaymentSystemController;\r\n  let mockPaymentSystemService: jest.Mocked<PaymentSystemService>;\r\n  let mockRequest: Partial<Request>;\r\n  let mockResponse: Partial<Response>;\r\n  let mockStatus: jest.Mock;\r\n  let mockJson: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    // Limpiar mocks antes de cada test\r\n    jest.clearAllMocks();\r\n    \r\n    // Crear mock del servicio\r\n    mockPaymentSystemService = {\r\n      getUserBalance: jest.fn(),\r\n      registerBankAccount: jest.fn(),\r\n      getUserBankAccounts: jest.fn(),\r\n      uploadDepositVoucher: jest.fn(),\r\n      verifyDeposit: jest.fn(),\r\n      processEventPayment: jest.fn(),\r\n      getMusicianEarnings: jest.fn(),\r\n      requestWithdrawal: jest.fn(),\r\n      processWithdrawal: jest.fn(),\r\n      getPaymentStatistics: jest.fn(),\r\n      getPendingDeposits: jest.fn(),\r\n      getPendingWithdrawals: jest.fn()\r\n    } as any;\r\n    \r\n    // Mock del constructor del servicio\r\n    (PaymentSystemService as jest.Mock).mockImplementation(() => mockPaymentSystemService);\r\n    \r\n    // Crear instancia del controlador\r\n    paymentController = new PaymentSystemController();\r\n    \r\n    // Reemplazar el servicio en el controlador con nuestro mock\r\n    (paymentController as any).paymentService = mockPaymentSystemService;\r\n    \r\n    // Configurar mocks de respuesta\r\n    mockStatus = jest.fn().mockReturnThis();\r\n    mockJson = jest.fn().mockReturnThis();\r\n    mockResponse = {\r\n      status: mockStatus,\r\n      json: mockJson\r\n    };\r\n  });\r\n\r\n  describe('getUserBalance', () => {\r\n    it('should return user balance successfully', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      const mockBalance = {\r\n        userId: userEmail,\r\n        balance: 1000,\r\n        currency: 'RD$',\r\n        lastUpdated: new Date().toISOString(),\r\n        totalDeposits: 2000,\r\n        totalEarnings: 1500,\r\n        totalWithdrawals: 500\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getUserBalance.mockResolvedValue(mockBalance);\r\n\r\n      // Act\r\n      await paymentController.getUserBalance(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.getUserBalance).toHaveBeenCalledWith(userEmail);\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockBalance\r\n      });\r\n    });\r\n\r\n    it('should return error when user is not authenticated', async () => {\r\n      // Arrange\r\n      mockRequest = {\r\n        user: undefined\r\n      };\r\n\r\n      // Act\r\n      await paymentController.getUserBalance(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockStatus).toHaveBeenCalledWith(401);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        error: 'Usuario no autenticado'\r\n      });\r\n    });\r\n\r\n    it('should handle service errors', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getUserBalance.mockRejectedValue(new Error('Service error'));\r\n\r\n      // Act\r\n      await paymentController.getUserBalance(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockStatus).toHaveBeenCalledWith(500);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        error: 'Error obteniendo balance de usuario'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('registerBankAccount', () => {\r\n    it('should register bank account successfully', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      const accountData = {\r\n        accountHolder: 'John Doe',\r\n        accountNumber: '1234567890',\r\n        accountType: 'savings' as const,\r\n        bankName: 'Banco Popular',\r\n        routingNumber: '123456789'\r\n      };\r\n\r\n      const mockAccount = {\r\n        id: 'bank123',\r\n        userId: userEmail,\r\n        ...accountData,\r\n        isVerified: false,\r\n        isDefault: true,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        },\r\n        body: accountData\r\n      };\r\n\r\n      mockPaymentSystemService.registerBankAccount.mockResolvedValue(mockAccount);\r\n\r\n      // Act\r\n      await paymentController.registerBankAccount(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.registerBankAccount).toHaveBeenCalledWith(userEmail, accountData);\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockAccount\r\n      });\r\n    });\r\n\r\n    it('should return error for missing required fields', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        },\r\n        body: {\r\n          accountHolder: 'John Doe'\r\n          // Missing required fields\r\n        }\r\n      };\r\n\r\n      // Act\r\n      await paymentController.registerBankAccount(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        error: 'Datos de cuenta bancaria incompletos'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('getUserBankAccounts', () => {\r\n    it('should return user bank accounts successfully', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      const mockAccounts = [\r\n        {\r\n          id: 'bank1',\r\n          userId: userEmail,\r\n          accountHolder: 'John Doe',\r\n          accountNumber: '1234567890',\r\n          accountType: 'savings' as const,\r\n          bankName: 'Banco Popular',\r\n          routingNumber: '123456789',\r\n          isVerified: true,\r\n          isDefault: true,\r\n          createdAt: new Date().toISOString(),\r\n          updatedAt: new Date().toISOString()\r\n        }\r\n      ];\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getUserBankAccounts.mockResolvedValue(mockAccounts);\r\n\r\n      // Act\r\n      await paymentController.getUserBankAccounts(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.getUserBankAccounts).toHaveBeenCalledWith(userEmail);\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockAccounts\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('uploadDepositVoucher', () => {\r\n    it('should upload deposit voucher successfully', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      const depositData = {\r\n        amount: 1000,\r\n        voucherFile: {\r\n          fieldname: 'voucher',\r\n          originalname: 'voucher.jpg',\r\n          encoding: '7bit',\r\n          mimetype: 'image/jpeg',\r\n          buffer: Buffer.from('test'),\r\n          size: 1024,\r\n          stream: {} as any,\r\n          destination: '',\r\n          filename: 'voucher.jpg',\r\n          path: ''\r\n        },\r\n        accountHolderName: 'Juan Pérez',\r\n        bankName: 'Banco Popular'\r\n      };\r\n\r\n      const mockDeposit = {\r\n        id: 'deposit_123',\r\n        userId: userEmail,\r\n        amount: 1000,\r\n        currency: 'RD$',\r\n        voucherFile: {\r\n          url: 'https://example.com/voucher.jpg',\r\n          filename: 'voucher.jpg',\r\n          uploadedAt: new Date().toISOString()\r\n        },\r\n        status: 'pending' as const,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        accountHolderName: 'Juan Pérez',\r\n        bankName: 'Banco Popular'\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        },\r\n        body: depositData,\r\n        file: depositData.voucherFile\r\n      };\r\n\r\n      mockPaymentSystemService.uploadDepositVoucher.mockResolvedValue(mockDeposit);\r\n\r\n      // Act\r\n      await paymentController.uploadDepositVoucher(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.uploadDepositVoucher).toHaveBeenCalledWith(userEmail, {\r\n        amount: 1000,\r\n        voucherFile: depositData.voucherFile,\r\n        accountHolderName: 'Juan Pérez',\r\n        bankName: 'Banco Popular'\r\n      });\r\n      expect(mockStatus).toHaveBeenCalledWith(201);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockDeposit,\r\n        message: 'Depósito subido exitosamente. Pendiente de verificación por administrador.'\r\n      });\r\n    });\r\n\r\n    it('should return error for missing file', async () => {\r\n      // Arrange\r\n      const userEmail = 'user@example.com';\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          userEmail: userEmail,\r\n          email: userEmail,\r\n          role: 'user',\r\n          name: 'Test User'\r\n        },\r\n        body: {\r\n          amount: 1000\r\n          // Missing voucherFile\r\n        }\r\n      };\r\n\r\n      // Act\r\n      await paymentController.uploadDepositVoucher(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        error: 'No se proporcionó archivo de comprobante'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('verifyDeposit', () => {\r\n    it('should verify deposit successfully', async () => {\r\n      // Arrange\r\n      const depositId = 'deposit_123';\r\n      const adminEmail = 'admin@example.com';\r\n      const verificationData = {\r\n        bankDepositDate: '2024-01-15',\r\n        bankDepositTime: '14:30',\r\n        referenceNumber: 'REF123456',\r\n        accountLastFourDigits: '1234',\r\n        verifiedBy: 'admin_123'\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'admin_123',\r\n          userEmail: adminEmail,\r\n          email: adminEmail,\r\n          role: 'admin',\r\n          name: 'Admin User'\r\n        },\r\n        params: { depositId },\r\n        body: {\r\n          approved: true,\r\n          notes: 'Depósito verificado correctamente',\r\n          verificationData\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.verifyDeposit.mockResolvedValue();\r\n\r\n      // Act\r\n      await paymentController.verifyDeposit(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.verifyDeposit).toHaveBeenCalledWith(\r\n        depositId,\r\n        adminEmail,\r\n        true,\r\n        'Depósito verificado correctamente',\r\n        {\r\n          bankDepositDate: verificationData.bankDepositDate,\r\n          bankDepositTime: verificationData.bankDepositTime,\r\n          referenceNumber: verificationData.referenceNumber,\r\n          accountLastFourDigits: verificationData.accountLastFourDigits,\r\n          verifiedBy: verificationData.verifiedBy\r\n        }\r\n      );\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: {\r\n          depositId,\r\n          status: 'approved',\r\n          verifiedBy: adminEmail,\r\n          verifiedAt: expect.any(String),\r\n          userBalanceUpdated: true\r\n        },\r\n        message: 'Depósito aprobado exitosamente'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('payMusicianForEvent', () => {\r\n    it('should process event payment successfully', async () => {\r\n      // Arrange\r\n      const eventId = 'event_123';\r\n      const organizerEmail = 'organizer@example.com';\r\n      const musicianId = 'musician_123';\r\n      const paymentData = {\r\n        amount: 500,\r\n        paymentMethod: 'balance' as const,\r\n        description: 'Pago por evento'\r\n      };\r\n\r\n      const mockPayment = {\r\n        id: 'payment_123',\r\n        eventId,\r\n        organizerId: organizerEmail,\r\n        musicianId,\r\n        amount: 500,\r\n        currency: 'RD$',\r\n        paymentMethod: 'balance' as const,\r\n        commission: 50,\r\n        musicianAmount: 450,\r\n        status: 'completed' as const,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'organizer_123',\r\n          userEmail: organizerEmail,\r\n          email: organizerEmail,\r\n          role: 'user',\r\n          name: 'Organizer User'\r\n        },\r\n        params: { eventId },\r\n        body: {\r\n          musicianId,\r\n          amount: 500\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.processEventPayment.mockResolvedValue(mockPayment);\r\n\r\n      // Act\r\n      await paymentController.payMusicianForEvent(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.processEventPayment).toHaveBeenCalledWith({\r\n        eventId,\r\n        organizerId: organizerEmail,\r\n        musicianId,\r\n        amount: 500\r\n      });\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockPayment\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('getMusicianEarnings', () => {\r\n    it('should return musician earnings successfully', async () => {\r\n      // Arrange\r\n      const musicianEmail = 'musician@example.com';\r\n      const mockEarnings = [\r\n        {\r\n          id: 'earning_123',\r\n          musicianId: musicianEmail,\r\n          eventId: 'event_123',\r\n          eventPaymentId: 'payment_123',\r\n          amount: 500,\r\n          currency: 'RD$',\r\n          status: 'available' as const,\r\n          createdAt: new Date().toISOString(),\r\n          updatedAt: new Date().toISOString()\r\n        }\r\n      ];\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'musician_123',\r\n          userEmail: musicianEmail,\r\n          email: musicianEmail,\r\n          role: 'musician',\r\n          name: 'Musician User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getMusicianEarnings.mockResolvedValue(mockEarnings);\r\n\r\n      // Act\r\n      await paymentController.getMusicianEarnings(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.getMusicianEarnings).toHaveBeenCalledWith(musicianEmail);\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockEarnings\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('requestWithdrawal', () => {\r\n    it('should request withdrawal successfully', async () => {\r\n      // Arrange\r\n      const musicianEmail = 'musician@example.com';\r\n      const withdrawalData = {\r\n        amount: 200,\r\n        bankAccountId: 'bank_123',\r\n        description: 'Retiro de ganancias'\r\n      };\r\n\r\n      const mockWithdrawal = {\r\n        id: 'withdrawal_123',\r\n        musicianId: musicianEmail,\r\n        amount: 200,\r\n        currency: 'RD$',\r\n        bankAccountId: 'bank_123',\r\n        status: 'pending' as const,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'musician_123',\r\n          userEmail: musicianEmail,\r\n          email: musicianEmail,\r\n          role: 'musician',\r\n          name: 'Musician User'\r\n        },\r\n        body: {\r\n          amount: 200,\r\n          bankAccountId: 'bank_123'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.requestWithdrawal.mockResolvedValue(mockWithdrawal);\r\n\r\n      // Act\r\n      await paymentController.requestWithdrawal(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.requestWithdrawal).toHaveBeenCalledWith(musicianEmail, {\r\n        amount: 200,\r\n        bankAccountId: 'bank_123'\r\n      });\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockWithdrawal\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('processWithdrawal', () => {\r\n    it('should process withdrawal successfully', async () => {\r\n      // Arrange\r\n      const withdrawalId = 'withdrawal_123';\r\n      const adminEmail = 'admin@example.com';\r\n      const processData = {\r\n        approved: true,\r\n        notes: 'Retiro procesado correctamente'\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'admin_123',\r\n          userEmail: adminEmail,\r\n          email: adminEmail,\r\n          role: 'admin',\r\n          name: 'Admin User'\r\n        },\r\n        params: { withdrawalId },\r\n        body: processData\r\n      };\r\n\r\n      mockPaymentSystemService.processWithdrawal.mockResolvedValue();\r\n\r\n      // Act\r\n      await paymentController.processWithdrawal(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.processWithdrawal).toHaveBeenCalledWith(\r\n        withdrawalId,\r\n        adminEmail,\r\n        processData.approved,\r\n        processData.notes\r\n      );\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        message: 'Retiro aprobado exitosamente'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('getPaymentStatistics', () => {\r\n    it('should return payment statistics successfully', async () => {\r\n      // Arrange\r\n      const mockStats = {\r\n        totalUsers: 100,\r\n        totalMusicians: 50,\r\n        totalEvents: 200,\r\n        totalDeposits: 50000,\r\n        totalPayments: 40000,\r\n        totalWithdrawals: 10000,\r\n        totalCommissions: 5000,\r\n        pendingDepositsCount: 5,\r\n        pendingWithdrawalsCount: 3,\r\n        averageEventValue: 250,\r\n        monthlyGrowth: 15.5,\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'admin_123',\r\n          userEmail: 'admin@example.com',\r\n          email: 'admin@example.com',\r\n          role: 'admin',\r\n          name: 'Admin User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getPaymentStatistics.mockResolvedValue(mockStats);\r\n\r\n      // Act\r\n      await paymentController.getPaymentStatistics(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.getPaymentStatistics).toHaveBeenCalled();\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockStats\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('getPendingDeposits', () => {\r\n    it('should return pending deposits successfully', async () => {\r\n      // Arrange\r\n      const mockDeposits = [\r\n        {\r\n          id: 'deposit_123',\r\n          userId: 'user_123',\r\n          amount: 1000,\r\n          currency: 'RD$',\r\n          status: 'pending' as const,\r\n          voucherFile: {\r\n            url: 'https://example.com/voucher_123.jpg',\r\n            filename: 'voucher_123.jpg',\r\n            uploadedAt: new Date().toISOString()\r\n          },\r\n          createdAt: new Date().toISOString(),\r\n          updatedAt: new Date().toISOString(),\r\n          accountHolderName: 'Juan Pérez',\r\n          bankName: 'Banco Popular'\r\n        }\r\n      ];\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'admin_123',\r\n          userEmail: 'admin@example.com',\r\n          email: 'admin@example.com',\r\n          role: 'admin',\r\n          name: 'Admin User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getPendingDeposits.mockResolvedValue(mockDeposits);\r\n\r\n      // Act\r\n      await paymentController.getPendingDeposits(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.getPendingDeposits).toHaveBeenCalled();\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockDeposits\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('getPendingWithdrawals', () => {\r\n    it('should return pending withdrawals successfully', async () => {\r\n      // Arrange\r\n      const mockWithdrawals = [\r\n        {\r\n          id: 'withdrawal_123',\r\n          musicianId: 'musician_123',\r\n          amount: 200,\r\n          currency: 'RD$',\r\n          bankAccountId: 'bank_123',\r\n          status: 'pending' as const,\r\n          createdAt: new Date().toISOString(),\r\n          updatedAt: new Date().toISOString()\r\n        }\r\n      ];\r\n\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'admin_123',\r\n          userEmail: 'admin@example.com',\r\n          email: 'admin@example.com',\r\n          role: 'admin',\r\n          name: 'Admin User'\r\n        }\r\n      };\r\n\r\n      mockPaymentSystemService.getPendingWithdrawals.mockResolvedValue(mockWithdrawals);\r\n\r\n      // Act\r\n      await paymentController.getPendingWithdrawals(mockRequest as Request, mockResponse as Response);\r\n\r\n      // Assert\r\n      expect(mockPaymentSystemService.getPendingWithdrawals).toHaveBeenCalled();\r\n      expect(mockStatus).toHaveBeenCalledWith(200);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: true,\r\n        data: mockWithdrawals\r\n      });\r\n    });\r\n  });\r\n}); \r\n"],"version":3}