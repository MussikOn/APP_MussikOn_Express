648848d570cef4ab901f20be9f5a0baa
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockErrorHandler = exports.mockAuthMiddleware = exports.createMockResponse = exports.createMockRequest = void 0;
// Mock Firebase Admin
jest.mock('firebase-admin', () => ({
    initializeApp: jest.fn(),
    getApps: jest.fn(() => []),
    getApp: jest.fn(),
    apps: [], // Agregar esta propiedad
    credential: {
        cert: jest.fn()
    },
    auth: jest.fn(() => ({
        verifyIdToken: jest.fn(),
        createCustomToken: jest.fn(),
        getUser: jest.fn(),
        getUserByEmail: jest.fn(),
        listUsers: jest.fn(),
        createUser: jest.fn(),
        updateUser: jest.fn(),
        deleteUser: jest.fn(),
        setCustomUserClaims: jest.fn()
    })),
    firestore: jest.fn(() => ({
        collection: jest.fn(() => ({
            doc: jest.fn(() => ({
                get: jest.fn(),
                set: jest.fn(),
                update: jest.fn(),
                delete: jest.fn()
            })),
            where: jest.fn(() => ({
                get: jest.fn(),
                orderBy: jest.fn(() => ({
                    get: jest.fn(),
                    limit: jest.fn(() => ({
                        get: jest.fn()
                    }))
                }))
            })),
            orderBy: jest.fn(() => ({
                get: jest.fn(),
                limit: jest.fn(() => ({
                    get: jest.fn()
                }))
            })),
            limit: jest.fn(() => ({
                get: jest.fn()
            })),
            get: jest.fn()
        }))
    })),
    getFirestore: jest.fn(() => ({
        collection: jest.fn(() => ({
            doc: jest.fn(() => ({
                get: jest.fn(),
                set: jest.fn(),
                update: jest.fn(),
                delete: jest.fn()
            })),
            where: jest.fn(() => ({
                get: jest.fn(),
                orderBy: jest.fn(() => ({
                    get: jest.fn(),
                    limit: jest.fn(() => ({
                        get: jest.fn()
                    }))
                }))
            })),
            orderBy: jest.fn(() => ({
                get: jest.fn(),
                limit: jest.fn(() => ({
                    get: jest.fn()
                }))
            })),
            limit: jest.fn(() => ({
                get: jest.fn()
            })),
            get: jest.fn()
        }))
    }))
}));
// Jest setup file for MussikOn API tests
const dotenv_1 = __importDefault(require("dotenv"));
const loggerService_1 = require("../services/loggerService");
// Load environment variables for testing
dotenv_1.default.config({ path: '.env.test' });
// Global test setup
beforeAll(() => {
    // Setup any global test configuration
    loggerService_1.logger.info('Setting up test environment...', { context: 'TestSetup' });
    // Mock console methods to reduce noise in tests
    jest.spyOn(console, 'log').mockImplementation(() => { });
    jest.spyOn(console, 'info').mockImplementation(() => { });
    jest.spyOn(console, 'warn').mockImplementation(() => { });
    jest.spyOn(console, 'error').mockImplementation(() => { });
});
afterAll(() => {
    // Cleanup after all tests
    loggerService_1.logger.info('Cleaning up test environment...', { context: 'TestSetup' });
    // Restore console methods
    jest.restoreAllMocks();
});
// Global test utilities
const createMockRequest = (overrides = {}) => (Object.assign({ body: {}, params: {}, query: {}, headers: {}, user: null }, overrides));
exports.createMockRequest = createMockRequest;
const createMockResponse = () => {
    const res = {};
    res.status = jest.fn().mockReturnValue(res);
    res.json = jest.fn().mockReturnValue(res);
    res.send = jest.fn().mockReturnValue(res);
    res.end = jest.fn().mockReturnValue(res);
    return res;
};
exports.createMockResponse = createMockResponse;
// Mock middleware
const mockAuthMiddleware = (req, res, next) => {
    req.user = {
        id: 'test-user-id',
        email: 'test@example.com',
        role: 'usuario'
    };
    next();
};
exports.mockAuthMiddleware = mockAuthMiddleware;
// Mock error handler
const mockErrorHandler = (err, req, res, next) => {
    res.status(500).json({
        success: false,
        message: err.message || 'Internal server error'
    });
};
exports.mockErrorHandler = mockErrorHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHNldHVwLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQU9BLHNCQUFzQjtBQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDakMsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDeEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDO0lBQzFCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2pCLElBQUksRUFBRSxFQUFFLEVBQUUseUJBQXlCO0lBQ25DLFVBQVUsRUFBRTtRQUNWLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2hCO0lBQ0QsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNuQixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN4QixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzVCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3pCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3BCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3JCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3JCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3JCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDL0IsQ0FBQyxDQUFDO0lBQ0gsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN4QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFD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Q3pCLElBQUksRUFBRSxTQUFTO0tBQ2hCLENBQUM7SUFDRixJQUFJLEVBQUUsQ0FBQztBQUNULENBQUMsQ0FBQztBQVBXLFFBQUEsa0JBQWtCLHNCQU83QjtBQUVGLHFCQUFxQjtBQUNkLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxHQUFRLEVBQUUsR0FBUSxFQUFFLEdBQVEsRUFBRSxJQUFTLEVBQUUsRUFBRTtJQUMxRSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNuQixPQUFPLEVBQUUsS0FBSztRQUNkLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTyxJQUFJLHVCQUF1QjtLQUNoRCxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFMVyxRQUFBLGdCQUFnQixvQkFLM0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEplc3Qgc2V0dXAgZmlsZSBmb3IgTXVzc2lrT24gQVBJIHRlc3RzXHJcbmltcG9ydCBkb3RlbnYgZnJvbSAnZG90ZW52JztcclxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vc2VydmljZXMvbG9nZ2VyU2VydmljZSc7XHJcblxyXG4vLyBMb2FkIGVudmlyb25tZW50IHZhcmlhYmxlcyBmb3IgdGVzdGluZ1xyXG5kb3RlbnYuY29uZmlnKHsgcGF0aDogJy5lbnYudGVzdCcgfSk7XHJcblxyXG4vLyBNb2NrIEZpcmViYXNlIEFkbWluXHJcbmplc3QubW9jaygnZmlyZWJhc2UtYWRtaW4nLCAoKSA9PiAoe1xyXG4gIGluaXRpYWxpemVBcHA6IGplc3QuZm4oKSxcclxuICBnZXRBcHBzOiBqZXN0LmZuKCgpID0+IFtdKSxcclxuICBnZXRBcHA6IGplc3QuZm4oKSxcclxuICBhcHBzOiBbXSwgLy8gQWdyZWdhciBlc3RhIHByb3BpZWRhZFxyXG4gIGNyZWRlbnRpYWw6IHtcclxuICAgIGNlcnQ6IGplc3QuZm4oKVxyXG4gIH0sXHJcbiAgYXV0aDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgdmVyaWZ5SWRUb2tlbjogamVzdC5mbigpLFxyXG4gICAgY3JlYXRlQ3VzdG9tVG9rZW46IGplc3QuZm4oKSxcclxuICAgIGdldFVzZXI6IGplc3QuZm4oKSxcclxuICAgIGdldFVzZXJCeUVtYWlsOiBqZXN0LmZuKCksXHJcbiAgICBsaXN0VXNlcnM6IGplc3QuZm4oKSxcclxuICAgIGNyZWF0ZVVzZXI6IGplc3QuZm4oKSxcclxuICAgIHVwZGF0ZVVzZXI6IGplc3QuZm4oKSxcclxuICAgIGRlbGV0ZVVzZXI6IGplc3QuZm4oKSxcclxuICAgIHNldEN1c3RvbVVzZXJDbGFpbXM6IGplc3QuZm4oKVxyXG4gIH0pKSxcclxuICBmaXJlc3RvcmU6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgIGNvbGxlY3Rpb246IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgZG9jOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCksXHJcbiAgICAgICAgc2V0OiBqZXN0LmZuKCksXHJcbiAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICAgICAgZGVsZXRlOiBqZXN0LmZuKClcclxuICAgICAgfSkpLFxyXG4gICAgICB3aGVyZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLFxyXG4gICAgICAgIG9yZGVyQnk6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGdldDogamVzdC5mbigpLFxyXG4gICAgICAgICAgbGltaXQ6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKClcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KSksXHJcbiAgICAgIG9yZGVyQnk6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKSxcclxuICAgICAgICBsaW1pdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKClcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpLFxyXG4gICAgICBsaW1pdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGdldDogamVzdC5mbigpXHJcbiAgICAgIH0pKSxcclxuICAgICAgZ2V0OiBqZXN0LmZuKClcclxuICAgIH0pKVxyXG4gIH0pKSxcclxuICBnZXRGaXJlc3RvcmU6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgIGNvbGxlY3Rpb246IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgZG9jOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCksXHJcbiAgICAgICAgc2V0OiBqZXN0LmZuKCksXHJcbiAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICAgICAgZGVsZXRlOiBqZXN0LmZuKClcclxuICAgICAgfSkpLFxyXG4gICAgICB3aGVyZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLFxyXG4gICAgICAgIG9yZGVyQnk6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGdldDogamVzdC5mbigpLFxyXG4gICAgICAgICAgbGltaXQ6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKClcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KSksXHJcbiAgICAgIG9yZGVyQnk6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKSxcclxuICAgICAgICBsaW1pdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKClcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpLFxyXG4gICAgICBsaW1pdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGdldDogamVzdC5mbigpXHJcbiAgICAgIH0pKSxcclxuICAgICAgZ2V0OiBqZXN0LmZuKClcclxuICAgIH0pKVxyXG4gIH0pKVxyXG59KSk7XHJcblxyXG4vLyBHbG9iYWwgdGVzdCBzZXR1cFxyXG5iZWZvcmVBbGwoKCkgPT4ge1xyXG4gIC8vIFNldHVwIGFueSBnbG9iYWwgdGVzdCBjb25maWd1cmF0aW9uXHJcbiAgbG9nZ2VyLmluZm8oJ1NldHRpbmcgdXAgdGVzdCBlbnZpcm9ubWVudC4uLicsIHsgY29udGV4dDogJ1Rlc3RTZXR1cCcgfSk7XHJcbiAgXHJcbiAgLy8gTW9jayBjb25zb2xlIG1ldGhvZHMgdG8gcmVkdWNlIG5vaXNlIGluIHRlc3RzXHJcbiAgamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICBqZXN0LnNweU9uKGNvbnNvbGUsICdpbmZvJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICBqZXN0LnNweU9uKGNvbnNvbGUsICd3YXJuJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbn0pO1xyXG5cclxuYWZ0ZXJBbGwoKCkgPT4ge1xyXG4gIC8vIENsZWFudXAgYWZ0ZXIgYWxsIHRlc3RzXHJcbiAgbG9nZ2VyLmluZm8oJ0NsZWFuaW5nIHVwIHRlc3QgZW52aXJvbm1lbnQuLi4nLCB7IGNvbnRleHQ6ICdUZXN0U2V0dXAnIH0pO1xyXG4gIFxyXG4gIC8vIFJlc3RvcmUgY29uc29sZSBtZXRob2RzXHJcbiAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcclxufSk7XHJcblxyXG4vLyBHbG9iYWwgdGVzdCB1dGlsaXRpZXNcclxuZXhwb3J0IGNvbnN0IGNyZWF0ZU1vY2tSZXF1ZXN0ID0gKG92ZXJyaWRlczogYW55ID0ge30pID0+ICh7XHJcbiAgYm9keToge30sXHJcbiAgcGFyYW1zOiB7fSxcclxuICBxdWVyeToge30sXHJcbiAgaGVhZGVyczoge30sXHJcbiAgdXNlcjogbnVsbCxcclxuICAuLi5vdmVycmlkZXNcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlTW9ja1Jlc3BvbnNlID0gKCkgPT4ge1xyXG4gIGNvbnN0IHJlczogYW55ID0ge307XHJcbiAgcmVzLnN0YXR1cyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICByZXMuanNvbiA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICByZXMuc2VuZCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUocmVzKTtcclxuICByZXMuZW5kID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShyZXMpO1xyXG4gIHJldHVybiByZXM7XHJcbn07XHJcblxyXG4vLyBNb2NrIG1pZGRsZXdhcmVcclxuZXhwb3J0IGNvbnN0IG1vY2tBdXRoTWlkZGxld2FyZSA9IChyZXE6IGFueSwgcmVzOiBhbnksIG5leHQ6IGFueSkgPT4ge1xyXG4gIHJlcS51c2VyID0ge1xyXG4gICAgaWQ6ICd0ZXN0LXVzZXItaWQnLFxyXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcclxuICAgIHJvbGU6ICd1c3VhcmlvJ1xyXG4gIH07XHJcbiAgbmV4dCgpO1xyXG59O1xyXG5cclxuLy8gTW9jayBlcnJvciBoYW5kbGVyXHJcbmV4cG9ydCBjb25zdCBtb2NrRXJyb3JIYW5kbGVyID0gKGVycjogYW55LCByZXE6IGFueSwgcmVzOiBhbnksIG5leHQ6IGFueSkgPT4ge1xyXG4gIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfHwgJ0ludGVybmFsIHNlcnZlciBlcnJvcidcclxuICB9KTtcclxufTsgIl0sInZlcnNpb24iOjN9