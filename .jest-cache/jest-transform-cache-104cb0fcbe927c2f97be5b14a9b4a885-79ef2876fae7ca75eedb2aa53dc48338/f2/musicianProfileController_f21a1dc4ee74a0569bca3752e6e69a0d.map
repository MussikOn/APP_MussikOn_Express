{"version":3,"names":["cov_1mizp8hu55","actualCoverage","loggerService_1","s","require","client_s3_1","idriveE2_1","s3_request_presigner_1","dotenv_1","__importDefault","default","config","uploadFile","req","res","f","__awaiter","file","b","status","json","error","console","info","fileKey","Date","now","originalname","command","PutObjectCommand","Bucket","process","env","IDRIVE_E2_BUCKET_NAME","Key","Body","buffer","ContentType","mimetype","direccion","s3","send","url","IDRIVE_E2_ENDPOINT","message","key","logger","exports","getFileUrl","params","GetObjectCommand","getSignedUrl","expiresIn"],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\controllers\\musicianProfileController.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport { logger } from '../services/loggerService';\r\nimport { PutObjectCommand, GetObjectCommand } from '@aws-sdk/client-s3';\r\nimport { s3 } from '../utils/idriveE2';\r\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\r\nimport dotenv from 'dotenv';\r\ndotenv.config();\r\n\r\nexport const uploadFile = async (req: Request, res: Response) => {\r\n  try {\r\n    if (!req.file) {\r\n      res.status(400).json({ error: 'No file uploaded' });\r\n      return;\r\n    }\r\n    console.info(req.file);\r\n\r\n    const fileKey = Date.now() + '_' + req.file.originalname;\r\n\r\n    const command = new PutObjectCommand({\r\n      Bucket: process.env.IDRIVE_E2_BUCKET_NAME!,\r\n      Key: fileKey,\r\n      Body: req.file.buffer,\r\n      ContentType: req.file.mimetype,\r\n    });\r\n\r\n    console.info('Direccion');\r\n    const direccion = await s3.send(command);\r\n    console.info(direccion);\r\n\r\n    const url = `${process.env.IDRIVE_E2_ENDPOINT}/${process.env.IDRIVE_E2_BUCKET_NAME}/${fileKey}`;\r\n\r\n    res.status(200).json({\r\n      message: 'File uploaded successfully',\r\n      url,\r\n      key: fileKey,\r\n    });\r\n  } catch (error) {\r\n    logger.error('Upload error:', error as Error);\r\n    res.status(500).json({ error: 'Upload failed' });\r\n  }\r\n};\r\n\r\nexport const getFileUrl = async (req: Request, res: Response) => {\r\n  try {\r\n    const { key } = req.params;\r\n\r\n    if (!key) {\r\n      res.status(400).json({ error: 'Missing file key' });\r\n      return;\r\n    }\r\n\r\n    const command = new GetObjectCommand({\r\n      Bucket: process.env.IDRIVE_E2_BUCKET_NAME!,\r\n      Key: key,\r\n    });\r\n\r\n    const url = await getSignedUrl(s3, command, { expiresIn: 60 * 5 });\r\n\r\n    res.status(200).json({ url });\r\n  } catch (error) {\r\n    logger.error('URL error:', error as Error);\r\n    res.status(500).json({ error: 'Failed to generate file URL' });\r\n  }\r\n};\r\n\r\n/**\r\n * @swagger\r\n * /media/saveImage:\r\n *   post:\r\n *     summary: Sube una imagen de perfil de m√∫sico\r\n *     consumes:\r\n *       - multipart/form-data\r\n *     requestBody:\r\n *       required: true\r\n *       content:\r\n *         multipart/form-data:\r\n *           schema:\r\n *             type: object\r\n *             properties:\r\n *               file:\r\n *                 type: string\r\n *                 format: binary\r\n *     responses:\r\n *       200:\r\n *         description: Imagen subida exitosamente\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 message:\r\n *                   type: string\r\n *                 url:\r\n *                   type: string\r\n *                 key:\r\n *                   type: string\r\n *\r\n * /media/getImage/{key}:\r\n *   get:\r\n *     summary: Obtiene la URL firmada de una imagen subida\r\n *     parameters:\r\n *       - in: path\r\n *         name: key\r\n *         schema:\r\n *           type: string\r\n *         required: true\r\n *         description: Clave de la imagen\r\n *     responses:\r\n *       200:\r\n *         description: URL firmada obtenida\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 url:\r\n *                   type: string\r\n */\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}