9276830f623e1d947fc47c7bac6daac7
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock de la base de datos
jest.mock('../utils/firebase', () => ({
    db: {
        collection: jest.fn(() => ({
            where: jest.fn(() => ({
                where: jest.fn(() => ({
                    where: jest.fn(() => ({
                        get: jest.fn(() => Promise.resolve({
                            docs: [],
                            empty: true,
                        })),
                    })),
                })),
                get: jest.fn(() => Promise.resolve({
                    docs: [],
                    empty: true,
                })),
            })),
            doc: jest.fn(() => ({
                get: jest.fn(() => Promise.resolve({
                    exists: false,
                    data: () => null,
                })),
            })),
        })),
    },
}));
// Tests para el sistema de búsqueda de músicos
const musicianSearchService_1 = require("../services/musicianSearchService");
describe('Sistema de Búsqueda de Músicos', () => {
    describe('MusicianSearchService', () => {
        const mockEvent = {
            id: 'test-event-1',
            user: 'organizer@example.com',
            eventName: 'Fiesta de Cumpleaños',
            eventType: 'private',
            date: '2025-02-15',
            time: '18:00',
            location: 'Santo Domingo, RD',
            duration: '03:00',
            instrument: 'Guitarra',
            bringInstrument: false,
            comment: 'Necesito un guitarrista para mi fiesta',
            budget: '5000',
            flyerUrl: '',
            songs: ['Happy Birthday', 'Despacito'],
            recommendations: [],
            mapsLink: '',
            status: 'pending_musician',
            createdAt: '2025-01-15T10:00:00Z',
            updatedAt: '2025-01-15T10:00:00Z',
        };
        const mockCriteria = {
            instrument: 'Guitarra',
            location: 'Santo Domingo, RD',
            budget: 5000,
            date: '2025-02-15',
            time: '18:00',
            duration: '03:00',
            eventType: 'private',
            maxDistance: 50,
        };
        describe('searchMusiciansForEvent', () => {
            test('should return empty array when no musicians available', () => __awaiter(void 0, void 0, void 0, function* () {
                const result = yield musicianSearchService_1.MusicianSearchService.searchMusiciansForEvent(mockEvent, mockCriteria);
                expect(result).toEqual([]);
            }));
            test('should handle errors gracefully', () => __awaiter(void 0, void 0, void 0, function* () {
                // Mock para simular un error
                const mockDb = require('../utils/firebase').db;
                mockDb.collection.mockImplementation(() => {
                    throw new Error('Database error');
                });
                yield expect(musicianSearchService_1.MusicianSearchService.searchMusiciansForEvent(mockEvent, mockCriteria)).rejects.toThrow('Database error');
            }));
        });
        describe('getRecommendedMusicians', () => {
            test('should throw error when event not found', () => __awaiter(void 0, void 0, void 0, function* () {
                // Mock para simular evento no encontrado
                const mockDb = require('../utils/firebase').db;
                mockDb.collection.mockImplementation(() => ({
                    doc: jest.fn(() => ({
                        get: jest.fn(() => Promise.resolve({
                            exists: false,
                            data: () => null,
                        })),
                    })),
                }));
                yield expect(musicianSearchService_1.MusicianSearchService.getRecommendedMusicians('non-existent-event')).rejects.toThrow('Evento no encontrado');
            }));
        });
        describe('parseDuration', () => {
            test('should parse duration correctly', () => {
                // Acceder al método privado para testing
                const service = musicianSearchService_1.MusicianSearchService;
                expect(service.parseDuration('02:30')).toBe(150); // 2h 30m = 150 minutos
                expect(service.parseDuration('01:00')).toBe(60); // 1h = 60 minutos
                expect(service.parseDuration('00:45')).toBe(45); // 45 minutos
                expect(service.parseDuration('03:15')).toBe(195); // 3h 15m = 195 minutos
            });
            test('should handle invalid duration format', () => {
                const service = musicianSearchService_1.MusicianSearchService;
                expect(service.parseDuration('invalid')).toBe(0);
                expect(service.parseDuration('')).toBe(0);
                expect(service.parseDuration('2:30')).toBe(150); // 2h 30m = 150 minutos
            });
        });
        describe('calculateDistance', () => {
            test('should return a number between 0 and 50', () => {
                const service = musicianSearchService_1.MusicianSearchService;
                const distance = service.calculateDistance('Location A', 'Location B');
                expect(typeof distance).toBe('number');
                expect(distance).toBeGreaterThanOrEqual(0);
                expect(distance).toBeLessThanOrEqual(50);
            });
        });
    });
    describe('Criterios de Búsqueda', () => {
        test('should validate search criteria structure', () => {
            const criteria = {
                instrument: 'Piano',
                location: 'Santiago, RD',
                budget: 3000,
                date: '2025-03-20',
                time: '20:00',
                duration: '02:00',
                eventType: 'wedding',
                maxDistance: 30,
            };
            expect(criteria.instrument).toBe('Piano');
            expect(criteria.budget).toBe(3000);
            expect(criteria.maxDistance).toBe(30);
        });
        test('should handle optional criteria fields', () => {
            const minimalCriteria = {
                instrument: 'Violín',
            };
            expect(minimalCriteria.instrument).toBe('Violín');
            expect(minimalCriteria.location).toBeUndefined();
            expect(minimalCriteria.budget).toBeUndefined();
        });
    });
    describe('Resultados de Búsqueda', () => {
        test('should have correct result structure', () => {
            const mockResult = {
                userEmail: 'musician@example.com',
                name: 'Juan',
                lastName: 'Pérez',
                instruments: ['Guitarra', 'Piano'],
                hasOwnInstruments: true,
                experience: 5,
                hourlyRate: 2000,
                location: 'Santo Domingo, RD',
                isAvailable: true,
                rating: 4.5,
                matchScore: 85,
                availability: {
                    isAvailable: true,
                    conflicts: [],
                },
            };
            expect(mockResult.userEmail).toBe('musician@example.com');
            expect(mockResult.instruments).toContain('Guitarra');
            expect(mockResult.matchScore).toBeGreaterThanOrEqual(0);
            expect(mockResult.matchScore).toBeLessThanOrEqual(100);
            expect(mockResult.availability.isAvailable).toBe(true);
        });
        test('should validate match score range', () => {
            const mockResults = [
                { matchScore: 0 },
                { matchScore: 50 },
                { matchScore: 100 },
                { matchScore: 85 },
            ];
            mockResults.forEach(result => {
                expect(result.matchScore).toBeGreaterThanOrEqual(0);
                expect(result.matchScore).toBeLessThanOrEqual(100);
            });
        });
    });
    describe('Algoritmo de Scoring', () => {
        test('should calculate instrument score correctly', () => {
            // Simular cálculo de puntuación por instrumento (40 puntos)
            const instrumentScore = 40;
            expect(instrumentScore).toBe(40);
        });
        test('should calculate instrument availability score correctly', () => {
            // Simular cálculo de puntuación por disponibilidad de instrumento
            const hasOwnInstruments = true;
            const instrumentAvailabilityScore = hasOwnInstruments ? 15 : 5;
            expect(instrumentAvailabilityScore).toBe(15);
        });
        test('should calculate experience score correctly', () => {
            // Simular cálculo de puntuación por experiencia (máximo 20 puntos)
            const experience = 8;
            const experienceScore = Math.min(experience * 2, 20);
            expect(experienceScore).toBe(16);
        });
        test('should calculate rating score correctly', () => {
            // Simular cálculo de puntuación por rating (máximo 15 puntos)
            const rating = 4.5;
            const ratingScore = (rating / 5) * 15;
            expect(ratingScore).toBe(13.5);
        });
        test('should calculate budget score correctly', () => {
            // Simular cálculo de puntuación por presupuesto
            const hourlyRate = 2000;
            const eventDuration = 180; // 3 horas en minutos
            const budget = 5000;
            const hourlyCost = hourlyRate * eventDuration / 60;
            let budgetScore = 0;
            if (hourlyCost <= budget) {
                budgetScore = 10;
            }
            else if (hourlyCost <= budget * 1.2) {
                budgetScore = 5;
            }
            expect(budgetScore).toBe(5); // 6000 > 5000, pero 6000 <= 5000 * 1.2 = 6000
        });
    });
    describe('Validación de Disponibilidad', () => {
        test('should detect time conflicts correctly', () => {
            // Simular verificación de conflictos de horario
            const eventStart = new Date('2025-02-15T18:00:00');
            const eventEnd = new Date('2025-02-15T21:00:00');
            const conflictingEvent = {
                date: '2025-02-15',
                time: '19:00',
                duration: '02:00',
            };
            const conflictingEventStart = new Date(`${conflictingEvent.date}T${conflictingEvent.time}`);
            const conflictingEventEnd = new Date(conflictingEventStart.getTime() + 120 * 60 * 1000); // 2 horas
            // Verificar solapamiento
            const hasConflict = ((eventStart >= conflictingEventStart && eventStart < conflictingEventEnd) ||
                (eventEnd > conflictingEventStart && eventEnd <= conflictingEventEnd) ||
                (eventStart <= conflictingEventStart && eventEnd >= conflictingEventEnd));
            expect(hasConflict).toBe(true);
        });
        test('should not detect conflicts for non-overlapping events', () => {
            // Simular eventos que no se solapan
            const eventStart = new Date('2025-02-15T18:00:00');
            const eventEnd = new Date('2025-02-15T21:00:00');
            const nonConflictingEvent = {
                date: '2025-02-15',
                time: '22:00',
                duration: '02:00',
            };
            const nonConflictingEventStart = new Date(`${nonConflictingEvent.date}T${nonConflictingEvent.time}`);
            const nonConflictingEventEnd = new Date(nonConflictingEventStart.getTime() + 120 * 60 * 1000);
            // Verificar que no hay solapamiento
            const hasConflict = ((eventStart >= nonConflictingEventStart && eventStart < nonConflictingEventEnd) ||
                (eventEnd > nonConflictingEventStart && eventEnd <= nonConflictingEventEnd) ||
                (eventStart <= nonConflictingEventStart && eventEnd >= nonConflictingEventEnd));
            expect(hasConflict).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXG11c2ljaWFuU2VhcmNoLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFJQSwyQkFBMkI7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLEVBQUUsRUFBRTtRQUNGLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDekIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDcEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztvQkFDcEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQzt3QkFDcEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQzs0QkFDakMsSUFBSSxFQUFFLEVBQUU7NEJBQ1IsS0FBSyxFQUFFLElBQUk7eUJBQ1osQ0FBQyxDQUFDO3FCQUNKLENBQUMsQ0FBQztpQkFDSixDQUFDLENBQUM7Z0JBQ0gsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQztvQkFDakMsSUFBSSxFQUFFLEVBQUU7b0JBQ1IsS0FBSyxFQUFFLElBQUk7aUJBQ1osQ0FBQyxDQUFDO2FBQ0osQ0FBQyxDQUFDO1lBQ0gsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDbEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQztvQkFDakMsTUFBTSxFQUFFLEtBQUs7b0JBQ2IsSUFBSSxFQUFF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LFVBQVUsSUFBSSx3QkFBd0IsSUFBSSxVQUFVLEdBQUcsc0JBQXNCLENBQUM7Z0JBQy9FLENBQUMsUUFBUSxHQUFHLHdCQUF3QixJQUFJLFFBQVEsSUFBSSxzQkFBc0IsQ0FBQztnQkFDM0UsQ0FBQyxVQUFVLElBQUksd0JBQXdCLElBQUksUUFBUSxJQUFJLHNCQUFzQixDQUFDLENBQy9FLENBQUM7WUFFRixNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcc3JjXFxBUFBfTXVzc2lrT25cXEFQUF9NdXNzaWtPbl9FeHByZXNzXFxzcmNcXF9fdGVzdHNfX1xcbXVzaWNpYW5TZWFyY2gudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUZXN0cyBwYXJhIGVsIHNpc3RlbWEgZGUgYsO6c3F1ZWRhIGRlIG3DunNpY29zXHJcbmltcG9ydCB7IE11c2ljaWFuU2VhcmNoU2VydmljZSwgTXVzaWNpYW5TZWFyY2hDcml0ZXJpYSB9IGZyb20gJy4uL3NlcnZpY2VzL211c2ljaWFuU2VhcmNoU2VydmljZSc7XHJcbmltcG9ydCB7IEV2ZW50IH0gZnJvbSAnLi4vdXRpbHMvRGF0YVR5cGVzJztcclxuXHJcbi8vIE1vY2sgZGUgbGEgYmFzZSBkZSBkYXRvc1xyXG5qZXN0Lm1vY2soJy4uL3V0aWxzL2ZpcmViYXNlJywgKCkgPT4gKHtcclxuICBkYjoge1xyXG4gICAgY29sbGVjdGlvbjogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICB3aGVyZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIHdoZXJlOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICB3aGVyZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBnZXQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHtcclxuICAgICAgICAgICAgICBkb2NzOiBbXSxcclxuICAgICAgICAgICAgICBlbXB0eTogdHJ1ZSxcclxuICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHtcclxuICAgICAgICAgIGRvY3M6IFtdLFxyXG4gICAgICAgICAgZW1wdHk6IHRydWUsXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSksXHJcbiAgICAgIGRvYzogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGdldDogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoe1xyXG4gICAgICAgICAgZXhpc3RzOiBmYWxzZSxcclxuICAgICAgICAgIGRhdGE6ICgpID0+IG51bGwsXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSksXHJcbiAgICB9KSksXHJcbiAgfSxcclxufSkpO1xyXG5cclxuZGVzY3JpYmUoJ1Npc3RlbWEgZGUgQsO6c3F1ZWRhIGRlIE3DunNpY29zJywgKCkgPT4ge1xyXG4gIGRlc2NyaWJlKCdNdXNpY2lhblNlYXJjaFNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBtb2NrRXZlbnQ6IEV2ZW50ID0ge1xyXG4gICAgICBpZDogJ3Rlc3QtZXZlbnQtMScsXHJcbiAgICAgIHVzZXI6ICdvcmdhbml6ZXJAZXhhbXBsZS5jb20nLFxyXG4gICAgICBldmVudE5hbWU6ICdGaWVzdGEgZGUgQ3VtcGxlYcOxb3MnLFxyXG4gICAgICBldmVudFR5cGU6ICdwcml2YXRlJyxcclxuICAgICAgZGF0ZTogJzIwMjUtMDItMTUnLFxyXG4gICAgICB0aW1lOiAnMTg6MDAnLFxyXG4gICAgICBsb2NhdGlvbjogJ1NhbnRvIERvbWluZ28sIFJEJyxcclxuICAgICAgZHVyYXRpb246ICcwMzowMCcsXHJcbiAgICAgIGluc3RydW1lbnQ6ICdHdWl0YXJyYScsXHJcbiAgICAgIGJyaW5nSW5zdHJ1bWVudDogZmFsc2UsXHJcbiAgICAgIGNvbW1lbnQ6ICdOZWNlc2l0byB1biBndWl0YXJyaXN0YSBwYXJhIG1pIGZpZXN0YScsXHJcbiAgICAgIGJ1ZGdldDogJzUwMDAnLFxyXG4gICAgICBmbHllclVybDogJycsXHJcbiAgICAgIHNvbmdzOiBbJ0hhcHB5IEJpcnRoZGF5JywgJ0Rlc3BhY2l0byddLFxyXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxyXG4gICAgICBtYXBzTGluazogJycsXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmdfbXVzaWNpYW4nLFxyXG4gICAgICBjcmVhdGVkQXQ6ICcyMDI1LTAxLTE1VDEwOjAwOjAwWicsXHJcbiAgICAgIHVwZGF0ZWRBdDogJzIwMjUtMDEtMTVUMTA6MDA6MDBaJyxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgbW9ja0NyaXRlcmlhOiBNdXNpY2lhblNlYXJjaENyaXRlcmlhID0ge1xyXG4gICAgICBpbnN0cnVtZW50OiAnR3VpdGFycmEnLFxyXG4gICAgICBsb2NhdGlvbjogJ1NhbnRvIERvbWluZ28sIFJEJyxcclxuICAgICAgYnVkZ2V0OiA1MDAwLFxyXG4gICAgICBkYXRlOiAnMjAyNS0wMi0xNScsXHJcbiAgICAgIHRpbWU6ICcxODowMCcsXHJcbiAgICAgIGR1cmF0aW9uOiAnMDM6MDAnLFxyXG4gICAgICBldmVudFR5cGU6ICdwcml2YXRlJyxcclxuICAgICAgbWF4RGlzdGFuY2U6IDUwLFxyXG4gICAgfTtcclxuXHJcbiAgICBkZXNjcmliZSgnc2VhcmNoTXVzaWNpYW5zRm9yRXZlbnQnLCAoKSA9PiB7XHJcbiAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgd2hlbiBubyBtdXNpY2lhbnMgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE11c2ljaWFuU2VhcmNoU2VydmljZS5zZWFyY2hNdXNpY2lhbnNGb3JFdmVudChtb2NrRXZlbnQsIG1vY2tDcml0ZXJpYSk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAvLyBNb2NrIHBhcmEgc2ltdWxhciB1biBlcnJvclxyXG4gICAgICAgIGNvbnN0IG1vY2tEYiA9IHJlcXVpcmUoJy4uL3V0aWxzL2ZpcmViYXNlJykuZGI7XHJcbiAgICAgICAgbW9ja0RiLmNvbGxlY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgYXdhaXQgZXhwZWN0KFxyXG4gICAgICAgICAgTXVzaWNpYW5TZWFyY2hTZXJ2aWNlLnNlYXJjaE11c2ljaWFuc0ZvckV2ZW50KG1vY2tFdmVudCwgbW9ja0NyaXRlcmlhKVxyXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBlcnJvcicpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRSZWNvbW1lbmRlZE11c2ljaWFucycsICgpID0+IHtcclxuICAgICAgdGVzdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gZXZlbnQgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIC8vIE1vY2sgcGFyYSBzaW11bGFyIGV2ZW50byBubyBlbmNvbnRyYWRvXHJcbiAgICAgICAgY29uc3QgbW9ja0RiID0gcmVxdWlyZSgnLi4vdXRpbHMvZmlyZWJhc2UnKS5kYjtcclxuICAgICAgICBtb2NrRGIuY29sbGVjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICAgIGRvYzogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBnZXQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHtcclxuICAgICAgICAgICAgICBleGlzdHM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIGRhdGE6ICgpID0+IG51bGwsXHJcbiAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIGF3YWl0IGV4cGVjdChcclxuICAgICAgICAgIE11c2ljaWFuU2VhcmNoU2VydmljZS5nZXRSZWNvbW1lbmRlZE11c2ljaWFucygnbm9uLWV4aXN0ZW50LWV2ZW50JylcclxuICAgICAgICApLnJlamVjdHMudG9UaHJvdygnRXZlbnRvIG5vIGVuY29udHJhZG8nKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgncGFyc2VEdXJhdGlvbicsICgpID0+IHtcclxuICAgICAgdGVzdCgnc2hvdWxkIHBhcnNlIGR1cmF0aW9uIGNvcnJlY3RseScsICgpID0+IHtcclxuICAgICAgICAvLyBBY2NlZGVyIGFsIG3DqXRvZG8gcHJpdmFkbyBwYXJhIHRlc3RpbmdcclxuICAgICAgICBjb25zdCBzZXJ2aWNlID0gTXVzaWNpYW5TZWFyY2hTZXJ2aWNlIGFzIGFueTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3Qoc2VydmljZS5wYXJzZUR1cmF0aW9uKCcwMjozMCcpKS50b0JlKDE1MCk7IC8vIDJoIDMwbSA9IDE1MCBtaW51dG9zXHJcbiAgICAgICAgZXhwZWN0KHNlcnZpY2UucGFyc2VEdXJhdGlvbignMDE6MDAnKSkudG9CZSg2MCk7IC8vIDFoID0gNjAgbWludXRvc1xyXG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLnBhcnNlRHVyYXRpb24oJzAwOjQ1JykpLnRvQmUoNDUpOyAvLyA0NSBtaW51dG9zXHJcbiAgICAgICAgZXhwZWN0KHNlcnZpY2UucGFyc2VEdXJhdGlvbignMDM6MTUnKSkudG9CZSgxOTUpOyAvLyAzaCAxNW0gPSAxOTUgbWludXRvc1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBkdXJhdGlvbiBmb3JtYXQnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc2VydmljZSA9IE11c2ljaWFuU2VhcmNoU2VydmljZSBhcyBhbnk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KHNlcnZpY2UucGFyc2VEdXJhdGlvbignaW52YWxpZCcpKS50b0JlKDApO1xyXG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLnBhcnNlRHVyYXRpb24oJycpKS50b0JlKDApO1xyXG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLnBhcnNlRHVyYXRpb24oJzI6MzAnKSkudG9CZSgxNTApOyAvLyAyaCAzMG0gPSAxNTAgbWludXRvc1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjYWxjdWxhdGVEaXN0YW5jZScsICgpID0+IHtcclxuICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiBhIG51bWJlciBiZXR3ZWVuIDAgYW5kIDUwJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2UgPSBNdXNpY2lhblNlYXJjaFNlcnZpY2UgYXMgYW55O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGRpc3RhbmNlID0gc2VydmljZS5jYWxjdWxhdGVEaXN0YW5jZSgnTG9jYXRpb24gQScsICdMb2NhdGlvbiBCJyk7XHJcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBkaXN0YW5jZSkudG9CZSgnbnVtYmVyJyk7XHJcbiAgICAgICAgZXhwZWN0KGRpc3RhbmNlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xyXG4gICAgICAgIGV4cGVjdChkaXN0YW5jZSkudG9CZUxlc3NUaGFuT3JFcXVhbCg1MCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDcml0ZXJpb3MgZGUgQsO6c3F1ZWRhJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIHNlYXJjaCBjcml0ZXJpYSBzdHJ1Y3R1cmUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNyaXRlcmlhOiBNdXNpY2lhblNlYXJjaENyaXRlcmlhID0ge1xyXG4gICAgICAgIGluc3RydW1lbnQ6ICdQaWFubycsXHJcbiAgICAgICAgbG9jYXRpb246ICdTYW50aWFnbywgUkQnLFxyXG4gICAgICAgIGJ1ZGdldDogMzAwMCxcclxuICAgICAgICBkYXRlOiAnMjAyNS0wMy0yMCcsXHJcbiAgICAgICAgdGltZTogJzIwOjAwJyxcclxuICAgICAgICBkdXJhdGlvbjogJzAyOjAwJyxcclxuICAgICAgICBldmVudFR5cGU6ICd3ZWRkaW5nJyxcclxuICAgICAgICBtYXhEaXN0YW5jZTogMzAsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBleHBlY3QoY3JpdGVyaWEuaW5zdHJ1bWVudCkudG9CZSgnUGlhbm8nKTtcclxuICAgICAgZXhwZWN0KGNyaXRlcmlhLmJ1ZGdldCkudG9CZSgzMDAwKTtcclxuICAgICAgZXhwZWN0KGNyaXRlcmlhLm1heERpc3RhbmNlKS50b0JlKDMwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgb3B0aW9uYWwgY3JpdGVyaWEgZmllbGRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtaW5pbWFsQ3JpdGVyaWE6IE11c2ljaWFuU2VhcmNoQ3JpdGVyaWEgPSB7XHJcbiAgICAgICAgaW5zdHJ1bWVudDogJ1Zpb2zDrW4nLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgZXhwZWN0KG1pbmltYWxDcml0ZXJpYS5pbnN0cnVtZW50KS50b0JlKCdWaW9sw61uJyk7XHJcbiAgICAgIGV4cGVjdChtaW5pbWFsQ3JpdGVyaWEubG9jYXRpb24pLnRvQmVVbmRlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KG1pbmltYWxDcml0ZXJpYS5idWRnZXQpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUmVzdWx0YWRvcyBkZSBCw7pzcXVlZGEnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IHJlc3VsdCBzdHJ1Y3R1cmUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XHJcbiAgICAgICAgdXNlckVtYWlsOiAnbXVzaWNpYW5AZXhhbXBsZS5jb20nLFxyXG4gICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICBsYXN0TmFtZTogJ1DDqXJleicsXHJcbiAgICAgICAgaW5zdHJ1bWVudHM6IFsnR3VpdGFycmEnLCAnUGlhbm8nXSxcclxuICAgICAgICBoYXNPd25JbnN0cnVtZW50czogdHJ1ZSxcclxuICAgICAgICBleHBlcmllbmNlOiA1LFxyXG4gICAgICAgIGhvdXJseVJhdGU6IDIwMDAsXHJcbiAgICAgICAgbG9jYXRpb246ICdTYW50byBEb21pbmdvLCBSRCcsXHJcbiAgICAgICAgaXNBdmFpbGFibGU6IHRydWUsXHJcbiAgICAgICAgcmF0aW5nOiA0LjUsXHJcbiAgICAgICAgbWF0Y2hTY29yZTogODUsXHJcbiAgICAgICAgYXZhaWxhYmlsaXR5OiB7XHJcbiAgICAgICAgICBpc0F2YWlsYWJsZTogdHJ1ZSxcclxuICAgICAgICAgIGNvbmZsaWN0czogW10sXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzdWx0LnVzZXJFbWFpbCkudG9CZSgnbXVzaWNpYW5AZXhhbXBsZS5jb20nKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXN1bHQuaW5zdHJ1bWVudHMpLnRvQ29udGFpbignR3VpdGFycmEnKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXN1bHQubWF0Y2hTY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXN1bHQubWF0Y2hTY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbCgxMDApO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3VsdC5hdmFpbGFiaWxpdHkuaXNBdmFpbGFibGUpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgbWF0Y2ggc2NvcmUgcmFuZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHRzID0gW1xyXG4gICAgICAgIHsgbWF0Y2hTY29yZTogMCB9LFxyXG4gICAgICAgIHsgbWF0Y2hTY29yZTogNTAgfSxcclxuICAgICAgICB7IG1hdGNoU2NvcmU6IDEwMCB9LFxyXG4gICAgICAgIHsgbWF0Y2hTY29yZTogODUgfSxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIG1vY2tSZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcclxuICAgICAgICBleHBlY3QocmVzdWx0Lm1hdGNoU2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaFNjb3JlKS50b0JlTGVzc1RoYW5PckVxdWFsKDEwMCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdBbGdvcml0bW8gZGUgU2NvcmluZycsICgpID0+IHtcclxuICAgIHRlc3QoJ3Nob3VsZCBjYWxjdWxhdGUgaW5zdHJ1bWVudCBzY29yZSBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIC8vIFNpbXVsYXIgY8OhbGN1bG8gZGUgcHVudHVhY2nDs24gcG9yIGluc3RydW1lbnRvICg0MCBwdW50b3MpXHJcbiAgICAgIGNvbnN0IGluc3RydW1lbnRTY29yZSA9IDQwO1xyXG4gICAgICBleHBlY3QoaW5zdHJ1bWVudFNjb3JlKS50b0JlKDQwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBjYWxjdWxhdGUgaW5zdHJ1bWVudCBhdmFpbGFiaWxpdHkgc2NvcmUgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICAvLyBTaW11bGFyIGPDoWxjdWxvIGRlIHB1bnR1YWNpw7NuIHBvciBkaXNwb25pYmlsaWRhZCBkZSBpbnN0cnVtZW50b1xyXG4gICAgICBjb25zdCBoYXNPd25JbnN0cnVtZW50cyA9IHRydWU7XHJcbiAgICAgIGNvbnN0IGluc3RydW1lbnRBdmFpbGFiaWxpdHlTY29yZSA9IGhhc093bkluc3RydW1lbnRzID8gMTUgOiA1O1xyXG4gICAgICBleHBlY3QoaW5zdHJ1bWVudEF2YWlsYWJpbGl0eVNjb3JlKS50b0JlKDE1KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBjYWxjdWxhdGUgZXhwZXJpZW5jZSBzY29yZSBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIC8vIFNpbXVsYXIgY8OhbGN1bG8gZGUgcHVudHVhY2nDs24gcG9yIGV4cGVyaWVuY2lhIChtw6F4aW1vIDIwIHB1bnRvcylcclxuICAgICAgY29uc3QgZXhwZXJpZW5jZSA9IDg7XHJcbiAgICAgIGNvbnN0IGV4cGVyaWVuY2VTY29yZSA9IE1hdGgubWluKGV4cGVyaWVuY2UgKiAyLCAyMCk7XHJcbiAgICAgIGV4cGVjdChleHBlcmllbmNlU2NvcmUpLnRvQmUoMTYpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGNhbGN1bGF0ZSByYXRpbmcgc2NvcmUgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICAvLyBTaW11bGFyIGPDoWxjdWxvIGRlIHB1bnR1YWNpw7NuIHBvciByYXRpbmcgKG3DoXhpbW8gMTUgcHVudG9zKVxyXG4gICAgICBjb25zdCByYXRpbmcgPSA0LjU7XHJcbiAgICAgIGNvbnN0IHJhdGluZ1Njb3JlID0gKHJhdGluZyAvIDUpICogMTU7XHJcbiAgICAgIGV4cGVjdChyYXRpbmdTY29yZSkudG9CZSgxMy41KTtcclxuICAgIH0pO1xyXG5cclxuICAgICAgICAgIHRlc3QoJ3Nob3VsZCBjYWxjdWxhdGUgYnVkZ2V0IHNjb3JlIGNvcnJlY3RseScsICgpID0+IHtcclxuICAgICAgICAvLyBTaW11bGFyIGPDoWxjdWxvIGRlIHB1bnR1YWNpw7NuIHBvciBwcmVzdXB1ZXN0b1xyXG4gICAgICAgIGNvbnN0IGhvdXJseVJhdGUgPSAyMDAwO1xyXG4gICAgICAgIGNvbnN0IGV2ZW50RHVyYXRpb24gPSAxODA7IC8vIDMgaG9yYXMgZW4gbWludXRvc1xyXG4gICAgICAgIGNvbnN0IGJ1ZGdldCA9IDUwMDA7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgaG91cmx5Q29zdCA9IGhvdXJseVJhdGUgKiBldmVudER1cmF0aW9uIC8gNjA7XHJcbiAgICAgICAgbGV0IGJ1ZGdldFNjb3JlID0gMDtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoaG91cmx5Q29zdCA8PSBidWRnZXQpIHtcclxuICAgICAgICAgIGJ1ZGdldFNjb3JlID0gMTA7XHJcbiAgICAgICAgfSBlbHNlIGlmIChob3VybHlDb3N0IDw9IGJ1ZGdldCAqIDEuMikge1xyXG4gICAgICAgICAgYnVkZ2V0U2NvcmUgPSA1O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QoYnVkZ2V0U2NvcmUpLnRvQmUoNSk7IC8vIDYwMDAgPiA1MDAwLCBwZXJvIDYwMDAgPD0gNTAwMCAqIDEuMiA9IDYwMDBcclxuICAgICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdWYWxpZGFjacOzbiBkZSBEaXNwb25pYmlsaWRhZCcsICgpID0+IHtcclxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgdGltZSBjb25mbGljdHMgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICAvLyBTaW11bGFyIHZlcmlmaWNhY2nDs24gZGUgY29uZmxpY3RvcyBkZSBob3JhcmlvXHJcbiAgICAgIGNvbnN0IGV2ZW50U3RhcnQgPSBuZXcgRGF0ZSgnMjAyNS0wMi0xNVQxODowMDowMCcpO1xyXG4gICAgICBjb25zdCBldmVudEVuZCA9IG5ldyBEYXRlKCcyMDI1LTAyLTE1VDIxOjAwOjAwJyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBjb25mbGljdGluZ0V2ZW50ID0ge1xyXG4gICAgICAgIGRhdGU6ICcyMDI1LTAyLTE1JyxcclxuICAgICAgICB0aW1lOiAnMTk6MDAnLFxyXG4gICAgICAgIGR1cmF0aW9uOiAnMDI6MDAnLFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgY29uZmxpY3RpbmdFdmVudFN0YXJ0ID0gbmV3IERhdGUoYCR7Y29uZmxpY3RpbmdFdmVudC5kYXRlfVQke2NvbmZsaWN0aW5nRXZlbnQudGltZX1gKTtcclxuICAgICAgY29uc3QgY29uZmxpY3RpbmdFdmVudEVuZCA9IG5ldyBEYXRlKGNvbmZsaWN0aW5nRXZlbnRTdGFydC5nZXRUaW1lKCkgKyAxMjAgKiA2MCAqIDEwMDApOyAvLyAyIGhvcmFzXHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYXIgc29sYXBhbWllbnRvXHJcbiAgICAgIGNvbnN0IGhhc0NvbmZsaWN0ID0gKFxyXG4gICAgICAgIChldmVudFN0YXJ0ID49IGNvbmZsaWN0aW5nRXZlbnRTdGFydCAmJiBldmVudFN0YXJ0IDwgY29uZmxpY3RpbmdFdmVudEVuZCkgfHxcclxuICAgICAgICAoZXZlbnRFbmQgPiBjb25mbGljdGluZ0V2ZW50U3RhcnQgJiYgZXZlbnRFbmQgPD0gY29uZmxpY3RpbmdFdmVudEVuZCkgfHxcclxuICAgICAgICAoZXZlbnRTdGFydCA8PSBjb25mbGljdGluZ0V2ZW50U3RhcnQgJiYgZXZlbnRFbmQgPj0gY29uZmxpY3RpbmdFdmVudEVuZClcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChoYXNDb25mbGljdCkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBub3QgZGV0ZWN0IGNvbmZsaWN0cyBmb3Igbm9uLW92ZXJsYXBwaW5nIGV2ZW50cycsICgpID0+IHtcclxuICAgICAgLy8gU2ltdWxhciBldmVudG9zIHF1ZSBubyBzZSBzb2xhcGFuXHJcbiAgICAgIGNvbnN0IGV2ZW50U3RhcnQgPSBuZXcgRGF0ZSgnMjAyNS0wMi0xNVQxODowMDowMCcpO1xyXG4gICAgICBjb25zdCBldmVudEVuZCA9IG5ldyBEYXRlKCcyMDI1LTAyLTE1VDIxOjAwOjAwJyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBub25Db25mbGljdGluZ0V2ZW50ID0ge1xyXG4gICAgICAgIGRhdGU6ICcyMDI1LTAyLTE1JyxcclxuICAgICAgICB0aW1lOiAnMjI6MDAnLFxyXG4gICAgICAgIGR1cmF0aW9uOiAnMDI6MDAnLFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3Qgbm9uQ29uZmxpY3RpbmdFdmVudFN0YXJ0ID0gbmV3IERhdGUoYCR7bm9uQ29uZmxpY3RpbmdFdmVudC5kYXRlfVQke25vbkNvbmZsaWN0aW5nRXZlbnQudGltZX1gKTtcclxuICAgICAgY29uc3Qgbm9uQ29uZmxpY3RpbmdFdmVudEVuZCA9IG5ldyBEYXRlKG5vbkNvbmZsaWN0aW5nRXZlbnRTdGFydC5nZXRUaW1lKCkgKyAxMjAgKiA2MCAqIDEwMDApO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBubyBoYXkgc29sYXBhbWllbnRvXHJcbiAgICAgIGNvbnN0IGhhc0NvbmZsaWN0ID0gKFxyXG4gICAgICAgIChldmVudFN0YXJ0ID49IG5vbkNvbmZsaWN0aW5nRXZlbnRTdGFydCAmJiBldmVudFN0YXJ0IDwgbm9uQ29uZmxpY3RpbmdFdmVudEVuZCkgfHxcclxuICAgICAgICAoZXZlbnRFbmQgPiBub25Db25mbGljdGluZ0V2ZW50U3RhcnQgJiYgZXZlbnRFbmQgPD0gbm9uQ29uZmxpY3RpbmdFdmVudEVuZCkgfHxcclxuICAgICAgICAoZXZlbnRTdGFydCA8PSBub25Db25mbGljdGluZ0V2ZW50U3RhcnQgJiYgZXZlbnRFbmQgPj0gbm9uQ29uZmxpY3RpbmdFdmVudEVuZClcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChoYXNDb25mbGljdCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7ICJdLCJ2ZXJzaW9uIjozfQ==