{"version":3,"names":["errorHandler_1","cov_25vao7zrk3","s","require","requireRole","allowedRoles","f","req","res","next","user","b","console","log","OperationalError","email","userEmail","roll","includes","join","error","exports","requireAdmin","requireSuperAdmin","requireMusician","requireUser"],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\middleware\\requireRole.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { OperationalError } from './errorHandler';\r\n\r\n// Role-based access control middleware\r\nexport const requireRole = (allowedRoles: string[]) => {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    try {\r\n      const user = req.user;\r\n\r\n      if (!user) {\r\n        console.log('[src/middleware/requireRole.ts:10] Usuario no autenticado');\r\n        throw new OperationalError('Usuario no autenticado', 401);\r\n      }\r\n\r\n      console.log('[src/middleware/requireRole.ts:15] Usuario autenticado:', {\r\n        email: user.userEmail,\r\n        roll: user.roll,\r\n        allowedRoles\r\n      });\r\n\r\n      if (!allowedRoles.includes(user.roll)) {\r\n        console.log('[src/middleware/requireRole.ts:22] Acceso denegado - Rol no permitido');\r\n        throw new OperationalError(\r\n          `Acceso denegado. Roles permitidos: ${allowedRoles.join(', ')}`,\r\n          403\r\n        );\r\n      }\r\n\r\n      console.log('[src/middleware/requireRole.ts:28] Acceso permitido');\r\n      next();\r\n    } catch (error) {\r\n      next(error);\r\n    }\r\n  };\r\n};\r\n\r\n// Middleware espec√≠ficos para roles comunes \r\nexport const requireAdmin = requireRole(['admin', 'superadmin']);\r\nexport const requireSuperAdmin = requireRole(['superadmin']);\r\nexport const requireMusician = requireRole([\r\n  'musician',\r\n  'admin',\r\n  'superadmin',\r\n]);\r\nexport const requireUser = requireRole([\r\n  'user',\r\n  'musician',\r\n  'admin',\r\n  'superadmin',\r\n]);\r\n"],"mappings":"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","ignoreList":[]}