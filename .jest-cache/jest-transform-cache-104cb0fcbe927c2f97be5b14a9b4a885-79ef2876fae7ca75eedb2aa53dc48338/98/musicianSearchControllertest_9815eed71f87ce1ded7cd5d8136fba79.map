{"file":"C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\__tests__\\musicianSearchController.test.ts","mappings":"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","names":[],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\__tests__\\musicianSearchController.test.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport { MusicianSearchController } from '../controllers/musicianSearchController';\r\nimport { MusicianSearchService } from '../services/musicianSearchService';\r\nimport { getEventByIdModel } from '../models/eventModel';\r\n\r\n// Mock de los servicios\r\njest.mock('../services/musicianSearchService');\r\njest.mock('../models/eventModel');\r\n\r\ndescribe('MusicianSearchController', () => {\r\n  let mockRequest: Partial<Request>;\r\n  let mockResponse: Partial<Response>;\r\n  let mockJson: jest.Mock;\r\n  let mockStatus: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    mockJson = jest.fn().mockReturnThis();\r\n    mockStatus = jest.fn().mockReturnThis();\r\n    mockResponse = {\r\n      json: mockJson,\r\n      status: mockStatus,\r\n    };\r\n\r\n    // Limpiar todos los mocks\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('searchMusiciansForEvent', () => {\r\n    beforeEach(() => {\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          email: 'user@example.com',\r\n          role: 'eventCreator',\r\n          name: 'Test User',\r\n          userEmail: 'user@example.com',\r\n          roll: 'eventCreator'\r\n        },\r\n        body: {\r\n          eventId: 'event123',\r\n          criteria: {\r\n            instrument: 'guitarra',\r\n            location: 'Santiago, RD',\r\n            budget: 5000,\r\n            date: '2025-02-15',\r\n            time: '18:00',\r\n            duration: '03:00',\r\n            eventType: 'wedding',\r\n            maxDistance: 50\r\n          }\r\n        }\r\n      };\r\n    });\r\n\r\n    it('should search musicians for event successfully', async () => {\r\n      // Mock del evento\r\n      const mockEvent = {\r\n        id: 'event123',\r\n        user: 'user@example.com',\r\n        eventName: 'Boda en Santiago',\r\n        eventType: 'wedding',\r\n        date: '2025-02-15',\r\n        time: '18:00',\r\n        location: 'Santiago, RD',\r\n        duration: '03:00',\r\n        instrument: 'guitarra',\r\n        bringInstrument: false,\r\n        comment: 'Necesito un guitarrista para mi boda',\r\n        budget: '5000',\r\n        flyerUrl: '',\r\n        songs: ['Canción 1', 'Canción 2'],\r\n        recommendations: [],\r\n        mapsLink: '',\r\n        status: 'pending_musician',\r\n        createdAt: '2025-01-15T10:00:00Z',\r\n        updatedAt: '2025-01-15T10:00:00Z'\r\n      };\r\n\r\n      // Mock de músicos encontrados\r\n      const mockMusicians = [\r\n        {\r\n          id: 'musician1',\r\n          name: 'Juan Pérez',\r\n          instrument: 'guitarra',\r\n          rating: 4.5,\r\n          rate: 150\r\n        }\r\n      ];\r\n\r\n      // Configurar mocks\r\n      (getEventByIdModel as jest.Mock).mockResolvedValue(mockEvent);\r\n      (MusicianSearchService.searchMusiciansForEvent as jest.Mock).mockResolvedValue(mockMusicians);\r\n\r\n      await MusicianSearchController.searchMusiciansForEvent(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockJson).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          success: true,\r\n          message: 'Búsqueda de músicos completada exitosamente',\r\n          data: expect.objectContaining({\r\n            eventId: 'event123',\r\n            totalMusicians: 1,\r\n            musicians: mockMusicians\r\n          })\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should return error when user is not event creator', async () => {\r\n      mockRequest.user = {\r\n        userId: 'user123',\r\n        email: 'user@example.com',\r\n        role: 'musico',\r\n        name: 'Test User',\r\n        userEmail: 'user@example.com',\r\n        roll: 'musico'\r\n      };\r\n\r\n      await MusicianSearchController.searchMusiciansForEvent(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(403);\r\n      expect(mockJson).toHaveBeenCalledWith({\r\n        success: false,\r\n        message: 'Solo los creadores de eventos pueden buscar músicos'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('getRecommendedMusicians', () => {\r\n    beforeEach(() => {\r\n      mockRequest = {\r\n        user: {\r\n          userId: 'user123',\r\n          email: 'user@example.com',\r\n          role: 'eventCreator',\r\n          name: 'Test User',\r\n          userEmail: 'user@example.com',\r\n          roll: 'eventCreator'\r\n        },\r\n        params: {\r\n          eventId: 'event123'\r\n        }\r\n      };\r\n    });\r\n\r\n    it('should get recommended musicians successfully', async () => {\r\n      // Mock del evento\r\n      const mockEvent = {\r\n        id: 'event123',\r\n        user: 'user@example.com',\r\n        eventName: 'Boda en Santiago',\r\n        eventType: 'wedding',\r\n        date: '2025-02-15',\r\n        time: '18:00',\r\n        location: 'Santiago, RD',\r\n        duration: '03:00',\r\n        instrument: 'guitarra',\r\n        bringInstrument: false,\r\n        comment: 'Necesito un guitarrista para mi boda',\r\n        budget: '5000',\r\n        flyerUrl: '',\r\n        songs: ['Canción 1', 'Canción 2'],\r\n        recommendations: [],\r\n        mapsLink: '',\r\n        status: 'pending_musician',\r\n        createdAt: '2025-01-15T10:00:00Z',\r\n        updatedAt: '2025-01-15T10:00:00Z'\r\n      };\r\n\r\n      // Mock de músicos recomendados\r\n      const mockMusicians = [\r\n        {\r\n          id: 'musician1',\r\n          name: 'Juan Pérez',\r\n          instrument: 'guitarra',\r\n          rating: 4.5,\r\n          rate: 150\r\n        }\r\n      ];\r\n\r\n      // Configurar mocks\r\n      (getEventByIdModel as jest.Mock).mockResolvedValue(mockEvent);\r\n      (MusicianSearchService.getRecommendedMusicians as jest.Mock).mockResolvedValue(mockMusicians);\r\n\r\n      await MusicianSearchController.getRecommendedMusicians(mockRequest as Request, mockResponse as Response);\r\n\r\n      expect(mockJson).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          success: true,\r\n          message: 'Recomendaciones obtenidas exitosamente',\r\n          data: expect.objectContaining({\r\n            eventId: 'event123',\r\n            recommendations: mockMusicians,\r\n            totalRecommendations: 1\r\n          })\r\n        })\r\n      );\r\n    });\r\n  });\r\n}); "],"version":3}