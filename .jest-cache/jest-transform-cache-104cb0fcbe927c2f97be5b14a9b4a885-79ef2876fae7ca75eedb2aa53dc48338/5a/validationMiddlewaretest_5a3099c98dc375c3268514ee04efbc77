f0713f1f20254269193cdf34834c22c7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const validationMiddleware_1 = require("../middleware/validationMiddleware");
const validationSchemas_1 = require("../utils/validationSchemas");
const setup_1 = require("./setup");
describe('ValidationMiddleware', () => {
    let mockRequest;
    let mockResponse;
    let mockNext;
    let mockJson;
    let mockStatus;
    beforeEach(() => {
        mockJson = jest.fn();
        mockStatus = jest.fn().mockReturnValue({ json: mockJson });
        mockResponse = {
            status: mockStatus,
            json: mockJson
        };
        mockNext = jest.fn();
        // Reset de todos los mocks
        jest.clearAllMocks();
    });
    describe('validate', () => {
        it('should return 400 when validation fails with missing required fields', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'Juan',
                    lastName: 'Pérez'
                    // userEmail, userPassword, roll faltantes
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'userEmail',
                        message: 'El email es requerido',
                        type: 'any.required',
                        value: undefined
                    }),
                    expect.objectContaining({
                        field: 'userPassword',
                        message: 'La contraseña es requerida',
                        type: 'any.required',
                        value: undefined
                    }),
                    expect.objectContaining({
                        field: 'roll',
                        message: '"roll" is required',
                        type: 'any.required',
                        value: undefined
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should return 400 when email format is invalid', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'Juan',
                    lastName: 'Pérez',
                    userEmail: 'invalid-email',
                    userPassword: 'Password123!',
                    roll: 'musico'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'userEmail',
                        message: 'El email debe tener un formato válido',
                        type: 'string.email',
                        value: 'invalid-email'
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should return 400 when password is too weak', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'Juan',
                    lastName: 'Pérez',
                    userEmail: 'juan@example.com',
                    userPassword: 'weak',
                    roll: 'musico'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'userPassword',
                        message: 'La contraseña debe tener al menos 8 caracteres',
                        type: 'string.min',
                        value: 'weak'
                    }),
                    expect.objectContaining({
                        field: 'userPassword',
                        message: 'La contraseña debe contener al menos una minúscula, una mayúscula, un número y un carácter especial',
                        type: 'string.pattern.base',
                        value: 'weak'
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should return 400 when roll is invalid', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'Juan',
                    lastName: 'Pérez',
                    userEmail: 'juan@example.com',
                    userPassword: 'Password123!',
                    roll: 'invalid-role'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'roll',
                        message: 'El rol debe ser uno de los valores permitidos',
                        type: 'any.only',
                        value: 'invalid-role'
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should return 400 when name is too short', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'J',
                    lastName: 'Pérez',
                    userEmail: 'juan@example.com',
                    userPassword: 'Password123!',
                    roll: 'musico'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'name',
                        message: 'El nombre debe tener al menos 2 caracteres',
                        type: 'string.min',
                        value: 'J'
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should return 400 when lastName is too short', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'Juan',
                    lastName: 'P',
                    userEmail: 'juan@example.com',
                    userPassword: 'Password123!',
                    roll: 'musico'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'lastName',
                        message: 'El apellido debe tener al menos 2 caracteres',
                        type: 'string.min',
                        value: 'P'
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should handle multiple validation errors', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'J',
                    lastName: 'P',
                    userEmail: 'invalid-email',
                    userPassword: 'weak',
                    roll: 'invalid-role'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'name',
                        message: 'El nombre debe tener al menos 2 caracteres',
                        type: 'string.min',
                        value: 'J'
                    }),
                    expect.objectContaining({
                        field: 'lastName',
                        message: 'El apellido debe tener al menos 2 caracteres',
                        type: 'string.min',
                        value: 'P'
                    }),
                    expect.objectContaining({
                        field: 'userEmail',
                        message: 'El email debe tener un formato válido',
                        type: 'string.email',
                        value: 'invalid-email'
                    }),
                    expect.objectContaining({
                        field: 'userPassword',
                        message: 'La contraseña debe tener al menos 8 caracteres',
                        type: 'string.min',
                        value: 'weak'
                    }),
                    expect.objectContaining({
                        field: 'userPassword',
                        message: 'La contraseña debe contener al menos una minúscula, una mayúscula, un número y un carácter especial',
                        type: 'string.pattern.base',
                        value: 'weak'
                    }),
                    expect.objectContaining({
                        field: 'roll',
                        message: 'El rol debe ser uno de los valores permitidos',
                        type: 'any.only',
                        value: 'invalid-role'
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should handle empty body', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {}
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: 'name',
                        message: 'El nombre es requerido',
                        type: 'any.required',
                        value: undefined
                    }),
                    expect.objectContaining({
                        field: 'lastName',
                        message: 'El apellido es requerido',
                        type: 'any.required',
                        value: undefined
                    }),
                    expect.objectContaining({
                        field: 'userEmail',
                        message: 'El email es requerido',
                        type: 'any.required',
                        value: undefined
                    }),
                    expect.objectContaining({
                        field: 'userPassword',
                        message: 'La contraseña es requerida',
                        type: 'any.required',
                        value: undefined
                    }),
                    expect.objectContaining({
                        field: 'roll',
                        message: '"roll" is required',
                        type: 'any.required',
                        value: undefined
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should handle null body', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: null
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                message: 'Datos de entrada inválidos',
                errors: expect.arrayContaining([
                    expect.objectContaining({
                        field: '',
                        message: '"value" must be of type object',
                        type: 'object.base',
                        value: null
                    })
                ]),
                path: undefined,
                timestamp: expect.any(String)
            });
        });
        it('should call next() when validation passes', () => {
            mockRequest = (0, setup_1.createMockRequest)({
                body: {
                    name: 'Juan',
                    lastName: 'Pérez',
                    userEmail: 'juan@example.com',
                    userPassword: 'Password123!',
                    roll: 'musico'
                }
            });
            const middleware = (0, validationMiddleware_1.validate)(validationSchemas_1.registerSchema);
            middleware(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalled();
            expect(mockResponse.status).not.toHaveBeenCalled();
            expect(mockResponse.json).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHZhbGlkYXRpb25NaWRkbGV3YXJlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFDQSw2RUFBOEQ7QUFDOUQsa0VBQTREO0FBQzVELG1DQUFnRTtBQUVoRSxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBQ3BDLElBQUksV0FBNkIsQ0FBQztJQUNsQyxJQUFJLFlBQStCLENBQUM7SUFDcEMsSUFBSSxRQUFzQixDQUFDO0lBQzNCLElBQUksUUFBbUIsQ0FBQztJQUN4QixJQUFJLFVBQXFCLENBQUM7SUFFMUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDckIsVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUUzRCxZQUFZLEdBQUc7WUFDYixNQUFNLEVBQUUsVUFBVTtZQUNsQixJQUFJLEVBQUUsUUFBUTtTQUNmLENBQUM7UUFFRixRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBRXJCLDJCQUEyQjtRQUMzQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUN4QixFQUFFLENBQUMsc0VBQXNFLEVBQUUsR0FBRyxFQUFFO1lBQzlFLFdBQVcsR0FBRyxJQUFBLHlCQUFpQixFQUFDO2dCQUM5QixJQUFJLEVBQUU7b0JBQ0osSUFBSSxFQUFFLE1BQU07b0JBQ1osUUFBUSxFQUFFLE9BQU87b0JBQ2pCLDBDQUEwQztpQkFDM0M7YUFDRixDQUFDLENBQUM7WUFFSCxNQUFNLFVBQVUsR0FBRyxJQUFBLCtCQUFRLEVBQUMsa0NBQWMsQ0FBQyxDQUFDO1lBQzVDLFVBQVUsQ0FBQyxXQUFzQixFQUFFLFlBQXdCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM3QyxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsNEJBQTRCO2dCQUNyQyxNQUFNLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQztvQkFDN0IsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsV0FBVzt3QkFDbEIsT0FBTyxFQUFFLHVCQUF1Qjt3QkFDaEMsSUFBSSxFQUFFLGNBQWM7d0JBQ3BCLEtBQUssRUFBRSxTQUFTO3FCQUNqQixDQUFDO29CQUNGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDdEIsS0FBSyxFQUFFLGNBQWM7d0JBQ3JCLE9BQU8sRUFBRSw0QkFBNEI7d0JBQ3JDLElBQUksRUFBRSxjQUFjO3dCQUNwQixLQUFLLEVBQUUsU0FBUztxQkFDakIsQ0FBQztvQkFDRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxNQUFNO3dCQUNiLE9BQU8sRUFBRSxvQkFBb0I7d0JBQzdCLElBQUksRUFBRSxjQUFjO3dCQUNwQixLQUFLLEVBQUUsU0FBUztxQkFDakIsQ0FBQztpQkFDSCxDQUFDO2dCQUNGLElBQUksRUFBRSxTQUFTO2dCQUNmLFNBQVMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQzthQUM5QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7WUFDeEQsV0FBVyxHQUFHLElBQUEseUJBQWlCLEVBQUM7Z0JBQzlCLElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsT0FBTztvQkFDakIsU0FBUyxFQUFFLGVBQWU7b0JBQzFCLFlBQVksRUFBRSxjQUFjO29CQUM1QixJQUFJLEVBQUUsUUFBUTtpQkFDZjthQUNGLENBQUMsQ0FBQztZQUVILE1BQU0sVUFBVSxHQUFHLElBQUEsK0JBQVEsRUFBQyxrQ0FBYyxDQUFDLENBQUM7WUFDNUMsVUFBVSxDQUFDLFdBQXNCLEVBQUUsWUFBd0IsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUV2RSxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQzdDLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSw0QkFBNEI7Z0JBQ3JDLE1BQU0sRUFBRSxNQUFNLENBQUMsZUFBZSxDQUFDO29CQUM3QixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxXQUFXO3dCQUNsQixPQUFPLEVBQUUsdUNBQXVDO3dCQUNoRCxJQUFJLEVBQUUsY0FBYzt3QkFDcEIsS0FBSyxFQUFFLGVBQWU7cUJBQ3ZCLENBQUM7aUJBQ0gsQ0FBQztnQkFDRixJQUFJLEVBQUUsU0FBUztnQkFDZixTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7YUFDOUIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1lBQ3JELFdBQVcsR0FBRyxJQUFBLHlCQUFpQixFQUFDO2dCQUM5QixJQUFJLEVBQUU7b0JBQ0osSUFBSSxFQUFFLE1BQU07b0JBQ1osUUFBUSxFQUFFLE9BQU87b0JBQ2pCLFNBQVMsRUFBRSxrQkFBa0I7b0JBQzdCLFlBQVksRUFBRSxNQUFNO29CQUNwQixJQUFJLEVBQUUsUUFBUTtpQkFDZjthQUNGLENBQUMsQ0FBQztZQUVILE1BQU0sVUFBVSxHQUFHLElBQUEsK0JBQVEsRUFBQyxrQ0FBYyxDQUFDLENBQUM7WUFDNUMsVUFBVSxDQUFDLFdBQXNCLEVBQUUsWUFBd0IsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUV2RSxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQzdDLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSw0QkFBNEI7Z0JBQ3JDLE1BQU0sRUFBRSxNQUFNLENBQUMsZUFBZSxDQUFDO29CQUM3QixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxjQUFjO3dCQUNyQixPQUFPLEVBQUUsZ0RBQWdEO3dCQUN6RCxJQUFJLEVBQUUsWUFBWTt3QkFDbEIsS0FBSyxFQUFFLE1BQU07cUJBQ2QsQ0FBQztvQkFDRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxjQUFjO3dCQUNyQixPQUFPLEVBQUUscUdBQXFHO3dCQUM5RyxJQUFJLEVBQUUscUJBQXFCO3dCQUMzQixLQUFLLEVBQUUsTUFBTTtxQkFDZCxDQUFDO2lCQUNILENBQUM7Z0JBQ0YsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsU0FBUyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2FBQzlCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxXQUFXLEdBQUcsSUFBQSx5QkFBaUIsRUFBQztnQkFDOUIsSUFBSSxFQUFFO29CQUNKLElBQUksRUFBRSxNQUFNO29CQUNaLFFBQVEsRUFBRSxPQUFPO29CQUNqQixTQUFTLEVBQUUsa0JBQWtCO29CQUM3QixZQUFZLEVBQUUsY0FBYztvQkFDNUIsSUFBSSxFQUFFLGNBQWM7aUJBQ3JCO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxVQUFVLEdBQUcsSUFBQSwrQkFBUSxFQUFDLGtDQUFjLENBQUMsQ0FBQztZQUM1QyxVQUFVLENBQUMsV0FBc0IsRUFBRSxZQUF3QixFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRXZFLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDN0MsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsT0FBTyxFQUFFLDRCQUE0QjtnQkFDckMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxlQUFlLENBQUM7b0JBQzdCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDdEIsS0FBSyxFQUFFLE1BQU07d0JBQ2IsT0FBTyxFQUFFLCtDQUErQzt3QkFDeEQsSUFBSSxFQUFFLFVBQVU7d0JBQ2hCLEtBQUssRUFBRSxjQUFjO3FCQUN0QixDQUFDO2lCQUNILENBQUM7Z0JBQ0YsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsU0FBUyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2FBQzlCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNsRCxXQUFXLEdBQUcsSUFBQSx5QkFBaUIsRUFBQztnQkFDOUIsSUFBSSxFQUFFO29CQUNKLElBQUksRUFBRSxHQUFHO29CQUNULFFBQVEsRUFBRSxPQUFPO29CQUNqQixTQUFTLEVBQUUsa0JBQWtCO29CQUM3QixZQUFZLEVBQUUsY0FBYztvQkFDNUIsSUFBSSxFQUFFLFFBQVE7aUJBQ2Y7YUFDRixDQUFDLENBQUM7WUFFSCxNQUFNLFVBQVUsR0FBRyxJQUFBLCtCQUFRLEVBQUMsa0NBQWMsQ0FBQyxDQUFDO1lBQzVDLFVBQVUsQ0FBQyxXQUFzQixFQUFFLFlBQXdCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM3QyxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsNEJBQTRCO2dCQUNyQyxNQUFNLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQztvQkFDN0IsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsTUFBTTt3QkFDYixPQUFPLEVBQUUsNENBQTRDO3dCQUNyRCxJQUFJLEVBQUUsWUFBWTt3QkFDbEIsS0FBSyxFQUFFLEdBQUc7cUJBQ1gsQ0FBQztpQkFDSCxDQUFDO2dCQUNGLElBQUksRUFBRSxTQUFTO2dCQUNmLFNBQVMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQzthQUM5QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7WUFDdEQsV0FBVyxHQUFHLElBQUEseUJBQWlCLEVBQUM7Z0JBQzlCLElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsR0FBRztvQkFDYixTQUFTLEVBQUUsa0JBQWtCO29CQUM3QixZQUFZLEVBQUUsY0FBYztvQkFDNUIsSUFBSSxFQUFFLFFBQVE7aUJBQ2Y7YUFDRixDQUFDLENBQUM7WUFFSCxNQUFNLFVBQVUsR0FBRyxJQUFBLCtCQUFRLEVBQUMsa0NBQWMsQ0FBQyxDQUFDO1lBQzVDLFVBQVUsQ0FBQyxXQUFzQixFQUFFLFlBQXdCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM3QyxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsNEJBQTRCO2dCQUNyQyxNQUFNLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQztvQkFDN0IsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsVUFBVTt3QkFDakIsT0FBTyxFQUFFLDhDQUE4Qzt3QkFDdkQsSUFBSSxFQUFFLFlBQVk7d0JBQ2xCLEtBQUssRUFBRSxHQUFHO3FCQUNYLENBQUM7aUJBQ0gsQ0FBQztnQkFDRixJQUFJLEVBQUUsU0FBUztnQkFDZixTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7YUFDOUIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1lBQ2xELFdBQVcsR0FBRyxJQUFBLHlCQUFpQixFQUFDO2dCQUM5QixJQUFJLEVBQUU7b0JBQ0osSUFBSSxFQUFFLEdBQUc7b0JBQ1QsUUFBUSxFQUFFLEdBQUc7b0JBQ2IsU0FBUyxFQUFFLGVBQWU7b0JBQzFCLFlBQVksRUFBRSxNQUFNO29CQUNwQixJQUFJLEVBQUUsY0FBYztpQkFDckI7YUFDRixDQUFDLENBQUM7WUFFSCxNQUFNLFVBQVUsR0FBRyxJQUFBLCtCQUFRLEVBQUMsa0NBQWMsQ0FBQyxDQUFDO1lBQzVDLFVBQVUsQ0FBQyxXQUFzQixFQUFFLFlBQXdCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM3QyxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsNEJBQTRCO2dCQUNyQyxNQUFNLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQztvQkFDN0IsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsTUFBTTt3QkFDYixPQUFPLEVBQUUsNENBQTRDO3dCQUNyRCxJQUFJLEVBQUUsWUFBWTt3QkFDbEIsS0FBSyxFQUFFLEdBQUc7cUJBQ1gsQ0FBQztvQkFDRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxVQUFVO3dCQUNqQixPQUFPLEVBQUUsOENBQThDO3dCQUN2RCxJQUFJLEVBQUUsWUFBWTt3QkFDbEIsS0FBSyxFQUFFLEdBQUc7cUJBQ1gsQ0FBQztvQkFDRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxXQUFXO3dCQUNsQixPQUFPLEVBQUUsdUNBQXVDO3dCQUNoRCxJQUFJLEVBQUUsY0FBYzt3QkFDcEIsS0FBSyxFQUFFLGVBQWU7cUJBQ3ZCLENBQUM7b0JBQ0YsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsY0FBYzt3QkFDckIsT0FBTyxFQUFFLGdEQUFnRDt3QkFDekQsSUFBSSxFQUFFLFlBQVk7d0JBQ2xCLEtBQUssRUFBRSxNQUFNO3FCQUNkLENBQUM7b0JBQ0YsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsY0FBYzt3QkFDckIsT0FBTyxFQUFFLHFHQUFxRzt3QkFDOUcsSUFBSSxFQUFFLHFCQUFxQjt3QkFDM0IsS0FBSyxFQUFFLE1BQU07cUJBQ2QsQ0FBQztvQkFDRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxNQUFNO3dCQUNiLE9BQU8sRUFBRSwrQ0FBK0M7d0JBQ3hELElBQUksRUFBRSxVQUFVO3dCQUNoQixLQUFLLEVBQUUsY0FBYztxQkFDdEIsQ0FBQztpQkFDSCxDQUFDO2dCQUNGLElBQUksRUFBRSxTQUFTO2dCQUNmLFNBQVMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQzthQUM5QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7WUFDbEMsV0FBVyxHQUFHLElBQUEseUJBQWlCLEVBQUM7Z0JBQzlCLElBQUksRUFBRSxFQUFFO2FBQ1QsQ0FBQyxDQUFDO1lBRUgsTUFBTSxVQUFVLEdBQUcsSUFBQSwrQkFBUSxFQUFDLGtDQUFjLENBQUMsQ0FBQztZQUM1QyxVQUFVLENBQUMsV0FBc0IsRUFBRSxZQUF3QixFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRXZFLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDN0MsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsT0FBTyxFQUFFLDRCQUE0QjtnQkFDckMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxlQUFlLENBQUM7b0JBQzdCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDdEIsS0FBSyxFQUFFLE1BQU07d0JBQ2IsT0FBTyxFQUFFLHdCQUF3Qjt3QkFDakMsSUFBSSxFQUFFLGNBQWM7d0JBQ3BCLEtBQUssRUFBRSxTQUFTO3FCQUNqQixDQUFDO29CQUNGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDdEIsS0FBSyxFQUFFLFVBQVU7d0JBQ2pCLE9BQU8sRUFBRSwwQkFBMEI7d0JBQ25DLElBQUksRUFBRSxjQUFjO3dCQUNwQixLQUFLLEVBQUUsU0FBUztxQkFDakIsQ0FBQztvQkFDRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLEtBQUssRUFBRSxXQUFXO3dCQUNsQixPQUFPLEVBQUUsdUJBQXVCO3dCQUNoQyxJQUFJLEVBQUUsY0FBYzt3QkFDcEIsS0FBSyxFQUFFLFNBQVM7cUJBQ2pCLENBQUM7b0JBQ0YsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsY0FBYzt3QkFDckIsT0FBTyxFQUFFLDRCQUE0Qjt3QkFDckMsSUFBSSxFQUFFLGNBQWM7d0JBQ3BCLEtBQUssRUFBRSxTQUFTO3FCQUNqQixDQUFDO29CQUNGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDdEIsS0FBSyxFQUFFLE1BQU07d0JBQ2IsT0FBTyxFQUFFLG9CQUFvQjt3QkFDN0IsSUFBSSxFQUFFLGNBQWM7d0JBQ3BCLEtBQUssRUFBRSxTQUFTO3FCQUNqQixDQUFDO2lCQUNILENBQUM7Z0JBQ0YsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsU0FBUyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2FBQzlCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtZQUNqQyxXQUFXLEdBQUcsSUFBQSx5QkFBaUIsRUFBQztnQkFDOUIsSUFBSSxFQUFFLElBQUk7YUFDWCxDQUFDLENBQUM7WUFFSCxNQUFNLFVBQVUsR0FBRyxJQUFBLCtCQUFRLEVBQUMsa0NBQWMsQ0FBQyxDQUFDO1lBQzVDLFVBQVUsQ0FBQyxXQUFzQixFQUFFLFlBQXdCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM3QyxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsNEJBQTRCO2dCQUNyQyxNQUFNLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQztvQkFDN0IsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUN0QixLQUFLLEVBQUUsRUFBRTt3QkFDVCxPQUFPLEVBQUUsZ0NBQWdDO3dCQUN6QyxJQUFJLEVBQUUsYUFBYTt3QkFDbkIsS0FBSyxFQUFFLElBQUk7cUJBQ1osQ0FBQztpQkFDSCxDQUFDO2dCQUNGLElBQUksRUFBRSxTQUFTO2dCQUNmLFNBQVMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQzthQUM5QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxHQUFHLEVBQUU7WUFDbkQsV0FBVyxHQUFHLElBQUEseUJBQWlCLEVBQUM7Z0JBQzlCLElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsT0FBTztvQkFDakIsU0FBUyxFQUFFLGtCQUFrQjtvQkFDN0IsWUFBWSxFQUFFLGNBQWM7b0JBQzVCLElBQUksRUFBRSxRQUFRO2lCQUNmO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxVQUFVLEdBQUcsSUFBQSwrQkFBUSxFQUFDLGtDQUFjLENBQUMsQ0FBQztZQUM1QyxVQUFVLENBQUMsV0FBc0IsRUFBRSxZQUF3QixFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRXZFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDbkQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHZhbGlkYXRpb25NaWRkbGV3YXJlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgeyB2YWxpZGF0ZSB9IGZyb20gJy4uL21pZGRsZXdhcmUvdmFsaWRhdGlvbk1pZGRsZXdhcmUnO1xyXG5pbXBvcnQgeyByZWdpc3RlclNjaGVtYSB9IGZyb20gJy4uL3V0aWxzL3ZhbGlkYXRpb25TY2hlbWFzJztcclxuaW1wb3J0IHsgY3JlYXRlTW9ja1JlcXVlc3QsIGNyZWF0ZU1vY2tSZXNwb25zZSB9IGZyb20gJy4vc2V0dXAnO1xyXG5cclxuZGVzY3JpYmUoJ1ZhbGlkYXRpb25NaWRkbGV3YXJlJywgKCkgPT4ge1xyXG4gIGxldCBtb2NrUmVxdWVzdDogUGFydGlhbDxSZXF1ZXN0PjtcclxuICBsZXQgbW9ja1Jlc3BvbnNlOiBQYXJ0aWFsPFJlc3BvbnNlPjtcclxuICBsZXQgbW9ja05leHQ6IE5leHRGdW5jdGlvbjtcclxuICBsZXQgbW9ja0pzb246IGplc3QuTW9jaztcclxuICBsZXQgbW9ja1N0YXR1czogamVzdC5Nb2NrO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIG1vY2tKc29uID0gamVzdC5mbigpO1xyXG4gICAgbW9ja1N0YXR1cyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBqc29uOiBtb2NrSnNvbiB9KTtcclxuICAgIFxyXG4gICAgbW9ja1Jlc3BvbnNlID0ge1xyXG4gICAgICBzdGF0dXM6IG1vY2tTdGF0dXMsXHJcbiAgICAgIGpzb246IG1vY2tKc29uXHJcbiAgICB9O1xyXG5cclxuICAgIG1vY2tOZXh0ID0gamVzdC5mbigpO1xyXG5cclxuICAgIC8vIFJlc2V0IGRlIHRvZG9zIGxvcyBtb2Nrc1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMCB3aGVuIHZhbGlkYXRpb24gZmFpbHMgd2l0aCBtaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgbmFtZTogJ0p1YW4nLFxyXG4gICAgICAgICAgbGFzdE5hbWU6ICdQw6lyZXonXHJcbiAgICAgICAgICAvLyB1c2VyRW1haWwsIHVzZXJQYXNzd29yZCwgcm9sbCBmYWx0YW50ZXNcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHJlZ2lzdGVyU2NoZW1hKTtcclxuICAgICAgbWlkZGxld2FyZShtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsIG1vY2tOZXh0KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnRGF0b3MgZGUgZW50cmFkYSBpbnbDoWxpZG9zJyxcclxuICAgICAgICBlcnJvcnM6IGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW1xyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ3VzZXJFbWFpbCcsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbCBlbWFpbCBlcyByZXF1ZXJpZG8nLFxyXG4gICAgICAgICAgICB0eXBlOiAnYW55LnJlcXVpcmVkJyxcclxuICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIGZpZWxkOiAndXNlclBhc3N3b3JkJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0xhIGNvbnRyYXNlw7FhIGVzIHJlcXVlcmlkYScsXHJcbiAgICAgICAgICAgIHR5cGU6ICdhbnkucmVxdWlyZWQnLFxyXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICdyb2xsJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1wicm9sbFwiIGlzIHJlcXVpcmVkJyxcclxuICAgICAgICAgICAgdHlwZTogJ2FueS5yZXF1aXJlZCcsXHJcbiAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgXSksXHJcbiAgICAgICAgcGF0aDogdW5kZWZpbmVkLFxyXG4gICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShTdHJpbmcpXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIHdoZW4gZW1haWwgZm9ybWF0IGlzIGludmFsaWQnLCAoKSA9PiB7XHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0gY3JlYXRlTW9ja1JlcXVlc3Qoe1xyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICAgIGxhc3ROYW1lOiAnUMOpcmV6JyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ2ludmFsaWQtZW1haWwnLFxyXG4gICAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICAgIHJvbGw6ICdtdXNpY28nXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShyZWdpc3RlclNjaGVtYSk7XHJcbiAgICAgIG1pZGRsZXdhcmUobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ0RhdG9zIGRlIGVudHJhZGEgaW52w6FsaWRvcycsXHJcbiAgICAgICAgZXJyb3JzOiBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICd1c2VyRW1haWwnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRWwgZW1haWwgZGViZSB0ZW5lciB1biBmb3JtYXRvIHbDoWxpZG8nLFxyXG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nLmVtYWlsJyxcclxuICAgICAgICAgICAgdmFsdWU6ICdpbnZhbGlkLWVtYWlsJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKSxcclxuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZylcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgd2hlbiBwYXNzd29yZCBpcyB0b28gd2VhaycsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgbmFtZTogJ0p1YW4nLFxyXG4gICAgICAgICAgbGFzdE5hbWU6ICdQw6lyZXonLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiAnanVhbkBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICB1c2VyUGFzc3dvcmQ6ICd3ZWFrJyxcclxuICAgICAgICAgIHJvbGw6ICdtdXNpY28nXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShyZWdpc3RlclNjaGVtYSk7XHJcbiAgICAgIG1pZGRsZXdhcmUobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ0RhdG9zIGRlIGVudHJhZGEgaW52w6FsaWRvcycsXHJcbiAgICAgICAgZXJyb3JzOiBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICd1c2VyUGFzc3dvcmQnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnTGEgY29udHJhc2XDsWEgZGViZSB0ZW5lciBhbCBtZW5vcyA4IGNhcmFjdGVyZXMnLFxyXG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nLm1pbicsXHJcbiAgICAgICAgICAgIHZhbHVlOiAnd2VhaydcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ3VzZXJQYXNzd29yZCcsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdMYSBjb250cmFzZcOxYSBkZWJlIGNvbnRlbmVyIGFsIG1lbm9zIHVuYSBtaW7DunNjdWxhLCB1bmEgbWF5w7pzY3VsYSwgdW4gbsO6bWVybyB5IHVuIGNhcsOhY3RlciBlc3BlY2lhbCcsXHJcbiAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcucGF0dGVybi5iYXNlJyxcclxuICAgICAgICAgICAgdmFsdWU6ICd3ZWFrJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKSxcclxuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZylcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgd2hlbiByb2xsIGlzIGludmFsaWQnLCAoKSA9PiB7XHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0gY3JlYXRlTW9ja1JlcXVlc3Qoe1xyXG4gICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgIG5hbWU6ICdKdWFuJyxcclxuICAgICAgICAgIGxhc3ROYW1lOiAnUMOpcmV6JyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ2p1YW5AZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICAgIHJvbGw6ICdpbnZhbGlkLXJvbGUnXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShyZWdpc3RlclNjaGVtYSk7XHJcbiAgICAgIG1pZGRsZXdhcmUobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ0RhdG9zIGRlIGVudHJhZGEgaW52w6FsaWRvcycsXHJcbiAgICAgICAgZXJyb3JzOiBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICdyb2xsJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0VsIHJvbCBkZWJlIHNlciB1bm8gZGUgbG9zIHZhbG9yZXMgcGVybWl0aWRvcycsXHJcbiAgICAgICAgICAgIHR5cGU6ICdhbnkub25seScsXHJcbiAgICAgICAgICAgIHZhbHVlOiAnaW52YWxpZC1yb2xlJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKSxcclxuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZylcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgd2hlbiBuYW1lIGlzIHRvbyBzaG9ydCcsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgbmFtZTogJ0onLFxyXG4gICAgICAgICAgbGFzdE5hbWU6ICdQw6lyZXonLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiAnanVhbkBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICB1c2VyUGFzc3dvcmQ6ICdQYXNzd29yZDEyMyEnLFxyXG4gICAgICAgICAgcm9sbDogJ211c2ljbydcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHJlZ2lzdGVyU2NoZW1hKTtcclxuICAgICAgbWlkZGxld2FyZShtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsIG1vY2tOZXh0KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnRGF0b3MgZGUgZW50cmFkYSBpbnbDoWxpZG9zJyxcclxuICAgICAgICBlcnJvcnM6IGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW1xyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ25hbWUnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRWwgbm9tYnJlIGRlYmUgdGVuZXIgYWwgbWVub3MgMiBjYXJhY3RlcmVzJyxcclxuICAgICAgICAgICAgdHlwZTogJ3N0cmluZy5taW4nLFxyXG4gICAgICAgICAgICB2YWx1ZTogJ0onXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIF0pLFxyXG4gICAgICAgIHBhdGg6IHVuZGVmaW5lZCxcclxuICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMCB3aGVuIGxhc3ROYW1lIGlzIHRvbyBzaG9ydCcsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgbmFtZTogJ0p1YW4nLFxyXG4gICAgICAgICAgbGFzdE5hbWU6ICdQJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ2p1YW5AZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgdXNlclBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJyxcclxuICAgICAgICAgIHJvbGw6ICdtdXNpY28nXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShyZWdpc3RlclNjaGVtYSk7XHJcbiAgICAgIG1pZGRsZXdhcmUobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ0RhdG9zIGRlIGVudHJhZGEgaW52w6FsaWRvcycsXHJcbiAgICAgICAgZXJyb3JzOiBleHBlY3QuYXJyYXlDb250YWluaW5nKFtcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICdsYXN0TmFtZScsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbCBhcGVsbGlkbyBkZWJlIHRlbmVyIGFsIG1lbm9zIDIgY2FyYWN0ZXJlcycsXHJcbiAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcubWluJyxcclxuICAgICAgICAgICAgdmFsdWU6ICdQJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKSxcclxuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZylcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtdWx0aXBsZSB2YWxpZGF0aW9uIGVycm9ycycsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgbmFtZTogJ0onLFxyXG4gICAgICAgICAgbGFzdE5hbWU6ICdQJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogJ2ludmFsaWQtZW1haWwnLFxyXG4gICAgICAgICAgdXNlclBhc3N3b3JkOiAnd2VhaycsXHJcbiAgICAgICAgICByb2xsOiAnaW52YWxpZC1yb2xlJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUocmVnaXN0ZXJTY2hlbWEpO1xyXG4gICAgICBtaWRkbGV3YXJlKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSwgbW9ja05leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRvcyBkZSBlbnRyYWRhIGludsOhbGlkb3MnLFxyXG4gICAgICAgIGVycm9yczogZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXHJcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIGZpZWxkOiAnbmFtZScsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbCBub21icmUgZGViZSB0ZW5lciBhbCBtZW5vcyAyIGNhcmFjdGVyZXMnLFxyXG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nLm1pbicsXHJcbiAgICAgICAgICAgIHZhbHVlOiAnSidcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ2xhc3ROYW1lJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0VsIGFwZWxsaWRvIGRlYmUgdGVuZXIgYWwgbWVub3MgMiBjYXJhY3RlcmVzJyxcclxuICAgICAgICAgICAgdHlwZTogJ3N0cmluZy5taW4nLFxyXG4gICAgICAgICAgICB2YWx1ZTogJ1AnXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICd1c2VyRW1haWwnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRWwgZW1haWwgZGViZSB0ZW5lciB1biBmb3JtYXRvIHbDoWxpZG8nLFxyXG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nLmVtYWlsJyxcclxuICAgICAgICAgICAgdmFsdWU6ICdpbnZhbGlkLWVtYWlsJ1xyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIGZpZWxkOiAndXNlclBhc3N3b3JkJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0xhIGNvbnRyYXNlw7FhIGRlYmUgdGVuZXIgYWwgbWVub3MgOCBjYXJhY3RlcmVzJyxcclxuICAgICAgICAgICAgdHlwZTogJ3N0cmluZy5taW4nLFxyXG4gICAgICAgICAgICB2YWx1ZTogJ3dlYWsnXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICd1c2VyUGFzc3dvcmQnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnTGEgY29udHJhc2XDsWEgZGViZSBjb250ZW5lciBhbCBtZW5vcyB1bmEgbWluw7pzY3VsYSwgdW5hIG1hecO6c2N1bGEsIHVuIG7Dum1lcm8geSB1biBjYXLDoWN0ZXIgZXNwZWNpYWwnLFxyXG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nLnBhdHRlcm4uYmFzZScsXHJcbiAgICAgICAgICAgIHZhbHVlOiAnd2VhaydcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ3JvbGwnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRWwgcm9sIGRlYmUgc2VyIHVubyBkZSBsb3MgdmFsb3JlcyBwZXJtaXRpZG9zJyxcclxuICAgICAgICAgICAgdHlwZTogJ2FueS5vbmx5JyxcclxuICAgICAgICAgICAgdmFsdWU6ICdpbnZhbGlkLXJvbGUnXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIF0pLFxyXG4gICAgICAgIHBhdGg6IHVuZGVmaW5lZCxcclxuICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGJvZHknLCAoKSA9PiB7XHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0gY3JlYXRlTW9ja1JlcXVlc3Qoe1xyXG4gICAgICAgIGJvZHk6IHt9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHJlZ2lzdGVyU2NoZW1hKTtcclxuICAgICAgbWlkZGxld2FyZShtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsIG1vY2tOZXh0KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnRGF0b3MgZGUgZW50cmFkYSBpbnbDoWxpZG9zJyxcclxuICAgICAgICBlcnJvcnM6IGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW1xyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ25hbWUnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRWwgbm9tYnJlIGVzIHJlcXVlcmlkbycsXHJcbiAgICAgICAgICAgIHR5cGU6ICdhbnkucmVxdWlyZWQnLFxyXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICdsYXN0TmFtZScsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbCBhcGVsbGlkbyBlcyByZXF1ZXJpZG8nLFxyXG4gICAgICAgICAgICB0eXBlOiAnYW55LnJlcXVpcmVkJyxcclxuICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIGZpZWxkOiAndXNlckVtYWlsJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0VsIGVtYWlsIGVzIHJlcXVlcmlkbycsXHJcbiAgICAgICAgICAgIHR5cGU6ICdhbnkucmVxdWlyZWQnLFxyXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgZmllbGQ6ICd1c2VyUGFzc3dvcmQnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnTGEgY29udHJhc2XDsWEgZXMgcmVxdWVyaWRhJyxcclxuICAgICAgICAgICAgdHlwZTogJ2FueS5yZXF1aXJlZCcsXHJcbiAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICBmaWVsZDogJ3JvbGwnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnXCJyb2xsXCIgaXMgcmVxdWlyZWQnLFxyXG4gICAgICAgICAgICB0eXBlOiAnYW55LnJlcXVpcmVkJyxcclxuICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKSxcclxuICAgICAgICBwYXRoOiB1bmRlZmluZWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZylcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBudWxsIGJvZHknLCAoKSA9PiB7XHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0gY3JlYXRlTW9ja1JlcXVlc3Qoe1xyXG4gICAgICAgIGJvZHk6IG51bGxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUocmVnaXN0ZXJTY2hlbWEpO1xyXG4gICAgICBtaWRkbGV3YXJlKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSwgbW9ja05leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRvcyBkZSBlbnRyYWRhIGludsOhbGlkb3MnLFxyXG4gICAgICAgIGVycm9yczogZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXHJcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIGZpZWxkOiAnJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1widmFsdWVcIiBtdXN0IGJlIG9mIHR5cGUgb2JqZWN0JyxcclxuICAgICAgICAgICAgdHlwZTogJ29iamVjdC5iYXNlJyxcclxuICAgICAgICAgICAgdmFsdWU6IG51bGxcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgXSksXHJcbiAgICAgICAgcGF0aDogdW5kZWZpbmVkLFxyXG4gICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShTdHJpbmcpXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjYWxsIG5leHQoKSB3aGVuIHZhbGlkYXRpb24gcGFzc2VzJywgKCkgPT4ge1xyXG4gICAgICBtb2NrUmVxdWVzdCA9IGNyZWF0ZU1vY2tSZXF1ZXN0KHtcclxuICAgICAgICBib2R5OiB7XHJcbiAgICAgICAgICBuYW1lOiAnSnVhbicsXHJcbiAgICAgICAgICBsYXN0TmFtZTogJ1DDqXJleicsXHJcbiAgICAgICAgICB1c2VyRW1haWw6ICdqdWFuQGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHVzZXJQYXNzd29yZDogJ1Bhc3N3b3JkMTIzIScsXHJcbiAgICAgICAgICByb2xsOiAnbXVzaWNvJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUocmVnaXN0ZXJTY2hlbWEpO1xyXG4gICAgICBtaWRkbGV3YXJlKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSwgbW9ja05leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7ICJdLCJ2ZXJzaW9uIjozfQ==