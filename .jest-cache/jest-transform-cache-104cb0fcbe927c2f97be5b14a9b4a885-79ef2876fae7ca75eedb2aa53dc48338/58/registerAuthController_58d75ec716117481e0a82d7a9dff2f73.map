{"version":3,"names":["cov_1lcsbep3ac","actualCoverage","firebase_1","s","require","loggerService_1","sendEmailVerificationLink","req","res","f","__awaiter","uid","body","user","dmAdmin","auth","getUser","emailVerified","b","status","json","message","link","generateEmailVerificationLink","email","logger","info","metadata","id","error","exports"],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\controllers\\registerAuthController.ts"],"sourcesContent":["// src/controllers/authController.ts\r\nimport { db, dmAdmin } from '../utils/firebase';\r\nimport nodemailer from 'nodemailer';\r\nimport { Request, Response } from 'express';\r\nimport { logger } from '../services/loggerService';\r\n\r\n/**\r\n * @swagger\r\n * /auth/sendEmailVerificationLink:\r\n *   post:\r\n *     summary: Envía un link de verificación de email a un usuario\r\n *     requestBody:\r\n *       required: true\r\n *       content:\r\n *         application/json:\r\n *           schema:\r\n *             type: object\r\n *             properties:\r\n *               uid:\r\n *                 type: string\r\n *     responses:\r\n *       200:\r\n *         description: Link generado exitosamente\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 message:\r\n *                   type: string\r\n *                 link:\r\n *                   type: string\r\n */\r\nexport const sendEmailVerificationLink = async (\r\n  req: Request,\r\n  res: Response\r\n) => {\r\n  const { uid } = req.body;\r\n\r\n  try {\r\n    const user = await dmAdmin.auth().getUser(uid);\r\n\r\n    if (user.emailVerified) {\r\n      res.status(400).json({ message: 'El correo ya está verificado.' });\r\n      return;\r\n    }\r\n\r\n    const link = await dmAdmin\r\n      .auth()\r\n      .generateEmailVerificationLink(user.email!);\r\n\r\n    // Aquí puedes enviar ese link por correo usando nodemailer o Mailgun, etc.\r\n    logger.info('Verification link:', { metadata: { id: link  } });\r\n\r\n    // Devolver el enlace directamente o enviar vía email\r\n    res.status(200).json({ message: 'Link generado', link });\r\n  } catch (error) {\r\n    res.status(500).json({ message: 'Error al generar el link', error });\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]}