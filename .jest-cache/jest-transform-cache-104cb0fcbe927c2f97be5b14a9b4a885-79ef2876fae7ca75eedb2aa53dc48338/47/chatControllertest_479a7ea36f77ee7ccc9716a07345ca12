fbca484ffa02ea92f0349b818d9722a3
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the chat models
jest.mock('../models/chatModel');
jest.mock('../services/loggerService', () => ({
    logger: {
        info: jest.fn(),
        error: jest.fn(),
        warn: jest.fn()
    }
}));
const chatController_1 = require("../controllers/chatController");
const chatModel_1 = require("../models/chatModel");
describe('ChatController', () => {
    let mockRequest;
    let mockResponse;
    let mockStatus;
    let mockJson;
    beforeEach(() => {
        mockStatus = jest.fn().mockReturnThis();
        mockJson = jest.fn().mockReturnThis();
        mockResponse = {
            status: mockStatus,
            json: mockJson
        };
        jest.clearAllMocks();
    });
    describe('getConversations', () => {
        it('should return user conversations successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userEmail = 'user@example.com';
            const mockConversations = [
                {
                    id: 'conv1',
                    participants: ['user@example.com', 'other@example.com'],
                    lastMessage: 'Hello there',
                    lastMessageTime: new Date().toISOString(),
                    unreadCount: 2,
                    isArchived: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                }
            };
            chatModel_1.getConversationsByUserModel.mockResolvedValue(mockConversations);
            // Act
            yield (0, chatController_1.getConversations)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.getConversationsByUserModel).toHaveBeenCalledWith(userEmail);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockConversations
            });
        }));
        it('should return error when user is not authenticated', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            mockRequest = {
                user: undefined
            };
            // Act
            yield (0, chatController_1.getConversations)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(401);
            expect(mockJson).toHaveBeenCalledWith({
                success: false,
                error: 'Usuario no autenticado'
            });
        }));
    });
    describe('getMessages', () => {
        it('should return messages successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const conversationId = 'conv123';
            const userEmail = 'user@example.com';
            const mockMessages = [
                {
                    id: 'msg1',
                    conversationId,
                    sender: 'user@example.com',
                    content: 'Hello',
                    timestamp: new Date().toISOString(),
                    isRead: false
                }
            ];
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { conversationId }
            };
            chatModel_1.getConversationByIdModel.mockResolvedValue({
                id: conversationId,
                participants: [userEmail, 'other@example.com']
            });
            chatModel_1.getMessagesByConversationModel.mockResolvedValue(mockMessages);
            chatModel_1.markConversationAsReadModel.mockResolvedValue(undefined);
            // Act
            yield (0, chatController_1.getMessages)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.getConversationByIdModel).toHaveBeenCalledWith(conversationId);
            expect(chatModel_1.getMessagesByConversationModel).toHaveBeenCalledWith(conversationId);
            expect(chatModel_1.markConversationAsReadModel).toHaveBeenCalledWith(conversationId, userEmail);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockMessages
            });
        }));
    });
    describe('sendMessage', () => {
        it('should send message successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const conversationId = 'conv123';
            const userEmail = 'user@example.com';
            const messageContent = 'Hello there';
            const mockMessage = {
                id: 'msg123',
                conversationId,
                sender: userEmail,
                content: messageContent,
                timestamp: new Date().toISOString(),
                isRead: false
            };
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { conversationId },
                body: { content: messageContent }
            };
            chatModel_1.getConversationByIdModel.mockResolvedValue({
                id: conversationId,
                participants: [userEmail, 'other@example.com']
            });
            chatModel_1.createMessageModel.mockResolvedValue(mockMessage);
            // Act
            yield (0, chatController_1.sendMessage)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.getConversationByIdModel).toHaveBeenCalledWith(conversationId);
            expect(chatModel_1.createMessageModel).toHaveBeenCalledWith({
                conversationId,
                senderId: userEmail,
                senderName: 'Test User',
                content: messageContent,
                status: 'sent',
                type: 'text'
            });
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockMessage
            });
        }));
    });
    describe('markAsRead', () => {
        it('should mark message as read successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const messageId = 'msg123';
            const userEmail = 'user@example.com';
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { messageId }
            };
            chatModel_1.markMessageAsReadModel.mockResolvedValue(undefined);
            // Act
            yield (0, chatController_1.markAsRead)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.markMessageAsReadModel).toHaveBeenCalledWith(messageId);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: null
            });
        }));
    });
    describe('createConversation', () => {
        it('should create conversation successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userEmail = 'user@example.com';
            const participantEmail = 'other@example.com';
            const mockConversation = {
                id: 'conv123',
                participants: [userEmail, participantEmail],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                body: { participants: [participantEmail] }
            };
            chatModel_1.getConversationBetweenUsersModel.mockResolvedValue(null);
            chatModel_1.createConversationModel.mockResolvedValue(mockConversation);
            // Act
            yield (0, chatController_1.createConversation)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.getConversationBetweenUsersModel).toHaveBeenCalledWith(userEmail, participantEmail);
            expect(chatModel_1.createConversationModel).toHaveBeenCalledWith([userEmail, participantEmail]);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockConversation
            });
        }));
        it('should return error when participant email is missing', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userEmail = 'user@example.com';
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                body: { participants: [] }
            };
            // Act
            yield (0, chatController_1.createConversation)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(400);
            expect(mockJson).toHaveBeenCalledWith({
                success: false,
                error: 'Se requiere al menos un participante'
            });
        }));
    });
    describe('searchConversations', () => {
        it('should search conversations successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userEmail = 'user@example.com';
            const searchTerm = 'test';
            const mockConversations = [
                {
                    id: 'conv1',
                    participants: [userEmail, 'other@example.com'],
                    lastMessage: 'test message',
                    lastMessageTime: new Date().toISOString(),
                    unreadCount: 0,
                    isArchived: false
                }
            ];
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                query: { search: searchTerm }
            };
            chatModel_1.searchConversationsModel.mockResolvedValue(mockConversations);
            // Act
            yield (0, chatController_1.searchConversations)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.searchConversationsModel).toHaveBeenCalledWith(userEmail, {
                dateFrom: undefined,
                dateTo: undefined,
                search: searchTerm,
                unreadOnly: false
            });
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockConversations
            });
        }));
    });
    describe('deleteConversation', () => {
        it('should delete conversation successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const conversationId = 'conv123';
            const userEmail = 'user@example.com';
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { conversationId }
            };
            chatModel_1.deleteConversationModel.mockResolvedValue(undefined);
            // Act
            yield (0, chatController_1.deleteConversation)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.deleteConversationModel).toHaveBeenCalledWith(conversationId, userEmail);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: null
            });
        }));
    });
    describe('archiveConversation', () => {
        it('should archive conversation successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const conversationId = 'conv123';
            const userEmail = 'user@example.com';
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { conversationId }
            };
            chatModel_1.archiveConversationModel.mockResolvedValue(undefined);
            // Act
            yield (0, chatController_1.archiveConversation)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.archiveConversationModel).toHaveBeenCalledWith(conversationId, userEmail);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: null
            });
        }));
    });
    describe('getConversationById', () => {
        it('should return conversation by id successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const conversationId = 'conv123';
            const userEmail = 'user@example.com';
            const mockConversation = {
                id: conversationId,
                participants: [userEmail, 'other@example.com'],
                lastMessage: 'Hello there',
                lastMessageTime: new Date().toISOString(),
                unreadCount: 2,
                isArchived: false,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { conversationId }
            };
            chatModel_1.getConversationByIdModel.mockResolvedValue(mockConversation);
            // Act
            yield (0, chatController_1.getConversationById)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.getConversationByIdModel).toHaveBeenCalledWith(conversationId);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockConversation
            });
        }));
        it('should return 404 when conversation not found', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const conversationId = 'nonexistent';
            const userEmail = 'user@example.com';
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                },
                params: { conversationId }
            };
            chatModel_1.getConversationByIdModel.mockResolvedValue(null);
            // Act
            yield (0, chatController_1.getConversationById)(mockRequest, mockResponse);
            // Assert
            expect(mockStatus).toHaveBeenCalledWith(404);
            expect(mockJson).toHaveBeenCalledWith({
                success: false,
                error: 'Conversación no encontrada'
            });
        }));
    });
    describe('getChatStats', () => {
        it('should return chat stats successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userEmail = 'user@example.com';
            const mockStats = {
                totalConversations: 10,
                unreadMessages: 5,
                archivedConversations: 2,
                totalMessages: 150
            };
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                }
            };
            chatModel_1.getChatStatsModel.mockResolvedValue(mockStats);
            // Act
            yield (0, chatController_1.getChatStats)(mockRequest, mockResponse);
            // Assert
            expect(chatModel_1.getChatStatsModel).toHaveBeenCalledWith(userEmail);
            expect(mockJson).toHaveBeenCalledWith({
                success: true,
                data: mockStats
            });
        }));
    });
    describe('getAvailableUsers', () => {
        it('should return available users successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userEmail = 'user@example.com';
            const mockUsers = [
                {
                    email: 'other@example.com',
                    name: 'Other User',
                    role: 'musician',
                    isOnline: true
                }
            ];
            mockRequest = {
                user: {
                    userId: 'user123',
                    userEmail: userEmail,
                    email: userEmail,
                    role: 'user',
                    name: 'Test User'
                }
            };
            // Mock the function that gets available users (this would need to be implemented)
            // For now, we'll just test the basic structure
            mockResponse.json = jest.fn();
            // Act
            yield (0, chatController_1.getAvailableUsers)(mockRequest, mockResponse);
            // Assert
            expect(mockResponse.json).toHaveBeenCalled();
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXGNoYXRDb250cm9sbGVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUE2QkEsdUJBQXVCO0FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDNUMsTUFBTSxFQUFFO1FBQ04sSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNoQjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBcENKLGtFQVl1QztBQUN2QyxtREFhNkI7QUFZN0IsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM5QixJQUFJLFdBQTZCLENBQUM7SUFDbEMsSUFBSSxZQUErQixDQUFDO0lBQ3BDLElBQUksVUFBcUIsQ0FBQztJQUMxQixJQUFJLFFBQW1CLENBQUM7SUFFeEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDeEMsUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QyxZQUFZLEdBQUc7WUFDYixNQUFNLEVBQUUsVUFBVTtZQUNsQixJQUFJLEVBQUUsUUFBUTtTQUNmLENBQUM7UUFDRixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxHQUFTLEVBQUU7WUFDN0QsVUFBVTtZQUNWLE1BQU0sU0FBUyxHQUFHLGtCQUFrQixD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O1lBQy9DLFlBQVksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBRTlCLE1BQU07WUFDTixNQUFNLElBQUEsa0NBQWlCLEVBQUMsV0FBc0IsRUFBRSxZQUF3QixDQUFDLENBQUM7WUFFMUUsU0FBUztZQUNULE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUMvQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcc3JjXFxBUFBfTXVzc2lrT25cXEFQUF9NdXNzaWtPbl9FeHByZXNzXFxzcmNcXF9fdGVzdHNfX1xcY2hhdENvbnRyb2xsZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQge1xyXG4gIGdldENvbnZlcnNhdGlvbnMsXHJcbiAgZ2V0TWVzc2FnZXMsXHJcbiAgc2VuZE1lc3NhZ2UsXHJcbiAgbWFya0FzUmVhZCxcclxuICBjcmVhdGVDb252ZXJzYXRpb24sXHJcbiAgc2VhcmNoQ29udmVyc2F0aW9ucyxcclxuICBkZWxldGVDb252ZXJzYXRpb24sXHJcbiAgYXJjaGl2ZUNvbnZlcnNhdGlvbixcclxuICBnZXRDb252ZXJzYXRpb25CeUlkLFxyXG4gIGdldENoYXRTdGF0cyxcclxuICBnZXRBdmFpbGFibGVVc2Vyc1xyXG59IGZyb20gJy4uL2NvbnRyb2xsZXJzL2NoYXRDb250cm9sbGVyJztcclxuaW1wb3J0IHtcclxuICBjcmVhdGVDb252ZXJzYXRpb25Nb2RlbCxcclxuICBnZXRDb252ZXJzYXRpb25zQnlVc2VyTW9kZWwsXHJcbiAgZ2V0Q29udmVyc2F0aW9uQnlJZE1vZGVsLFxyXG4gIGdldE1lc3NhZ2VzQnlDb252ZXJzYXRpb25Nb2RlbCxcclxuICBjcmVhdGVNZXNzYWdlTW9kZWwsXHJcbiAgbWFya01lc3NhZ2VBc1JlYWRNb2RlbCxcclxuICBtYXJrQ29udmVyc2F0aW9uQXNSZWFkTW9kZWwsXHJcbiAgc2VhcmNoQ29udmVyc2F0aW9uc01vZGVsLFxyXG4gIGRlbGV0ZUNvbnZlcnNhdGlvbk1vZGVsLFxyXG4gIGFyY2hpdmVDb252ZXJzYXRpb25Nb2RlbCxcclxuICBnZXRDaGF0U3RhdHNNb2RlbCxcclxuICBnZXRDb252ZXJzYXRpb25CZXR3ZWVuVXNlcnNNb2RlbCxcclxufSBmcm9tICcuLi9tb2RlbHMvY2hhdE1vZGVsJztcclxuXHJcbi8vIE1vY2sgdGhlIGNoYXQgbW9kZWxzXHJcbmplc3QubW9jaygnLi4vbW9kZWxzL2NoYXRNb2RlbCcpO1xyXG5qZXN0Lm1vY2soJy4uL3NlcnZpY2VzL2xvZ2dlclNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIGxvZ2dlcjoge1xyXG4gICAgaW5mbzogamVzdC5mbigpLFxyXG4gICAgZXJyb3I6IGplc3QuZm4oKSxcclxuICAgIHdhcm46IGplc3QuZm4oKVxyXG4gIH1cclxufSkpO1xyXG5cclxuZGVzY3JpYmUoJ0NoYXRDb250cm9sbGVyJywgKCkgPT4ge1xyXG4gIGxldCBtb2NrUmVxdWVzdDogUGFydGlhbDxSZXF1ZXN0PjtcclxuICBsZXQgbW9ja1Jlc3BvbnNlOiBQYXJ0aWFsPFJlc3BvbnNlPjtcclxuICBsZXQgbW9ja1N0YXR1czogamVzdC5Nb2NrO1xyXG4gIGxldCBtb2NrSnNvbjogamVzdC5Nb2NrO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIG1vY2tTdGF0dXMgPSBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKTtcclxuICAgIG1vY2tKc29uID0gamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCk7XHJcbiAgICBtb2NrUmVzcG9uc2UgPSB7XHJcbiAgICAgIHN0YXR1czogbW9ja1N0YXR1cyxcclxuICAgICAganNvbjogbW9ja0pzb25cclxuICAgIH07XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldENvbnZlcnNhdGlvbnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIGNvbnZlcnNhdGlvbnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuICAgICAgY29uc3QgbW9ja0NvbnZlcnNhdGlvbnMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdjb252MScsXHJcbiAgICAgICAgICBwYXJ0aWNpcGFudHM6IFsndXNlckBleGFtcGxlLmNvbScsICdvdGhlckBleGFtcGxlLmNvbSddLFxyXG4gICAgICAgICAgbGFzdE1lc3NhZ2U6ICdIZWxsbyB0aGVyZScsXHJcbiAgICAgICAgICBsYXN0TWVzc2FnZVRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVucmVhZENvdW50OiAyLFxyXG4gICAgICAgICAgaXNBcmNoaXZlZDogZmFsc2UsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIChnZXRDb252ZXJzYXRpb25zQnlVc2VyTW9kZWwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29udmVyc2F0aW9ucyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0Q29udmVyc2F0aW9ucyhtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChnZXRDb252ZXJzYXRpb25zQnlVc2VyTW9kZWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJFbWFpbCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YTogbW9ja0NvbnZlcnNhdGlvbnNcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBlcnJvciB3aGVuIHVzZXIgaXMgbm90IGF1dGhlbnRpY2F0ZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgdXNlcjogdW5kZWZpbmVkXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0Q29udmVyc2F0aW9ucyhtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDEpO1xyXG4gICAgICBleHBlY3QobW9ja0pzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRNZXNzYWdlcycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG1lc3NhZ2VzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBjb252ZXJzYXRpb25JZCA9ICdjb252MTIzJztcclxuICAgICAgY29uc3QgdXNlckVtYWlsID0gJ3VzZXJAZXhhbXBsZS5jb20nO1xyXG4gICAgICBjb25zdCBtb2NrTWVzc2FnZXMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6ICdtc2cxJyxcclxuICAgICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgc2VuZGVyOiAndXNlckBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICBjb250ZW50OiAnSGVsbG8nLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBpc1JlYWQ6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGFyYW1zOiB7IGNvbnZlcnNhdGlvbklkIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIChnZXRDb252ZXJzYXRpb25CeUlkTW9kZWwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgaWQ6IGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgIHBhcnRpY2lwYW50czogW3VzZXJFbWFpbCwgJ290aGVyQGV4YW1wbGUuY29tJ11cclxuICAgICAgfSk7XHJcbiAgICAgIChnZXRNZXNzYWdlc0J5Q29udmVyc2F0aW9uTW9kZWwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTWVzc2FnZXMpO1xyXG4gICAgICAobWFya0NvbnZlcnNhdGlvbkFzUmVhZE1vZGVsIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBnZXRNZXNzYWdlcyhtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChnZXRDb252ZXJzYXRpb25CeUlkTW9kZWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGNvbnZlcnNhdGlvbklkKTtcclxuICAgICAgZXhwZWN0KGdldE1lc3NhZ2VzQnlDb252ZXJzYXRpb25Nb2RlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY29udmVyc2F0aW9uSWQpO1xyXG4gICAgICBleHBlY3QobWFya0NvbnZlcnNhdGlvbkFzUmVhZE1vZGVsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjb252ZXJzYXRpb25JZCwgdXNlckVtYWlsKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBtb2NrTWVzc2FnZXNcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3NlbmRNZXNzYWdlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBzZW5kIG1lc3NhZ2Ugc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbklkID0gJ2NvbnYxMjMnO1xyXG4gICAgICBjb25zdCB1c2VyRW1haWwgPSAndXNlckBleGFtcGxlLmNvbSc7XHJcbiAgICAgIGNvbnN0IG1lc3NhZ2VDb250ZW50ID0gJ0hlbGxvIHRoZXJlJztcclxuICAgICAgY29uc3QgbW9ja01lc3NhZ2UgPSB7XHJcbiAgICAgICAgaWQ6ICdtc2cxMjMnLFxyXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgIHNlbmRlcjogdXNlckVtYWlsLFxyXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VDb250ZW50LFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIGlzUmVhZDogZmFsc2VcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICBlbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhcmFtczogeyBjb252ZXJzYXRpb25JZCB9LFxyXG4gICAgICAgIGJvZHk6IHsgY29udGVudDogbWVzc2FnZUNvbnRlbnQgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgKGdldENvbnZlcnNhdGlvbkJ5SWRNb2RlbCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBpZDogY29udmVyc2F0aW9uSWQsXHJcbiAgICAgICAgcGFydGljaXBhbnRzOiBbdXNlckVtYWlsLCAnb3RoZXJAZXhhbXBsZS5jb20nXVxyXG4gICAgICB9KTtcclxuICAgICAgKGNyZWF0ZU1lc3NhZ2VNb2RlbCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZXNzYWdlKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBzZW5kTWVzc2FnZShtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChnZXRDb252ZXJzYXRpb25CeUlkTW9kZWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGNvbnZlcnNhdGlvbklkKTtcclxuICAgICAgZXhwZWN0KGNyZWF0ZU1lc3NhZ2VNb2RlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgIHNlbmRlcklkOiB1c2VyRW1haWwsXHJcbiAgICAgICAgc2VuZGVyTmFtZTogJ1Rlc3QgVXNlcicsXHJcbiAgICAgICAgY29udGVudDogbWVzc2FnZUNvbnRlbnQsXHJcbiAgICAgICAgc3RhdHVzOiAnc2VudCcsXHJcbiAgICAgICAgdHlwZTogJ3RleHQnXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QobW9ja0pzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IG1vY2tNZXNzYWdlXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdtYXJrQXNSZWFkJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBtYXJrIG1lc3NhZ2UgYXMgcmVhZCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgbWVzc2FnZUlkID0gJ21zZzEyMyc7XHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICBlbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhcmFtczogeyBtZXNzYWdlSWQgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgKG1hcmtNZXNzYWdlQXNSZWFkTW9kZWwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IG1hcmtBc1JlYWQobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobWFya01lc3NhZ2VBc1JlYWRNb2RlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgobWVzc2FnZUlkKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjcmVhdGVDb252ZXJzYXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjb252ZXJzYXRpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuICAgICAgY29uc3QgcGFydGljaXBhbnRFbWFpbCA9ICdvdGhlckBleGFtcGxlLmNvbSc7XHJcbiAgICAgIGNvbnN0IG1vY2tDb252ZXJzYXRpb24gPSB7XHJcbiAgICAgICAgaWQ6ICdjb252MTIzJyxcclxuICAgICAgICBwYXJ0aWNpcGFudHM6IFt1c2VyRW1haWwsIHBhcnRpY2lwYW50RW1haWxdLFxyXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgZW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiB7IHBhcnRpY2lwYW50czogW3BhcnRpY2lwYW50RW1haWxdIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIChnZXRDb252ZXJzYXRpb25CZXR3ZWVuVXNlcnNNb2RlbCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgICAoY3JlYXRlQ29udmVyc2F0aW9uTW9kZWwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29udmVyc2F0aW9uKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBjcmVhdGVDb252ZXJzYXRpb24obW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoZ2V0Q29udmVyc2F0aW9uQmV0d2VlblVzZXJzTW9kZWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJFbWFpbCwgcGFydGljaXBhbnRFbWFpbCk7XHJcbiAgICAgIGV4cGVjdChjcmVhdGVDb252ZXJzYXRpb25Nb2RlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoW3VzZXJFbWFpbCwgcGFydGljaXBhbnRFbWFpbF0pO1xyXG4gICAgICBleHBlY3QobW9ja0pzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IG1vY2tDb252ZXJzYXRpb25cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBlcnJvciB3aGVuIHBhcnRpY2lwYW50IGVtYWlsIGlzIG1pc3NpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgdXNlckVtYWlsID0gJ3VzZXJAZXhhbXBsZS5jb20nO1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keTogeyBwYXJ0aWNpcGFudHM6IFtdIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBjcmVhdGVDb252ZXJzYXRpb24obW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTZSByZXF1aWVyZSBhbCBtZW5vcyB1biBwYXJ0aWNpcGFudGUnXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdzZWFyY2hDb252ZXJzYXRpb25zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBzZWFyY2ggY29udmVyc2F0aW9ucyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgdXNlckVtYWlsID0gJ3VzZXJAZXhhbXBsZS5jb20nO1xyXG4gICAgICBjb25zdCBzZWFyY2hUZXJtID0gJ3Rlc3QnO1xyXG4gICAgICBjb25zdCBtb2NrQ29udmVyc2F0aW9ucyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogJ2NvbnYxJyxcclxuICAgICAgICAgIHBhcnRpY2lwYW50czogW3VzZXJFbWFpbCwgJ290aGVyQGV4YW1wbGUuY29tJ10sXHJcbiAgICAgICAgICBsYXN0TWVzc2FnZTogJ3Rlc3QgbWVzc2FnZScsXHJcbiAgICAgICAgICBsYXN0TWVzc2FnZVRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVucmVhZENvdW50OiAwLFxyXG4gICAgICAgICAgaXNBcmNoaXZlZDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgZW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBxdWVyeTogeyBzZWFyY2g6IHNlYXJjaFRlcm0gfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgKHNlYXJjaENvbnZlcnNhdGlvbnNNb2RlbCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb252ZXJzYXRpb25zKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBzZWFyY2hDb252ZXJzYXRpb25zKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHNlYXJjaENvbnZlcnNhdGlvbnNNb2RlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgodXNlckVtYWlsLCB7XHJcbiAgICAgICAgZGF0ZUZyb206IHVuZGVmaW5lZCxcclxuICAgICAgICBkYXRlVG86IHVuZGVmaW5lZCxcclxuICAgICAgICBzZWFyY2g6IHNlYXJjaFRlcm0sXHJcbiAgICAgICAgdW5yZWFkT25seTogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YTogbW9ja0NvbnZlcnNhdGlvbnNcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2RlbGV0ZUNvbnZlcnNhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGVsZXRlIGNvbnZlcnNhdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgY29udmVyc2F0aW9uSWQgPSAnY29udjEyMyc7XHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICBlbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhcmFtczogeyBjb252ZXJzYXRpb25JZCB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAoZGVsZXRlQ29udmVyc2F0aW9uTW9kZWwgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IGRlbGV0ZUNvbnZlcnNhdGlvbihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChkZWxldGVDb252ZXJzYXRpb25Nb2RlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY29udmVyc2F0aW9uSWQsIHVzZXJFbWFpbCk7XHJcbiAgICAgIGV4cGVjdChtb2NrSnNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YTogbnVsbFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnYXJjaGl2ZUNvbnZlcnNhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgYXJjaGl2ZSBjb252ZXJzYXRpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbklkID0gJ2NvbnYxMjMnO1xyXG4gICAgICBjb25zdCB1c2VyRW1haWwgPSAndXNlckBleGFtcGxlLmNvbSc7XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgZW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYXJhbXM6IHsgY29udmVyc2F0aW9uSWQgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgKGFyY2hpdmVDb252ZXJzYXRpb25Nb2RlbCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgYXJjaGl2ZUNvbnZlcnNhdGlvbihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChhcmNoaXZlQ29udmVyc2F0aW9uTW9kZWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGNvbnZlcnNhdGlvbklkLCB1c2VyRW1haWwpO1xyXG4gICAgICBleHBlY3QobW9ja0pzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldENvbnZlcnNhdGlvbkJ5SWQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb252ZXJzYXRpb24gYnkgaWQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbklkID0gJ2NvbnYxMjMnO1xyXG4gICAgICBjb25zdCB1c2VyRW1haWwgPSAndXNlckBleGFtcGxlLmNvbSc7XHJcbiAgICAgIGNvbnN0IG1vY2tDb252ZXJzYXRpb24gPSB7XHJcbiAgICAgICAgaWQ6IGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgIHBhcnRpY2lwYW50czogW3VzZXJFbWFpbCwgJ290aGVyQGV4YW1wbGUuY29tJ10sXHJcbiAgICAgICAgbGFzdE1lc3NhZ2U6ICdIZWxsbyB0aGVyZScsXHJcbiAgICAgICAgbGFzdE1lc3NhZ2VUaW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdW5yZWFkQ291bnQ6IDIsXHJcbiAgICAgICAgaXNBcmNoaXZlZDogZmFsc2UsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICBlbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhcmFtczogeyBjb252ZXJzYXRpb25JZCB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAoZ2V0Q29udmVyc2F0aW9uQnlJZE1vZGVsIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbnZlcnNhdGlvbik7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0Q29udmVyc2F0aW9uQnlJZChtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChnZXRDb252ZXJzYXRpb25CeUlkTW9kZWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGNvbnZlcnNhdGlvbklkKTtcclxuICAgICAgZXhwZWN0KG1vY2tKc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBtb2NrQ29udmVyc2F0aW9uXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gNDA0IHdoZW4gY29udmVyc2F0aW9uIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBjb252ZXJzYXRpb25JZCA9ICdub25leGlzdGVudCc7XHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxyXG4gICAgICAgICAgdXNlckVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICBlbWFpbDogdXNlckVtYWlsLFxyXG4gICAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhcmFtczogeyBjb252ZXJzYXRpb25JZCB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAoZ2V0Q29udmVyc2F0aW9uQnlJZE1vZGVsIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0Q29udmVyc2F0aW9uQnlJZChtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChtb2NrU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDQpO1xyXG4gICAgICBleHBlY3QobW9ja0pzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0NvbnZlcnNhY2nDs24gbm8gZW5jb250cmFkYSdcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldENoYXRTdGF0cycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNoYXQgc3RhdHMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xyXG4gICAgICAgIHRvdGFsQ29udmVyc2F0aW9uczogMTAsXHJcbiAgICAgICAgdW5yZWFkTWVzc2FnZXM6IDUsXHJcbiAgICAgICAgYXJjaGl2ZWRDb252ZXJzYXRpb25zOiAyLFxyXG4gICAgICAgIHRvdGFsTWVzc2FnZXM6IDE1MFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIChnZXRDaGF0U3RhdHNNb2RlbCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdGF0cyk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0Q2hhdFN0YXRzKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KGdldENoYXRTdGF0c01vZGVsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh1c2VyRW1haWwpO1xyXG4gICAgICBleHBlY3QobW9ja0pzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IG1vY2tTdGF0c1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0QXZhaWxhYmxlVXNlcnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhdmFpbGFibGUgdXNlcnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHVzZXJFbWFpbCA9ICd1c2VyQGV4YW1wbGUuY29tJztcclxuICAgICAgY29uc3QgbW9ja1VzZXJzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVtYWlsOiAnb3RoZXJAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgbmFtZTogJ090aGVyIFVzZXInLFxyXG4gICAgICAgICAgcm9sZTogJ211c2ljaWFuJyxcclxuICAgICAgICAgIGlzT25saW5lOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJFbWFpbCxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyRW1haWwsXHJcbiAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE1vY2sgdGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBhdmFpbGFibGUgdXNlcnMgKHRoaXMgd291bGQgbmVlZCB0byBiZSBpbXBsZW1lbnRlZClcclxuICAgICAgLy8gRm9yIG5vdywgd2UnbGwganVzdCB0ZXN0IHRoZSBiYXNpYyBzdHJ1Y3R1cmVcclxuICAgICAgbW9ja1Jlc3BvbnNlLmpzb24gPSBqZXN0LmZuKCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgZ2V0QXZhaWxhYmxlVXNlcnMobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsgIl0sInZlcnNpb24iOjN9