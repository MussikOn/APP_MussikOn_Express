{"version":3,"names":["cov_866s1yfvi","actualCoverage","exports","authMiddleware","s","requireRole","jsonwebtoken_1","__importDefault","require","ENV_1","req","res","next","f","authHeader","headers","authorization","b","startsWith","status","json","message","token","split","decoded","default","verify","TOKEN_SECRET","user","err","roles","includes","roll","msg"],"sources":["C:\\src\\APP_MussikOn\\APP_MussikOn_Express\\src\\middleware\\authMiddleware.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport jwt from 'jsonwebtoken';\r\nimport { TOKEN_SECRET } from '../../ENV';\r\n\r\nexport function authMiddleware(\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n): void {\r\n  const authHeader = req.headers.authorization;\r\n\r\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n    res.status(401).json({ message: 'Token no proporcionado' });\r\n    return;\r\n  }\r\n\r\n  const token = authHeader.split(' ')[1];\r\n\r\n  try {\r\n    const decoded = jwt.verify(token, TOKEN_SECRET);\r\n    // Agregar el usuario decodificado en req.user\r\n    (req as any).user = decoded;\r\n    next();\r\n  } catch (err) {\r\n    res.status(401).json({ message: 'Token invÃ¡lido o expirado' });\r\n  }\r\n}\r\n\r\n/**\r\n * Middleware para validar el rol del usuario.\r\n * @param roles Roles permitidos para acceder al endpoint\r\n */\r\nexport function requireRole(...roles: string[]) {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    const user = (req as any).user;\r\n    if (!user || !roles.includes(user.roll)) {\r\n      return res.status(403).json({ msg: 'No autorizado. Rol insuficiente.' });\r\n    }\r\n    next();\r\n  };\r\n}\r\n"],"mappings":"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","ignoreList":[]}