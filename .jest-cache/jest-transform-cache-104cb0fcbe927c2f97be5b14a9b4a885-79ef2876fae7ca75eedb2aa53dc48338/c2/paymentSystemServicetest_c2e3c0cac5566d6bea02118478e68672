af143c3b7073a125b7e8378725a64d4d
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Firebase
jest.mock('../utils/firebase', () => ({
    db: {
        collection: jest.fn(),
    },
}));
// Mock S3 upload
jest.mock('../utils/idriveE2', () => ({
    uploadToS3: jest.fn(),
}));
// Mock logger
jest.mock('../services/loggerService', () => ({
    logger: {
        info: jest.fn(),
        error: jest.fn(),
        warn: jest.fn()
    }
}));
const paymentSystemService_1 = require("../services/paymentSystemService");
const firebase_1 = require("../utils/firebase");
const idriveE2_1 = require("../utils/idriveE2");
describe('PaymentSystemService', () => {
    let paymentService;
    let mockFirestore;
    let mockCollection;
    let mockDoc;
    beforeEach(() => {
        paymentService = new paymentSystemService_1.PaymentSystemService();
        mockDoc = {
            get: jest.fn(),
            set: jest.fn(),
            update: jest.fn(),
            exists: false,
            data: jest.fn()
        };
        mockCollection = {
            doc: jest.fn().mockReturnValue(mockDoc),
            where: jest.fn().mockReturnThis(),
            get: jest.fn(),
            set: jest.fn(),
            update: jest.fn(),
            add: jest.fn(),
            orderBy: jest.fn().mockReturnThis(),
            limit: jest.fn().mockReturnThis(),
            exists: false,
            data: jest.fn(),
            size: 0,
            docs: []
        };
        // Configurar mocks para que funcionen correctamente
        firebase_1.db.collection.mockReturnValue(mockCollection);
        firebase_1.db.doc = jest.fn().mockReturnValue(mockDoc);
        // Configurar mockDoc.get para que retorne el mockDoc
        mockDoc.get.mockResolvedValue(mockDoc);
        // Configurar mockCollection.get para que retorne un objeto con docs
        mockCollection.get.mockResolvedValue({
            docs: [],
            size: 0
        });
        jest.clearAllMocks();
    });
    describe('getUserBalance', () => {
        it('should return existing user balance', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockBalance = {
                userId,
                balance: 1000,
                currency: 'RD$',
                lastUpdated: new Date().toISOString(),
                totalDeposits: 2000,
                totalEarnings: 1500,
                totalWithdrawals: 500
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockBalance);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.getUserBalance(userId);
            // Assert
            expect(mockCollection.doc).toHaveBeenCalledWith(userId);
            expect(mockDoc.get).toHaveBeenCalled();
            expect(result).toEqual(mockBalance);
        }));
        it('should create initial balance when user has no balance', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            mockDoc.exists = false;
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.getUserBalance(userId);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith({
                userId,
                balance: 0,
                currency: 'RD$',
                lastUpdated: expect.any(String),
                totalDeposits: 0,
                totalWithdrawals: 0,
                totalEarnings: 0
            });
            expect(result.balance).toBe(0);
            expect(result.currency).toBe('RD$');
        }));
    });
    describe('registerBankAccount', () => {
        it('should register bank account successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const accountData = {
                accountHolder: 'John Doe',
                accountNumber: '1234567890',
                accountType: 'savings',
                bankName: 'Banco Popular',
                routingNumber: '123456789'
            };
            mockCollection.get.mockResolvedValue({
                docs: [],
                size: 0
            });
            // Act
            const result = yield paymentService.registerBankAccount(userId, accountData);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining(Object.assign(Object.assign({ userId }, accountData), { isVerified: false, isDefault: false })));
            expect(result.isDefault).toBe(false);
        }));
        it('should set first account as default', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const accountData = {
                accountHolder: 'John Doe',
                accountNumber: '1234567890',
                accountType: 'savings',
                bankName: 'Banco Popular',
                routingNumber: '123456789'
            };
            mockCollection.get.mockResolvedValue({
                docs: [{
                        data: () => ({ id: 'existing_account' }),
                        id: 'existing_account'
                    }],
                size: 1
            });
            // Act
            const result = yield paymentService.registerBankAccount(userId, accountData);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith({ isDefault: true });
            expect(result.isDefault).toBe(true);
        }));
    });
    describe('getUserBankAccounts', () => {
        it('should return user bank accounts with optimized query', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const mockAccounts = [
                {
                    id: 'bank1',
                    userId,
                    accountHolder: 'John Doe',
                    accountNumber: '1234567890',
                    accountType: 'savings',
                    bankName: 'Banco Popular',
                    routingNumber: '123456789',
                    isVerified: true,
                    isDefault: true,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockAccounts.map(account => ({
                    data: () => account,
                    id: account.id
                })),
                size: mockAccounts.length
            });
            // Act
            const result = yield paymentService.getUserBankAccounts(userId);
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('userId', '==', userId);
            expect(mockCollection.orderBy).toHaveBeenCalledWith('isDefault', 'desc');
            expect(result).toEqual(mockAccounts);
        }));
        it('should fallback to memory sorting when index is not available', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            mockCollection.get.mockRejectedValue(new Error('Index not available'));
            // Act & Assert
            yield expect(paymentService.getUserBankAccounts(userId)).rejects.toThrow('Error obteniendo cuentas bancarias');
        }));
    });
    describe('uploadDepositVoucher', () => {
        it('should upload deposit voucher successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const userId = 'user123';
            const depositData = {
                amount: 1000,
                voucherFile: {
                    fieldname: 'voucher',
                    originalname: 'voucher.jpg',
                    encoding: '7bit',
                    mimetype: 'image/jpeg',
                    buffer: Buffer.from('test'),
                    size: 1024,
                    stream: {},
                    destination: '',
                    filename: 'voucher.jpg',
                    path: ''
                },
                accountHolderName: 'Juan PÃ©rez',
                bankName: 'Banco Popular'
            };
            const mockS3Url = 'https://s3.amazonaws.com/voucher.jpg';
            idriveE2_1.uploadToS3.mockResolvedValue(mockS3Url);
            // Act
            const result = yield paymentService.uploadDepositVoucher(userId, depositData);
            // Assert
            expect(idriveE2_1.uploadToS3).toHaveBeenCalledWith(depositData.voucherFile.buffer, 'voucher.jpg', 'image/jpeg', 'deposits');
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining({
                userId,
                amount: depositData.amount,
                status: 'pending',
                accountHolderName: depositData.accountHolderName,
                bankName: depositData.bankName
            }));
            expect(result.status).toBe('pending');
        }));
    });
    describe('verifyDeposit', () => {
        it('should verify deposit successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const depositId = 'deposit123';
            const adminId = 'admin123';
            const approved = true;
            const notes = 'DepÃ³sito verificado';
            const verificationData = {
                bankDepositDate: '2024-01-15',
                bankDepositTime: '14:30',
                referenceNumber: 'REF123456',
                accountLastFourDigits: '1234',
                verifiedBy: 'admin123'
            };
            const mockDeposit = {
                id: depositId,
                userId: 'user123',
                amount: 1000,
                status: 'pending'
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockDeposit);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            yield paymentService.verifyDeposit(depositId, adminId, approved, notes, verificationData);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith(expect.objectContaining({
                status: 'approved',
                verifiedBy: adminId,
                verifiedAt: expect.any(String),
                notes,
                verificationData
            }));
        }));
        it('should reject deposit successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const depositId = 'deposit123';
            const adminId = 'admin123';
            const approved = false;
            const notes = 'Comprobante invÃ¡lido';
            const mockDeposit = {
                id: depositId,
                userId: 'user123',
                amount: 1000,
                status: 'pending'
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockDeposit);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            yield paymentService.verifyDeposit(depositId, adminId, approved, notes);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith(expect.objectContaining({
                status: 'rejected',
                verifiedBy: adminId,
                verifiedAt: expect.any(String),
                notes
            }));
        }));
    });
    describe('processEventPayment', () => {
        it('should process event payment successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const paymentData = {
                eventId: 'event123',
                organizerId: 'organizer123',
                musicianId: 'musician123',
                amount: 500,
                paymentMethod: 'balance',
                description: 'Pago por evento'
            };
            const mockBalance = {
                userId: 'organizer123',
                balance: 1000,
                currency: 'RD$',
                lastUpdated: new Date().toISOString(),
                totalDeposits: 2000,
                totalEarnings: 0,
                totalWithdrawals: 0
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockBalance);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.processEventPayment(paymentData);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining({
                eventId: paymentData.eventId,
                organizerId: paymentData.organizerId,
                musicianId: paymentData.musicianId,
                amount: paymentData.amount,
                status: 'completed'
            }));
            expect(result.status).toBe('completed');
        }));
    });
    describe('requestWithdrawal', () => {
        it('should request withdrawal successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const musicianId = 'musician123';
            const withdrawalData = {
                amount: 200,
                bankAccountId: 'bank123',
                description: 'Retiro de ganancias'
            };
            const mockEarnings = {
                totalEarnings: 500,
                availableBalance: 300
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockEarnings);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            const result = yield paymentService.requestWithdrawal(musicianId, withdrawalData);
            // Assert
            expect(mockDoc.set).toHaveBeenCalledWith(expect.objectContaining({
                musicianId,
                amount: withdrawalData.amount,
                bankAccountId: withdrawalData.bankAccountId,
                status: 'pending'
            }));
            expect(result.status).toBe('pending');
        }));
    });
    describe('processWithdrawal', () => {
        it('should process withdrawal successfully', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const withdrawalId = 'withdrawal123';
            const adminId = 'admin123';
            const approved = true;
            const notes = 'Retiro aprobado';
            const mockWithdrawal = {
                id: withdrawalId,
                musicianId: 'musician123',
                amount: 200,
                status: 'pending'
            };
            mockDoc.exists = true;
            mockDoc.data.mockReturnValue(mockWithdrawal);
            mockDoc.get.mockResolvedValue(mockDoc);
            // Act
            yield paymentService.processWithdrawal(withdrawalId, adminId, approved, notes);
            // Assert
            expect(mockDoc.update).toHaveBeenCalledWith(expect.objectContaining({
                status: 'approved',
                processedBy: adminId,
                processedAt: expect.any(String),
                notes
            }));
        }));
    });
    describe('getPaymentStatistics', () => {
        it('should return payment statistics', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockStats = {
                totalUsers: 100,
                totalMusicians: 50,
                totalEvents: 200,
                totalRevenue: 50000,
                totalCommissions: 5000,
                averageEventValue: 250,
                monthlyGrowth: 15.5
            };
            mockCollection.get.mockResolvedValue({
                docs: [],
                size: 100
            });
            // Act
            const result = yield paymentService.getPaymentStatistics();
            // Assert
            expect(result).toEqual(expect.objectContaining({
                totalUsers: expect.any(Number),
                totalMusicians: expect.any(Number),
                totalEvents: expect.any(Number)
            }));
        }));
    });
    describe('getPendingDeposits', () => {
        it('should return pending deposits', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockDeposits = [
                {
                    id: 'deposit1',
                    userId: 'user123',
                    amount: 1000,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockDeposits.map(deposit => ({
                    data: () => deposit,
                    id: deposit.id
                })),
                size: mockDeposits.length
            });
            // Act
            const result = yield paymentService.getPendingDeposits();
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('status', '==', 'pending');
            expect(mockCollection.orderBy).toHaveBeenCalledWith('createdAt', 'desc');
            expect(result).toEqual(mockDeposits);
        }));
    });
    describe('getPendingWithdrawals', () => {
        it('should return pending withdrawals', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const mockWithdrawals = [
                {
                    id: 'withdrawal1',
                    musicianId: 'musician123',
                    amount: 200,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockWithdrawals.map(withdrawal => ({
                    data: () => withdrawal,
                    id: withdrawal.id
                })),
                size: mockWithdrawals.length
            });
            // Act
            const result = yield paymentService.getPendingWithdrawals();
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('status', '==', 'pending');
            expect(mockCollection.orderBy).toHaveBeenCalledWith('createdAt', 'desc');
            expect(result).toEqual(mockWithdrawals);
        }));
    });
    describe('getMusicianEarnings', () => {
        it('should return musician earnings', () => __awaiter(void 0, void 0, void 0, function* () {
            // Arrange
            const musicianId = 'musician123';
            const mockEarnings = [
                {
                    id: 'earning1',
                    musicianId,
                    eventId: 'event123',
                    amount: 500,
                    commission: 50,
                    netAmount: 450,
                    createdAt: new Date().toISOString()
                }
            ];
            mockCollection.get.mockResolvedValue({
                docs: mockEarnings.map(earning => ({
                    data: () => earning,
                    id: earning.id
                })),
                size: mockEarnings.length
            });
            // Act
            const result = yield paymentService.getMusicianEarnings(musicianId);
            // Assert
            expect(mockCollection.where).toHaveBeenCalledWith('musicianId', '==', musicianId);
            expect(mockCollection.orderBy).toHaveBeenCalledWith('createdAt', 'desc');
            expect(result).toEqual(mockEarnings);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHBheW1lbnRTeXN0ZW1TZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFJQSxnQkFBZ0I7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLEVBQUUsRUFBRTtRQUNGLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3RCO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSixpQkFBaUI7QUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBRUosY0FBYztBQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM1QyxNQUFNLEVBQUU7UUFDTixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2hCO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUF2QkosMkVBQXdFO0FBQ3hFLGdEQUF1QztBQUN2QyxnREFBK0M7QUF1Qi9DLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsSUFBSSxjQUFvQyxDQUFDO0lBQ3pDLElBQUksYUFBa0IsQ0FBQztJQUN2QixJQUFJLGNBQW1CLENBQUM7SUFDeEIsSUFBSSxPQUFZLENBQUM7SUFFakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGNBQWMsR0FBRyxJQUFJLDJDQUFvQixFQUFFLENBQUM7UUFFNUMsT0FBTyxHQUFHO1lBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZCxHQUFH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O2FBQzFCLENBQUMsQ0FBQztZQUVILE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLGNBQWMsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUVwRSxTQUFTO1lBQ1QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ2xGLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3pFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXHNyY1xcQVBQX011c3Npa09uXFxBUFBfTXVzc2lrT25fRXhwcmVzc1xcc3JjXFxfX3Rlc3RzX19cXHBheW1lbnRTeXN0ZW1TZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGF5bWVudFN5c3RlbVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9wYXltZW50U3lzdGVtU2VydmljZSc7XG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uL3V0aWxzL2ZpcmViYXNlJztcbmltcG9ydCB7IHVwbG9hZFRvUzMgfSBmcm9tICcuLi91dGlscy9pZHJpdmVFMic7XG5cbi8vIE1vY2sgRmlyZWJhc2Vcbmplc3QubW9jaygnLi4vdXRpbHMvZmlyZWJhc2UnLCAoKSA9PiAoe1xuICBkYjoge1xuICAgIGNvbGxlY3Rpb246IGplc3QuZm4oKSxcbiAgfSxcbn0pKTtcblxuLy8gTW9jayBTMyB1cGxvYWRcbmplc3QubW9jaygnLi4vdXRpbHMvaWRyaXZlRTInLCAoKSA9PiAoe1xuICB1cGxvYWRUb1MzOiBqZXN0LmZuKCksXG59KSk7XG5cbi8vIE1vY2sgbG9nZ2VyXG5qZXN0Lm1vY2soJy4uL3NlcnZpY2VzL2xvZ2dlclNlcnZpY2UnLCAoKSA9PiAoe1xuICBsb2dnZXI6IHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICB3YXJuOiBqZXN0LmZuKClcbiAgfVxufSkpO1xuXG5kZXNjcmliZSgnUGF5bWVudFN5c3RlbVNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBwYXltZW50U2VydmljZTogUGF5bWVudFN5c3RlbVNlcnZpY2U7XG4gIGxldCBtb2NrRmlyZXN0b3JlOiBhbnk7XG4gIGxldCBtb2NrQ29sbGVjdGlvbjogYW55O1xuICBsZXQgbW9ja0RvYzogYW55O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHBheW1lbnRTZXJ2aWNlID0gbmV3IFBheW1lbnRTeXN0ZW1TZXJ2aWNlKCk7XG4gICAgXG4gICAgbW9ja0RvYyA9IHtcbiAgICAgIGdldDogamVzdC5mbigpLFxuICAgICAgc2V0OiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIGV4aXN0czogZmFsc2UsXG4gICAgICBkYXRhOiBqZXN0LmZuKClcbiAgICB9O1xuXG4gICAgbW9ja0NvbGxlY3Rpb24gPSB7XG4gICAgICBkb2M6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0RvYyksXG4gICAgICB3aGVyZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICAgIHNldDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBhZGQ6IGplc3QuZm4oKSxcbiAgICAgIG9yZGVyQnk6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgbGltaXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgZXhpc3RzOiBmYWxzZSxcbiAgICAgIGRhdGE6IGplc3QuZm4oKSxcbiAgICAgIHNpemU6IDAsXG4gICAgICBkb2NzOiBbXVxuICAgIH07XG5cbiAgICAvLyBDb25maWd1cmFyIG1vY2tzIHBhcmEgcXVlIGZ1bmNpb25lbiBjb3JyZWN0YW1lbnRlXG4gICAgKGRiLmNvbGxlY3Rpb24gYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUobW9ja0NvbGxlY3Rpb24pO1xuICAgIChkYiBhcyBhbnkpLmRvYyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0RvYyk7XG4gICAgXG4gICAgLy8gQ29uZmlndXJhciBtb2NrRG9jLmdldCBwYXJhIHF1ZSByZXRvcm5lIGVsIG1vY2tEb2NcbiAgICBtb2NrRG9jLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRG9jKTtcbiAgICBcbiAgICAvLyBDb25maWd1cmFyIG1vY2tDb2xsZWN0aW9uLmdldCBwYXJhIHF1ZSByZXRvcm5lIHVuIG9iamV0byBjb24gZG9jc1xuICAgIG1vY2tDb2xsZWN0aW9uLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBkb2NzOiBbXSxcbiAgICAgIHNpemU6IDBcbiAgICB9KTtcbiAgICBcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFVzZXJCYWxhbmNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGV4aXN0aW5nIHVzZXIgYmFsYW5jZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMTIzJztcbiAgICAgIGNvbnN0IG1vY2tCYWxhbmNlID0ge1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIGJhbGFuY2U6IDEwMDAsXG4gICAgICAgIGN1cnJlbmN5OiAnUkQkJyxcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdG90YWxEZXBvc2l0czogMjAwMCxcbiAgICAgICAgdG90YWxFYXJuaW5nczogMTUwMCxcbiAgICAgICAgdG90YWxXaXRoZHJhd2FsczogNTAwXG4gICAgICB9O1xuXG4gICAgICBtb2NrRG9jLmV4aXN0cyA9IHRydWU7XG4gICAgICBtb2NrRG9jLmRhdGEubW9ja1JldHVyblZhbHVlKG1vY2tCYWxhbmNlKTtcbiAgICAgIG1vY2tEb2MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEb2MpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFVzZXJCYWxhbmNlKHVzZXJJZCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tDb2xsZWN0aW9uLmRvYykudG9IYXZlQmVlbkNhbGxlZFdpdGgodXNlcklkKTtcbiAgICAgIGV4cGVjdChtb2NrRG9jLmdldCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQmFsYW5jZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpbml0aWFsIGJhbGFuY2Ugd2hlbiB1c2VyIGhhcyBubyBiYWxhbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxMjMnO1xuICAgICAgbW9ja0RvYy5leGlzdHMgPSBmYWxzZTtcbiAgICAgIG1vY2tEb2MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEb2MpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFVzZXJCYWxhbmNlKHVzZXJJZCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tEb2Muc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgYmFsYW5jZTogMCxcbiAgICAgICAgY3VycmVuY3k6ICdSRCQnLFxuICAgICAgICBsYXN0VXBkYXRlZDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB0b3RhbERlcG9zaXRzOiAwLFxuICAgICAgICB0b3RhbFdpdGhkcmF3YWxzOiAwLFxuICAgICAgICB0b3RhbEVhcm5pbmdzOiAwXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmFsYW5jZSkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3VycmVuY3kpLnRvQmUoJ1JEJCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVnaXN0ZXJCYW5rQWNjb3VudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGJhbmsgYWNjb3VudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XG4gICAgICBjb25zdCBhY2NvdW50RGF0YSA9IHtcbiAgICAgICAgYWNjb3VudEhvbGRlcjogJ0pvaG4gRG9lJyxcbiAgICAgICAgYWNjb3VudE51bWJlcjogJzEyMzQ1Njc4OTAnLFxuICAgICAgICBhY2NvdW50VHlwZTogJ3NhdmluZ3MnIGFzIGNvbnN0LFxuICAgICAgICBiYW5rTmFtZTogJ0JhbmNvIFBvcHVsYXInLFxuICAgICAgICByb3V0aW5nTnVtYmVyOiAnMTIzNDU2Nzg5J1xuICAgICAgfTtcblxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZG9jczogW10sXG4gICAgICAgIHNpemU6IDBcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLnJlZ2lzdGVyQmFua0FjY291bnQodXNlcklkLCBhY2NvdW50RGF0YSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tEb2Muc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgLi4uYWNjb3VudERhdGEsXG4gICAgICAgIGlzVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICBpc0RlZmF1bHQ6IGZhbHNlXG4gICAgICB9KSk7XG4gICAgICBleHBlY3QocmVzdWx0LmlzRGVmYXVsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNldCBmaXJzdCBhY2NvdW50IGFzIGRlZmF1bHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XG4gICAgICBjb25zdCBhY2NvdW50RGF0YSA9IHtcbiAgICAgICAgYWNjb3VudEhvbGRlcjogJ0pvaG4gRG9lJyxcbiAgICAgICAgYWNjb3VudE51bWJlcjogJzEyMzQ1Njc4OTAnLFxuICAgICAgICBhY2NvdW50VHlwZTogJ3NhdmluZ3MnIGFzIGNvbnN0LFxuICAgICAgICBiYW5rTmFtZTogJ0JhbmNvIFBvcHVsYXInLFxuICAgICAgICByb3V0aW5nTnVtYmVyOiAnMTIzNDU2Nzg5J1xuICAgICAgfTtcblxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZG9jczogW3tcbiAgICAgICAgICBkYXRhOiAoKSA9PiAoeyBpZDogJ2V4aXN0aW5nX2FjY291bnQnIH0pLFxuICAgICAgICAgIGlkOiAnZXhpc3RpbmdfYWNjb3VudCdcbiAgICAgICAgfV0sXG4gICAgICAgIHNpemU6IDFcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLnJlZ2lzdGVyQmFua0FjY291bnQodXNlcklkLCBhY2NvdW50RGF0YSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tEb2MudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IGlzRGVmYXVsdDogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNEZWZhdWx0KS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXNlckJhbmtBY2NvdW50cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIGJhbmsgYWNjb3VudHMgd2l0aCBvcHRpbWl6ZWQgcXVlcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XG4gICAgICBjb25zdCBtb2NrQWNjb3VudHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2JhbmsxJyxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgYWNjb3VudEhvbGRlcjogJ0pvaG4gRG9lJyxcbiAgICAgICAgICBhY2NvdW50TnVtYmVyOiAnMTIzNDU2Nzg5MCcsXG4gICAgICAgICAgYWNjb3VudFR5cGU6ICdzYXZpbmdzJyBhcyBjb25zdCxcbiAgICAgICAgICBiYW5rTmFtZTogJ0JhbmNvIFBvcHVsYXInLFxuICAgICAgICAgIHJvdXRpbmdOdW1iZXI6ICcxMjM0NTY3ODknLFxuICAgICAgICAgIGlzVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgaXNEZWZhdWx0OiB0cnVlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIG1vY2tDb2xsZWN0aW9uLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRvY3M6IG1vY2tBY2NvdW50cy5tYXAoYWNjb3VudCA9PiAoe1xuICAgICAgICAgIGRhdGE6ICgpID0+IGFjY291bnQsXG4gICAgICAgICAgaWQ6IGFjY291bnQuaWRcbiAgICAgICAgfSkpLFxuICAgICAgICBzaXplOiBtb2NrQWNjb3VudHMubGVuZ3RoXG4gICAgICB9KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS5nZXRVc2VyQmFua0FjY291bnRzKHVzZXJJZCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tDb2xsZWN0aW9uLndoZXJlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcklkJywgJz09JywgdXNlcklkKTtcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi5vcmRlckJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaXNEZWZhdWx0JywgJ2Rlc2MnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0FjY291bnRzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFsbGJhY2sgdG8gbWVtb3J5IHNvcnRpbmcgd2hlbiBpbmRleCBpcyBub3QgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxMjMnO1xuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSW5kZXggbm90IGF2YWlsYWJsZScpKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QocGF5bWVudFNlcnZpY2UuZ2V0VXNlckJhbmtBY2NvdW50cyh1c2VySWQpKS5yZWplY3RzLnRvVGhyb3coJ0Vycm9yIG9idGVuaWVuZG8gY3VlbnRhcyBiYW5jYXJpYXMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwbG9hZERlcG9zaXRWb3VjaGVyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBsb2FkIGRlcG9zaXQgdm91Y2hlciBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEyMyc7XG4gICAgICBjb25zdCBkZXBvc2l0RGF0YSA9IHtcbiAgICAgICAgYW1vdW50OiAxMDAwLFxuICAgICAgICB2b3VjaGVyRmlsZToge1xuICAgICAgICAgIGZpZWxkbmFtZTogJ3ZvdWNoZXInLFxuICAgICAgICAgIG9yaWdpbmFsbmFtZTogJ3ZvdWNoZXIuanBnJyxcbiAgICAgICAgICBlbmNvZGluZzogJzdiaXQnLFxuICAgICAgICAgIG1pbWV0eXBlOiAnaW1hZ2UvanBlZycsXG4gICAgICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgndGVzdCcpLFxuICAgICAgICAgIHNpemU6IDEwMjQsXG4gICAgICAgICAgc3RyZWFtOiB7fSBhcyBhbnksXG4gICAgICAgICAgZGVzdGluYXRpb246ICcnLFxuICAgICAgICAgIGZpbGVuYW1lOiAndm91Y2hlci5qcGcnLFxuICAgICAgICAgIHBhdGg6ICcnXG4gICAgICAgIH0sXG4gICAgICAgIGFjY291bnRIb2xkZXJOYW1lOiAnSnVhbiBQw6lyZXonLFxuICAgICAgICBiYW5rTmFtZTogJ0JhbmNvIFBvcHVsYXInXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUzNVcmwgPSAnaHR0cHM6Ly9zMy5hbWF6b25hd3MuY29tL3ZvdWNoZXIuanBnJztcbiAgICAgICh1cGxvYWRUb1MzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1MzVXJsKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwYXltZW50U2VydmljZS51cGxvYWREZXBvc2l0Vm91Y2hlcih1c2VySWQsIGRlcG9zaXREYXRhKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QodXBsb2FkVG9TMykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGRlcG9zaXREYXRhLnZvdWNoZXJGaWxlLmJ1ZmZlcixcbiAgICAgICAgJ3ZvdWNoZXIuanBnJyxcbiAgICAgICAgJ2ltYWdlL2pwZWcnLFxuICAgICAgICAnZGVwb3NpdHMnXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tEb2Muc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgYW1vdW50OiBkZXBvc2l0RGF0YS5hbW91bnQsXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICBhY2NvdW50SG9sZGVyTmFtZTogZGVwb3NpdERhdGEuYWNjb3VudEhvbGRlck5hbWUsXG4gICAgICAgIGJhbmtOYW1lOiBkZXBvc2l0RGF0YS5iYW5rTmFtZVxuICAgICAgfSkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcmlmeURlcG9zaXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgZGVwb3NpdCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkZXBvc2l0SWQgPSAnZGVwb3NpdDEyMyc7XG4gICAgICBjb25zdCBhZG1pbklkID0gJ2FkbWluMTIzJztcbiAgICAgIGNvbnN0IGFwcHJvdmVkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IG5vdGVzID0gJ0RlcMOzc2l0byB2ZXJpZmljYWRvJztcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkRhdGEgPSB7XG4gICAgICAgIGJhbmtEZXBvc2l0RGF0ZTogJzIwMjQtMDEtMTUnLFxuICAgICAgICBiYW5rRGVwb3NpdFRpbWU6ICcxNDozMCcsXG4gICAgICAgIHJlZmVyZW5jZU51bWJlcjogJ1JFRjEyMzQ1NicsXG4gICAgICAgIGFjY291bnRMYXN0Rm91ckRpZ2l0czogJzEyMzQnLFxuICAgICAgICB2ZXJpZmllZEJ5OiAnYWRtaW4xMjMnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrRGVwb3NpdCA9IHtcbiAgICAgICAgaWQ6IGRlcG9zaXRJZCxcbiAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXG4gICAgICAgIGFtb3VudDogMTAwMCxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEb2MuZXhpc3RzID0gdHJ1ZTtcbiAgICAgIG1vY2tEb2MuZGF0YS5tb2NrUmV0dXJuVmFsdWUobW9ja0RlcG9zaXQpO1xuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgcGF5bWVudFNlcnZpY2UudmVyaWZ5RGVwb3NpdChkZXBvc2l0SWQsIGFkbWluSWQsIGFwcHJvdmVkLCBub3RlcywgdmVyaWZpY2F0aW9uRGF0YSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tEb2MudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHN0YXR1czogJ2FwcHJvdmVkJyxcbiAgICAgICAgdmVyaWZpZWRCeTogYWRtaW5JZCxcbiAgICAgICAgdmVyaWZpZWRBdDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICBub3RlcyxcbiAgICAgICAgdmVyaWZpY2F0aW9uRGF0YVxuICAgICAgfSkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZGVwb3NpdCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkZXBvc2l0SWQgPSAnZGVwb3NpdDEyMyc7XG4gICAgICBjb25zdCBhZG1pbklkID0gJ2FkbWluMTIzJztcbiAgICAgIGNvbnN0IGFwcHJvdmVkID0gZmFsc2U7XG4gICAgICBjb25zdCBub3RlcyA9ICdDb21wcm9iYW50ZSBpbnbDoWxpZG8nO1xuXG4gICAgICBjb25zdCBtb2NrRGVwb3NpdCA9IHtcbiAgICAgICAgaWQ6IGRlcG9zaXRJZCxcbiAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXG4gICAgICAgIGFtb3VudDogMTAwMCxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEb2MuZXhpc3RzID0gdHJ1ZTtcbiAgICAgIG1vY2tEb2MuZGF0YS5tb2NrUmV0dXJuVmFsdWUobW9ja0RlcG9zaXQpO1xuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgcGF5bWVudFNlcnZpY2UudmVyaWZ5RGVwb3NpdChkZXBvc2l0SWQsIGFkbWluSWQsIGFwcHJvdmVkLCBub3Rlcyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tEb2MudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHN0YXR1czogJ3JlamVjdGVkJyxcbiAgICAgICAgdmVyaWZpZWRCeTogYWRtaW5JZCxcbiAgICAgICAgdmVyaWZpZWRBdDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICBub3Rlc1xuICAgICAgfSkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncHJvY2Vzc0V2ZW50UGF5bWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgZXZlbnQgcGF5bWVudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBwYXltZW50RGF0YSA9IHtcbiAgICAgICAgZXZlbnRJZDogJ2V2ZW50MTIzJyxcbiAgICAgICAgb3JnYW5pemVySWQ6ICdvcmdhbml6ZXIxMjMnLFxuICAgICAgICBtdXNpY2lhbklkOiAnbXVzaWNpYW4xMjMnLFxuICAgICAgICBhbW91bnQ6IDUwMCxcbiAgICAgICAgcGF5bWVudE1ldGhvZDogJ2JhbGFuY2UnIGFzIGNvbnN0LFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1BhZ28gcG9yIGV2ZW50bydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tCYWxhbmNlID0ge1xuICAgICAgICB1c2VySWQ6ICdvcmdhbml6ZXIxMjMnLFxuICAgICAgICBiYWxhbmNlOiAxMDAwLFxuICAgICAgICBjdXJyZW5jeTogJ1JEJCcsXG4gICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHRvdGFsRGVwb3NpdHM6IDIwMDAsXG4gICAgICAgIHRvdGFsRWFybmluZ3M6IDAsXG4gICAgICAgIHRvdGFsV2l0aGRyYXdhbHM6IDBcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEb2MuZXhpc3RzID0gdHJ1ZTtcbiAgICAgIG1vY2tEb2MuZGF0YS5tb2NrUmV0dXJuVmFsdWUobW9ja0JhbGFuY2UpO1xuICAgICAgbW9ja0RvYy5nZXQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvYyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGF5bWVudFNlcnZpY2UucHJvY2Vzc0V2ZW50UGF5bWVudChwYXltZW50RGF0YSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tEb2Muc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIGV2ZW50SWQ6IHBheW1lbnREYXRhLmV2ZW50SWQsXG4gICAgICAgIG9yZ2FuaXplcklkOiBwYXltZW50RGF0YS5vcmdhbml6ZXJJZCxcbiAgICAgICAgbXVzaWNpYW5JZDogcGF5bWVudERhdGEubXVzaWNpYW5JZCxcbiAgICAgICAgYW1vdW50OiBwYXltZW50RGF0YS5hbW91bnQsXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCdcbiAgICAgIH0pKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKCdjb21wbGV0ZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlcXVlc3RXaXRoZHJhd2FsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVxdWVzdCB3aXRoZHJhd2FsIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG11c2ljaWFuSWQgPSAnbXVzaWNpYW4xMjMnO1xuICAgICAgY29uc3Qgd2l0aGRyYXdhbERhdGEgPSB7XG4gICAgICAgIGFtb3VudDogMjAwLFxuICAgICAgICBiYW5rQWNjb3VudElkOiAnYmFuazEyMycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmV0aXJvIGRlIGdhbmFuY2lhcydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tFYXJuaW5ncyA9IHtcbiAgICAgICAgdG90YWxFYXJuaW5nczogNTAwLFxuICAgICAgICBhdmFpbGFibGVCYWxhbmNlOiAzMDBcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEb2MuZXhpc3RzID0gdHJ1ZTtcbiAgICAgIG1vY2tEb2MuZGF0YS5tb2NrUmV0dXJuVmFsdWUobW9ja0Vhcm5pbmdzKTtcbiAgICAgIG1vY2tEb2MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEb2MpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLnJlcXVlc3RXaXRoZHJhd2FsKG11c2ljaWFuSWQsIHdpdGhkcmF3YWxEYXRhKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9ja0RvYy5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgbXVzaWNpYW5JZCxcbiAgICAgICAgYW1vdW50OiB3aXRoZHJhd2FsRGF0YS5hbW91bnQsXG4gICAgICAgIGJhbmtBY2NvdW50SWQ6IHdpdGhkcmF3YWxEYXRhLmJhbmtBY2NvdW50SWQsXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnXG4gICAgICB9KSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncHJvY2Vzc1dpdGhkcmF3YWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm9jZXNzIHdpdGhkcmF3YWwgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgd2l0aGRyYXdhbElkID0gJ3dpdGhkcmF3YWwxMjMnO1xuICAgICAgY29uc3QgYWRtaW5JZCA9ICdhZG1pbjEyMyc7XG4gICAgICBjb25zdCBhcHByb3ZlZCA9IHRydWU7XG4gICAgICBjb25zdCBub3RlcyA9ICdSZXRpcm8gYXByb2JhZG8nO1xuXG4gICAgICBjb25zdCBtb2NrV2l0aGRyYXdhbCA9IHtcbiAgICAgICAgaWQ6IHdpdGhkcmF3YWxJZCxcbiAgICAgICAgbXVzaWNpYW5JZDogJ211c2ljaWFuMTIzJyxcbiAgICAgICAgYW1vdW50OiAyMDAsXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnXG4gICAgICB9O1xuXG4gICAgICBtb2NrRG9jLmV4aXN0cyA9IHRydWU7XG4gICAgICBtb2NrRG9jLmRhdGEubW9ja1JldHVyblZhbHVlKG1vY2tXaXRoZHJhd2FsKTtcbiAgICAgIG1vY2tEb2MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEb2MpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHBheW1lbnRTZXJ2aWNlLnByb2Nlc3NXaXRoZHJhd2FsKHdpdGhkcmF3YWxJZCwgYWRtaW5JZCwgYXBwcm92ZWQsIG5vdGVzKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9ja0RvYy51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgICBwcm9jZXNzZWRCeTogYWRtaW5JZCxcbiAgICAgICAgcHJvY2Vzc2VkQXQ6IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgbm90ZXNcbiAgICAgIH0pKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFBheW1lbnRTdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHBheW1lbnQgc3RhdGlzdGljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tTdGF0cyA9IHtcbiAgICAgICAgdG90YWxVc2VyczogMTAwLFxuICAgICAgICB0b3RhbE11c2ljaWFuczogNTAsXG4gICAgICAgIHRvdGFsRXZlbnRzOiAyMDAsXG4gICAgICAgIHRvdGFsUmV2ZW51ZTogNTAwMDAsXG4gICAgICAgIHRvdGFsQ29tbWlzc2lvbnM6IDUwMDAsXG4gICAgICAgIGF2ZXJhZ2VFdmVudFZhbHVlOiAyNTAsXG4gICAgICAgIG1vbnRobHlHcm93dGg6IDE1LjVcbiAgICAgIH07XG5cbiAgICAgIG1vY2tDb2xsZWN0aW9uLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRvY3M6IFtdLFxuICAgICAgICBzaXplOiAxMDBcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFBheW1lbnRTdGF0aXN0aWNzKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHRvdGFsVXNlcnM6IGV4cGVjdC5hbnkoTnVtYmVyKSxcbiAgICAgICAgdG90YWxNdXNpY2lhbnM6IGV4cGVjdC5hbnkoTnVtYmVyKSxcbiAgICAgICAgdG90YWxFdmVudHM6IGV4cGVjdC5hbnkoTnVtYmVyKVxuICAgICAgfSkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGVuZGluZ0RlcG9zaXRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHBlbmRpbmcgZGVwb3NpdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrRGVwb3NpdHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2RlcG9zaXQxJyxcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcbiAgICAgICAgICBhbW91bnQ6IDEwMDAsXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZG9jczogbW9ja0RlcG9zaXRzLm1hcChkZXBvc2l0ID0+ICh7XG4gICAgICAgICAgZGF0YTogKCkgPT4gZGVwb3NpdCxcbiAgICAgICAgICBpZDogZGVwb3NpdC5pZFxuICAgICAgICB9KSksXG4gICAgICAgIHNpemU6IG1vY2tEZXBvc2l0cy5sZW5ndGhcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFBlbmRpbmdEZXBvc2l0cygpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi53aGVyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0YXR1cycsICc9PScsICdwZW5kaW5nJyk7XG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ub3JkZXJCeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NyZWF0ZWRBdCcsICdkZXNjJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tEZXBvc2l0cyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQZW5kaW5nV2l0aGRyYXdhbHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcGVuZGluZyB3aXRoZHJhd2FscycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tXaXRoZHJhd2FscyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnd2l0aGRyYXdhbDEnLFxuICAgICAgICAgIG11c2ljaWFuSWQ6ICdtdXNpY2lhbjEyMycsXG4gICAgICAgICAgYW1vdW50OiAyMDAsXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZG9jczogbW9ja1dpdGhkcmF3YWxzLm1hcCh3aXRoZHJhd2FsID0+ICh7XG4gICAgICAgICAgZGF0YTogKCkgPT4gd2l0aGRyYXdhbCxcbiAgICAgICAgICBpZDogd2l0aGRyYXdhbC5pZFxuICAgICAgICB9KSksXG4gICAgICAgIHNpemU6IG1vY2tXaXRoZHJhd2Fscy5sZW5ndGhcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldFBlbmRpbmdXaXRoZHJhd2FscygpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2NrQ29sbGVjdGlvbi53aGVyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0YXR1cycsICc9PScsICdwZW5kaW5nJyk7XG4gICAgICBleHBlY3QobW9ja0NvbGxlY3Rpb24ub3JkZXJCeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NyZWF0ZWRBdCcsICdkZXNjJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tXaXRoZHJhd2Fscyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRNdXNpY2lhbkVhcm5pbmdzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIG11c2ljaWFuIGVhcm5pbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbXVzaWNpYW5JZCA9ICdtdXNpY2lhbjEyMyc7XG4gICAgICBjb25zdCBtb2NrRWFybmluZ3MgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2Vhcm5pbmcxJyxcbiAgICAgICAgICBtdXNpY2lhbklkLFxuICAgICAgICAgIGV2ZW50SWQ6ICdldmVudDEyMycsXG4gICAgICAgICAgYW1vdW50OiA1MDAsXG4gICAgICAgICAgY29tbWlzc2lvbjogNTAsXG4gICAgICAgICAgbmV0QW1vdW50OiA0NTAsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgbW9ja0NvbGxlY3Rpb24uZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZG9jczogbW9ja0Vhcm5pbmdzLm1hcChlYXJuaW5nID0+ICh7XG4gICAgICAgICAgZGF0YTogKCkgPT4gZWFybmluZyxcbiAgICAgICAgICBpZDogZWFybmluZy5pZFxuICAgICAgICB9KSksXG4gICAgICAgIHNpemU6IG1vY2tFYXJuaW5ncy5sZW5ndGhcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBheW1lbnRTZXJ2aWNlLmdldE11c2ljaWFuRWFybmluZ3MobXVzaWNpYW5JZCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tDb2xsZWN0aW9uLndoZXJlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnbXVzaWNpYW5JZCcsICc9PScsIG11c2ljaWFuSWQpO1xuICAgICAgZXhwZWN0KG1vY2tDb2xsZWN0aW9uLm9yZGVyQnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjcmVhdGVkQXQnLCAnZGVzYycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRWFybmluZ3MpO1xuICAgIH0pO1xuICB9KTtcbn0pOyAiXSwidmVyc2lvbiI6M30=